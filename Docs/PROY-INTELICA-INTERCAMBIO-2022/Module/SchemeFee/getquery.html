<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import os

class getquery():
    &#34;&#34;&#34;Class to store querys
    
    Params:
        client (str): client code.
    
    &#34;&#34;&#34;

    def __init__(self,client:str) -&gt; None:
        self.client = client
        pass

    def get_detail_columns(self)-&gt;list:
        &#34;&#34;&#34;Return list of columns to insert/read of the detail of report
        
        Returns:
            list: list of columns.
        &#34;&#34;&#34;
        return  [
            &#39;app_type_file&#39;,
            &#39;app_customer_code&#39; ,
            &#39;app_execution_id&#39; ,
            &#39;scheme_fee_execution_month&#39;,
            &#39;app_id&#39; ,
            &#39;app_hash_file&#39; ,
            &#39;table_description&#39; ,
            &#39;app_processing_date&#39; ,
            &#39;account_number&#39; ,
            &#39;account_funding_source&#39; ,
            &#39;account_range_country&#39; ,
            &#39;product_id&#39; ,
            &#39;range_program_id&#39; ,
            &#39;jurisdiction&#39; ,
            &#39;business_transaction_type_id&#39; ,
            &#39;reversal_indicator&#39; ,
            &#39;currency_local_indicator&#39;,
            &#39;motoec_indicator&#39; ,
            &#39;transaction_count&#39; ,
            &#39;settlement_amount&#39; ,
            &#39;transaction_scheme_fee_cost&#39; ,
            &#39;transaction_brand&#39; ,
            &#39;merchant_country_code&#39;,
            &#39;settlement_currency&#39; ,
            &#39;bank_country&#39; ,
            &#39;business_mode_id&#39; ,
            &#39;size_ticket&#39; ,
            &#39;unitary_scheme_fee_cost&#39; ,
            &#39;estimated_scheme_fee_cost&#39; ,
            &#39;unitary_estimated_scheme_fee_cost&#39; ,
            &#39;transaction_purchase_date&#39;,
        ]
    
    def get_report_columns(self)-&gt;list:
        &#34;&#34;&#34;Return list of columns to insert/read  of report
        
        Returns:
            list: list of columns.
        &#34;&#34;&#34;
        return [
            &#39;report_month&#39;,
            &#39;bank_country_code&#39;,
            &#39;business_mode&#39;,
            &#39;brand&#39;,
            &#39;size_ticket&#39;,
            &#39;product_id&#39;,
            &#39;range_program_id&#39;,
            &#39;founding_source&#39;,
            &#39;transaction_type&#39;,
            &#39;jurisdiction&#39;,
            &#39;reversal_indicator&#39;,
            &#39;currency_local_indicator&#39;,
            &#39;card_present_indicator&#39;,
            &#39;account_number&#39;,
            &#39;merchant_country_code&#39;,
            &#39;transaction_count&#39; ,
            &#39;transaction_amount&#39;,
            &#39;transaction_scheme_fee_cost&#39;,
            &#39;unitary_scheme_fee_cost&#39;,
            &#39;estimated_scheme_fee_amount&#39;,
            &#39;unitary_estimated_scheme_fee_amount&#39; 
        ]

    def validation_conditions(self)-&gt;list:
        &#34;&#34;&#34;Returns list of validation conditions
        
        Returns:
            list: list of conditions.
        &#34;&#34;&#34;
        return [
            &#34;report_amount is null or&#34;,
            &#34;account_range_country is null or&#34;,
            &#34;account_funding_source is null or&#34;,
            &#34;account_number is null or&#34;,
            &#34;jurisdiction is null or&#34;,
            &#34;product_id is null or&#34;,
            &#34;range_program_id is null&#34;,
        ] 

    def temp_table_scheme_fee_transaction(self)-&gt;str:
        &#34;&#34;&#34;creates query for an empty clone transaction table to make all calculations
        
        Returns:
            query (str): generated query. 
        &#34;&#34;&#34;
        query = f&#34;&#34;&#34;select exchange_rate,report_amount,report_currency,{&#34;,&#34;.join(self.get_detail_columns())} 
        from operational.mh_transaction_scheme_fee where app_id = -1 &#34;&#34;&#34;
        return query

    def temp_table_scheme_fee_report(self)-&gt;str:
        &#34;&#34;&#34;creates query for an empty clone report table to make all calculations
        
        Returns:
            str: generated query.
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;select app_id,
                    app_customer_code,
                    app_type_file,
                    app_hash_file,
                    app_processing_date, 
                    app_execution_id,
                    report_currency,
                    customer_code,
                    {&#34;,&#34;.join(self.get_report_columns())} from operational.mh_monthly_scheme_fee where app_id = -1 &#34;&#34;&#34;

    def get_insert_detail(self,columns:list,scheme:str,table:str)-&gt;str:
        &#34;&#34;&#34;Returns basic insert query for detail table
        Args:
            columns (list): list of columns.
            schema (str): schema of table.
            table (str): table name.

        Returns:
            str: generated query.
        &#34;&#34;&#34;
        return f&#34;&#34;&#34; insert into {scheme}.{table} ({&#39;,&#39;.join(columns)})&#34;&#34;&#34;

    def get_issuers_visa(self,formated_date:str,date:str,first_day:str,last_day:str)-&gt;str:
        &#34;&#34;&#34;Returns Query to get issuer transactions of visa
        
        Args:
            formated_date (str): formated date and execution time.
            date (str): year and month of report.
            first_date (str): start of range for report.
            last_day (str): end of range for report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            select 
                t.app_type_file,
                cus.code,
                &#39;{formated_date}&#39;,
                &#39;{date}&#39;,
                t.app_id,
                t.app_hash_file,
                &#39;VISA ISS&#39;,
                t.app_processing_date,
                cast(t.account_number as text),
                case when cf.funding_source in (&#39;C&#39;,&#39;H&#39;,&#39;R&#39;) then &#39;C&#39; when cf.funding_source in(&#39;D&#39;,&#39;P&#39;) then &#39;D&#39; else null end as account_funding_source,
                ardef_country,
                cf.product_id, 
                sfbp.range_program_id,
                jurisdiction,
                btt.transaction_type_id,
                reversal_indicator,
                case when cur.currency_alphabetic_code in (cus.local_currency_code,cus.settlement_currency_code) then 1 else 0 end,
                case when cast(case when trim(motoec_indicator) = &#39;&#39; then &#39;10&#39; else motoec_indicator end as integer) &gt;= 10 then 1 else 0 end,
                1,
                case when collection_only_flag in (&#39;C&#39;) then source_amount else settlement_report_amount end, 
                0,
                &#39;VISA&#39;,
                merchant_country_code,
                case when collection_only_flag in (&#39;C&#39;) then cur.currency_alphabetic_code else settlement_report_currency_code end, 
                cus.customer_country, 
                cf.business_mode,
                0,
                0,
                0,
                0,
                purchase_date
            from 
            operational.dh_visa_transaction t
            inner join operational.dh_visa_transaction_calculated_field cf on t.app_id = cf.app_id and t.app_hash_file = cf.app_hash_file
            inner join control.t_customer cus on cus.code = t.app_customer_code 
            left join operational.m_currency cur on t.source_currency_code = cast(cur.currency_numeric_code as text) 
            left join operational.m_visa_business_transaction_type btt on cast(business_transaction_type_id as integer) = cf.business_transaction_type
            left join operational.m_scheme_fee_bin_products sfbp on trim(sfbp.product_code) = trim(cf.product_id) and sfbp.brand = &#39;VISA&#39;
            where
            t.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39;
            and cf.business_mode = &#39;issuing&#39;
            and btt.transaction_type_id in (&#39;PUR&#39;,&#39;CSH&#39;)
            and t.app_customer_code = &#39;{self.client}&#39;
            and t.transaction_code in (&#39;05&#39;,&#39;06&#39;,&#39;07&#39;,&#39;15&#39;,&#39;16&#39;,&#39;17&#39;,&#39;25&#39;,&#39;26&#39;,&#39;27&#39;,&#39;35&#39;,&#39;36&#39;,&#39;37&#39;)
        &#34;&#34;&#34;

    def get_acquirer_visa(self,formated_date:str,date:str,first_day:str,last_day:str)-&gt;str:
        &#34;&#34;&#34;Returns query to get visa acquiring transactions
        
        Args:
            formated_date (str): formated date and execution time.
            date (str): year and month of report.
            first_date (str): start of range for report.
            last_day (str): end of range for report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            select
                t.app_type_file,
                cus.code,
                &#39;{formated_date}&#39;,
                &#39;{date}&#39;,
                t.app_id,
                t.app_hash_file,
                &#39;VISA ACQ&#39;,
                t.app_processing_date,
                RIGHT(CONCAT(repeat(&#39;0&#39;,9),RTRIM(LTRIM(t.card_acceptor_id))),11) mct_cd,
                case when cf.funding_source in (&#39;C&#39;,&#39;H&#39;,&#39;R&#39;) then &#39;C&#39; when cf.funding_source in(&#39;D&#39;,&#39;P&#39;) then &#39;D&#39; else null end as account_funding_source,
                ardef_country,
                cf.product_id, 
                sfbp.range_program_id,
                jurisdiction,
                btt.transaction_type_id,
                reversal_indicator,
                case when cur.currency_alphabetic_code in (cus.local_currency_code,cus.settlement_currency_code) then 1 else 0 end,
                case when cast(case when trim(motoec_indicator) = &#39;&#39; then &#39;10&#39; else motoec_indicator end as integer) &gt;= 10 then 1 else 0 end,
                1,
                case when collection_only_flag in (&#39;C&#39;) then source_amount else settlement_report_amount end, 
                0,
                &#39;VISA&#39;,
                merchant_country_code,
                case when collection_only_flag in (&#39;C&#39;) then currency_alphabetic_code else settlement_report_currency_code end, 
                cus.customer_country, 
                cf.business_mode,
                0,
                0,
                0,
                0,
                purchase_date
            from
            operational.dh_visa_transaction t
            inner join operational.dh_visa_transaction_calculated_field cf on t.app_id = cf.app_id and t.app_hash_file = cf.app_hash_file     
            inner join control.t_customer cus on cus.code = t.app_customer_code
            left join operational.m_currency cur on t.source_currency_code = cast(cur.currency_numeric_code as text)
            left join operational.m_visa_business_transaction_type btt on cast(business_transaction_type_id as integer) = cf.business_transaction_type
            left join operational.m_scheme_fee_bin_products sfbp on trim(sfbp.product_code) = trim(cf.product_id) and sfbp.brand = &#39;VISA&#39;     
            where
            t.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39;
            and cf.business_mode = &#39;acquiring&#39;
            and btt.transaction_type_id in (&#39;PUR&#39;,&#39;CSH&#39;)
            and t.app_customer_code = &#39;{self.client}&#39;
            and t.transaction_code in (&#39;05&#39;,&#39;06&#39;,&#39;07&#39;,&#39;15&#39;,&#39;16&#39;,&#39;17&#39;,&#39;25&#39;,&#39;26&#39;,&#39;27&#39;,&#39;35&#39;,&#39;36&#39;,&#39;37&#39;)
        &#34;&#34;&#34;

    def get_on_us_visa(self,formated_date:str,date:str,first_day:str,last_day:str)-&gt;str:
        &#34;&#34;&#34;Returns query to get missing on us transactions (issuing on-us, because these are duplicates of acquiring on-us)
        
        Args:
            formated_date (str): formated date and execution time.
            date (str): year and month of report.
            first_date (str): start of range for report.
            last_day (str): end of range for report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return  f&#34;&#34;&#34;
            select
                t.app_type_file,
                cus.code,
                &#39;{formated_date}&#39;,
                &#39;{date}&#39;,
                t.app_id,
                t.app_hash_file,
                &#39;VISA ON US ISS&#39;,
                t.app_processing_date,
                cast(account_number as text) mct_cd,
                case when cf.funding_source in (&#39;C&#39;,&#39;H&#39;,&#39;R&#39;) then &#39;C&#39; when cf.funding_source in(&#39;D&#39;,&#39;P&#39;) then &#39;D&#39; else null end as account_funding_source,
                ardef_country,
                cf.product_id, 
                sfbp.range_program_id,
                jurisdiction,
                btt.transaction_type_id,
                reversal_indicator,
                case when cur.currency_alphabetic_code in (cus.local_currency_code,cus.settlement_currency_code) then 1 else 0 end,
                case when cast(case when trim(motoec_indicator) = &#39;&#39; then &#39;10&#39; else motoec_indicator end as integer) &gt;= 10 then 1 else 0 end,
                1,
                case when collection_only_flag in (&#39;C&#39;) then source_amount else settlement_report_amount end, 
                0,
                &#39;VISA&#39;,
                merchant_country_code,
                case when collection_only_flag in (&#39;C&#39;) then currency_alphabetic_code else settlement_report_currency_code end, 
                cus.customer_country, 
                &#39;issuing&#39;,
                0,
                0,
                0,
                0,
                purchase_date
            from
            operational.dh_visa_transaction t
            inner join operational.dh_visa_transaction_calculated_field cf on t.app_id = cf.app_id and t.app_hash_file = cf.app_hash_file     
            inner join control.t_customer cus on cus.code = t.app_customer_code
            left join operational.m_currency cur on t.source_currency_code = cast(cur.currency_numeric_code as text)
            left join operational.m_visa_business_transaction_type btt on cast(business_transaction_type_id as integer) = cf.business_transaction_type
            left join operational.m_scheme_fee_bin_products sfbp on trim(sfbp.product_code) = trim(cf.product_id) and sfbp.brand = &#39;VISA&#39;     
            where
            t.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39;
            and cf.business_mode = &#39;acquiring&#39;
            and btt.transaction_type_id in (&#39;PUR&#39;,&#39;CSH&#39;)
            and t.app_customer_code = &#39;{self.client}&#39;
            and collection_only_flag in (&#39;C&#39;)
            and t.transaction_code in (&#39;05&#39;,&#39;06&#39;,&#39;07&#39;,&#39;15&#39;,&#39;16&#39;,&#39;17&#39;,&#39;25&#39;,&#39;26&#39;,&#39;27&#39;,&#39;35&#39;,&#39;36&#39;,&#39;37&#39;)
        &#34;&#34;&#34;
    
    def get_sms_visa(self,formated_date:str,date:str,first_day:str,last_day:str)-&gt;str:
        &#34;&#34;&#34;Returns query to get sms visa transactions
        
        Args:
            formated_date (str): formated date and execution time.
            date (str): year and month of report.
            first_date (str):  start of range for report.
            last_day (str): end of range for report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            select 
                sms.app_type_file,
                cus.code,
                &#39;{formated_date}&#39;,
                &#39;{date}&#39;,
                sms.app_id,
                sms.app_hash_file,
                &#39;VISA SMS&#39;,
                sms.app_processing_date,
                left(cast(sms.card_number as text),9),
                case when sms.account_funding_source in (&#39;C&#39;,&#39;H&#39;,&#39;R&#39;) then &#39;C&#39; when sms.account_funding_source in(&#39;D&#39;,&#39;P&#39;) then &#39;D&#39; else null end,
                cast(pan_extended_country_code as text),
                sms.product_id_sms,
                sfbp.range_program_id, 
                jurisdiction,
                btt.transaction_type_id,
                reversal_indicator,
                case when transaction_currency_code = cus.local_currency_code then 1 else 0 END,
                1,
                1,
                settlement_amount,
                0,
                &#39;VISA&#39;,
                card_acceptor_country,
                currency_alphabetic_code,
                cus.customer_country,
                cf.business_mode,
                0,
                0,
                0,
                0,
                local_transaction_date
            from operational.dh_visa_transaction_sms sms
            inner join operational.dh_visa_transaction_sms_calculated_field cf on sms.app_id = cf.app_id and sms.app_hash_file = cf.app_hash_file and sms.app_type_file = cf.app_type_file
            inner join control.t_customer cus on cus.code = sms.app_customer_code
            left join operational.m_currency cur on sms.settlement_currency_code_sms = cast(cur.currency_numeric_code as text)
            left join operational.m_scheme_fee_bin_products sfbp on trim(sfbp.product_code) = trim(sms.product_id_sms) and sfbp.brand = &#39;VISA&#39; 
            left join operational.m_visa_business_transaction_type btt on cast(business_transaction_type_id as integer) = cf.business_transaction_type  
            where 
            sms.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39; 
            and sms.app_customer_code = &#39;{self.client}&#39;
            and cf.business_transaction_type = 22 and business_transaction_cycle &lt; 100
        &#34;&#34;&#34;
    
    def get_transactions_mastercard(self,formated_date:str,date:str,first_day:str,last_day:str)-&gt;str:
        &#34;&#34;&#34;Returns query to get mastercard transactions in general
        
        Args:
            formated_date (str): formated date and execution time.
            date (str): year and month of report.
            first_date (str): start of range for report.
            last_day (str): end of range for report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            select 
                mde.app_type_file,
                cus.code,
                &#39;{formated_date}&#39;,
                &#39;{date}&#39;,
                mde.app_id,
                mde.app_hash_file,
                &#39;MASTERCARD ISS AND ACQ&#39;,
                mde.app_processing_date,
                case when business_mode = &#39;acquiring&#39; then right(lpad(rtrim(ltrim(cast(card_acceptor_id_code as text))),15,&#39;0&#39;),11) when business_mode = &#39;issuing&#39; then left(lpad(cast(pan as text),19,&#39;0&#39;),9) end,
                cf.funding_source,
                iar_country,
                cf.gcms_product_identifier, 
                sfbp.range_program_id,
                cf.jurisdiction, 
                mcbtt.transaction_type_id,
                case when left(message_reversal_indicator,1) = &#39;R&#39; then 1 else 0 end, 
                case when cur.currency_alphabetic_code in (cus.local_currency_code,cus.settlement_currency_code) then 1 else 0 end,
                case when right(pos_entry_mode,1) != &#39;0&#39; then 1 else 0 end as motoec_indicator,
                1,
                settlement_report_amount,
                0,
                &#39;MasterCard&#39;,
                mde.card_acceptor_country_code,
                settlement_report_currency_code,
                cus.customer_country,
                business_mode,
                0,
                0,
                0,
                0,
                date_and_time_local_transaction::date
            from operational.dh_mastercard_data_element mde
            inner join operational.dh_mastercard_calculated_field cf on  mde.app_id = cf.app_id and mde.app_hash_file = cf.app_hash_file
            inner join control.t_customer cus on cus.code = mde.app_customer_code
            left join operational.m_scheme_fee_bin_products sfbp on trim(sfbp.product_code) = trim(cf.gcms_product_identifier) and sfbp.brand = &#39;MC&#39;
            left join operational.m_bin_funding_source lubfs on rng_fnd_id = bin_funding_source_mc_numeric_code
            left join operational.m_mastercard_business_transaction_type mcbtt on business_transaction_type_id = left(processing_code,2) 
            left join operational.m_currency cur on mde.currency_code_transaction = cur.currency_numeric_code
            left join operational.dh_mastercard_exclusion_messages em on em.app_customer_code = mde.app_customer_code and em.source_file_id = cf.mc_file_id and em.source_message_number_id = mde.message_number 
            where mde.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39; 
            and mde.app_customer_code = &#39;{self.client}&#39;
            and app_message_type in (&#39;1240&#39;,&#39;1644&#39;) 
            and settlement_indicator_1 = &#39;M&#39; 
            and left(mc_file_id,3) in (&#39;001&#39;,&#39;002&#39;)
            and cf.gcms_product_identifier is not null
            and em.app_id is null
        &#34;&#34;&#34;

    def get_issuers_on_us_mastercard(self,formated_date:str,date:str,first_day:str,last_day:str)-&gt;str:
        &#34;&#34;&#34;Returns query to get mastercard issuer on-us transactions
        
        Args:
            formated_date (str): formated date and execution time.
            date (str): year and month of report.
            first_date (str): start of range for report.
            last_day (str): end of range for report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            select 
                mde.app_type_file,
                cus.code,
                &#39;{formated_date}&#39;,
                &#39;{date}&#39;,
                mde.app_id,
                mde.app_hash_file,
                &#39;MASTERCARD ON US ISS&#39;,
                mde.app_processing_date,
                left(lpad(cast(pan as text),19,&#39;0&#39;),9),
                cf.funding_source,
                iar_country,
                cf.gcms_product_identifier, 
                sfbp.range_program_id,
                cf.jurisdiction, 
                mcbtt.transaction_type_id,
                case when left(message_reversal_indicator,1) = &#39;R&#39; then 1 else 0 end, 
                case when cur.currency_alphabetic_code in (cus.local_currency_code,cus.settlement_currency_code) then 1 else 0 end,
                case when right(pos_entry_mode,1) != &#39;0&#39; then 1 else 0 end as motoec_indicator,
                1,
                amount_transaction,
                0,
                &#39;MasterCard&#39;,
                mde.card_acceptor_country_code,
                cast(currency_code_transaction as text),
                cus.customer_country,
                &#39;issuing&#39;,
                0,
                0,
                0,
                0,
                date_and_time_local_transaction::date
            from operational.dh_mastercard_data_element mde
            inner join operational.dh_mastercard_calculated_field cf on  mde.app_id = cf.app_id and mde.app_hash_file = cf.app_hash_file
            inner join control.t_customer cus on cus.code = mde.app_customer_code
            left join operational.m_scheme_fee_bin_products sfbp on trim(sfbp.product_code) = trim(cf.gcms_product_identifier) and sfbp.brand = &#39;MC&#39;
            left join operational.m_bin_funding_source lubfs on rng_fnd_id = bin_funding_source_mc_numeric_code
            left join operational.m_mastercard_business_transaction_type mcbtt on business_transaction_type_id = left(processing_code,2) 
            left join operational.m_currency cur on mde.currency_code_transaction = cur.currency_numeric_code
            left join operational.dh_mastercard_exclusion_messages em on em.app_customer_code = mde.app_customer_code and em.source_file_id = cf.mc_file_id and em.source_message_number_id = mde.message_number 
            where mde.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39; 
            and mde.app_customer_code = &#39;{self.client}&#39;
            and app_message_type in (&#39;1240&#39;,&#39;1644&#39;) 
            and settlement_indicator_1 = &#39;C&#39; 
            and left(mc_file_id,3) in (&#39;001&#39;,&#39;002&#39;)
            and cf.gcms_product_identifier is not null
            and em.app_id is null
        &#34;&#34;&#34;

    def get_acquiring_on_us_mastercard(self,formated_date:str,date:str,first_day:str,last_day:str)-&gt;str:
        &#34;&#34;&#34;Returns query to get mastercard acquirer on-us transactions
        
        Args:
            formated_date (str): formated date and execution time.
            date (str): year and month of report.
            first_date (str): start of range for report.
            last_day (str): end of range for report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            select 
                mde.app_type_file,
                cus.code,
                &#39;{formated_date}&#39;,
                &#39;{date}&#39;,
                mde.app_id,
                mde.app_hash_file,
                &#39;MasterCard ON US ACQ&#39;,
                mde.app_processing_date,
                right(lpad(rtrim(ltrim(cast(card_acceptor_id_code as text))),15,&#39;0&#39;),11),
                cf.funding_source,
                iar_country,
                cf.gcms_product_identifier, 
                sfbp.range_program_id,
                cf.jurisdiction, 
                mcbtt.transaction_type_id,
                case when left(message_reversal_indicator,1) = &#39;R&#39; then 1 else 0 end, 
                case when cur.currency_alphabetic_code in (cus.local_currency_code,cus.settlement_currency_code) then 1 else 0 end,
                case when right(pos_entry_mode,1) != &#39;0&#39; then 1 else 0 end as motoec_indicator,
                1,
                amount_transaction,
                0,
                &#39;MasterCard&#39;,
                mde.card_acceptor_country_code,
                cast(currency_code_transaction as text),
                cus.customer_country,
                &#39;acquiring&#39;,
                0,
                0,
                0,
                0,
                date_and_time_local_transaction::date
            from operational.dh_mastercard_data_element mde
            inner join operational.dh_mastercard_calculated_field cf on  mde.app_id = cf.app_id and mde.app_hash_file = cf.app_hash_file
            inner join control.t_customer cus on cus.code = mde.app_customer_code
            left join operational.m_scheme_fee_bin_products sfbp on trim(sfbp.product_code) = trim(cf.gcms_product_identifier) and sfbp.brand = &#39;MC&#39;
            left join operational.m_bin_funding_source lubfs on rng_fnd_id = bin_funding_source_mc_numeric_code
            left join operational.m_mastercard_business_transaction_type mcbtt on business_transaction_type_id = left(processing_code,2) 
            left join operational.m_currency cur on mde.currency_code_transaction = cur.currency_numeric_code
            left join operational.dh_mastercard_exclusion_messages em on em.app_customer_code = mde.app_customer_code and em.source_file_id = cf.mc_file_id and em.source_message_number_id = mde.message_number 
            where mde.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39; 
            and mde.app_customer_code = &#39;{self.client}&#39;
            and app_message_type in (&#39;1240&#39;,&#39;1644&#39;) 
            and settlement_indicator_1 = &#39;C&#39; 
            and left(mc_file_id,3) in (&#39;001&#39;,&#39;002&#39;)
            and cf.gcms_product_identifier is not null
            and em.app_id is null
        &#34;&#34;&#34;
    
    def get_union_query(self,base:str,other_query:list)-&gt;str:
        &#34;&#34;&#34;Returns combination in union query
        
         Args:
            base (str): first part of query.
            other_query (list): list of querys to unify.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        joined = &#34; union &#34;.join(other_query)
        return f&#34;&#34;&#34;{base} {joined}&#34;&#34;&#34;

    def get_exchange_rate_calculation(self,schema:str,table_name:str,first_day:str,last_day:str)-&gt;str:
        &#34;&#34;&#34;Return Query for exchange rate calculations
        
        Args:
            schema (str): schema of table.
            table_name (str): name of table.
            first_date (str): start of range for report.
            last_day (str): end of range for report.

        Returns:
            str: returns query

        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            update {schema}.{table_name} d set exchange_rate = x.exchange_value,
            report_amount = round(case 
                            when x.settlement_currency = x.report_currency_code then x.settlement_amount 
                                else x.settlement_amount * x.exchange_value 
                            end::numeric,2) ,
            report_currency = x.report_currency_code
            from (
                select
                    mc.exchange_value,
                    cus.report_currency_code,
                    tsf.app_id,
                    tsf.app_hash_file,
                    settlement_currency,
                    settlement_amount
                from {schema}.{table_name} tsf
                inner join control.t_customer cus on cus.code = tsf.app_customer_code
                left join operational.dh_exchange_rate mc on tsf.app_processing_date = mc.date 
                        and tsf.transaction_brand = mc.brand 
                        and mc.currency_to = cus.report_currency_code
                        and mc.currency_from = tsf.settlement_currency
                where tsf.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39;
                and tsf.app_customer_code = &#39;{self.client}&#39;) x 
            where x.app_id = d.app_id and x.app_hash_file = d.app_hash_file
        &#34;&#34;&#34;

    def get_rows_w_null_conditions(self,first_day:str,last_day:str,formated_date:str)-&gt;str:
        &#34;&#34;&#34;gets rows with null fields

        Args:
            first_date (str): start of range for report.
            last_day (str): end of range for report.
            formated_date (str): formated date of execution.

        Returns:
            str: returns query 
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            where app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39;
            and app_customer_code = &#39;{self.client}&#39;
            and (
                {&#34; &#34;.join(self.validation_conditions())}
            )
            and app_execution_id = &#39;{formated_date}&#39;
            &#34;&#34;&#34;

    def delete_rows_w_null(self,schema:str,table:str,conditions:str)-&gt;str:
        &#34;&#34;&#34;Deletes rows with null fields
        
        Args:
            schema (str): schema of table.
            table (str): table name.
            conditions (str): conditions query.

        Returns:
            str: returns query 
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;delete from {schema}.{table} {conditions}&#34;&#34;&#34;

    def update_amounts(self,first_day:str,last_day:str)-&gt;str:
        &#34;&#34;&#34;Update null amounts
        
        Args:
            first_date (str): start of range for report.
            last_day (str): end of range for report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return  f&#34;&#34;&#34;
            update operational.mh_transaction_scheme_fee d set
            report_amount = 0
            where app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39;
            and app_customer_code = &#39;{self.client}&#39; and report_amount is null
        &#34;&#34;&#34; 

    def update_size_tickets(self,schema:str,table_name:str,first_day:str,last_day:str)-&gt;str:
        &#34;&#34;&#34;updates size tikets field
        
        Args:
            schema (str): schema of table.
            table_name (str): table name.
            first_date (str): start of range for report.
            last_day (str): end of range for report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            update {schema}.{table_name} d set 
            size_ticket = case when x.size_ticket is not null then x.size_ticket else 0 end
            from (
            select 
            tsf.app_id,
            tsf.app_hash_file,st.app_id size_ticket
            from {schema}.{table_name} tsf
            left join operational.m_size_ticket st on report_amount between st.size_ticket_min and st.size_ticket_max
            where tsf.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39;
            and tsf.app_customer_code = &#39;{self.client}&#39;
            ) 
            x where x.app_id = d.app_id and x.app_hash_file = d.app_hash_file
        &#34;&#34;&#34;

    def update_unknown_range_country(self,formated_date:str)-&gt;str:
        &#34;&#34;&#34;updates account_range_country

        Args:
            formated_date (str): date of execution of file.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            update operational.mh_transaction_scheme_fee d set 
            account_range_country = &#39;UNK&#39;
            where app_execution_id = &#39;{formated_date}&#39; and account_range_country is null
            and app_customer_code = &#39;{self.client}&#39; 
        &#34;&#34;&#34;

    def update_unknown_founding_source(self,formated_date:str)-&gt;str:
        &#34;&#34;&#34;updates account_founding_source
        
        Args:
            formated_date (str): date of execution of file.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            update operational.mh_transaction_scheme_fee d set 
            account_funding_source = &#39;UNK&#39;
            where app_execution_id = &#39;{formated_date}&#39; and account_funding_source is null
            and app_customer_code = &#39;{self.client}&#39; 
        &#34;&#34;&#34;

    def update_unknown_account_range(self,formated_date:str)-&gt;str:
        &#34;&#34;&#34;updates account_number
        
        Args:
            formated_date (str): date of execution of file.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            update operational.mh_transaction_scheme_fee d set 
            account_number = &#39;9999999999999999&#39;
            where app_execution_id = &#39;{formated_date}&#39; and account_number is null
            and app_customer_code = &#39;{self.client}&#39; 
        &#34;&#34;&#34;

    def update_jurisdiction(self,formated_date:str)-&gt;str:
        &#34;&#34;&#34;updates juridiction
        
        Args:
            formated_date (str): date of execution of file.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            update operational.mh_transaction_scheme_fee d set 
            jurisdiction = &#39;UNK&#39;
            where app_execution_id = &#39;{formated_date}&#39; and jurisdiction is null
            and app_customer_code = &#39;{self.client}&#39; and report_amount is null
        &#34;&#34;&#34;

    def update_visa_unk_product(self,formated_date:str)-&gt;str:
        &#34;&#34;&#34;updates the unknown visa products with dummy
        
        Args:
            formated_date (str): date of execution of file.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            update operational.mh_transaction_scheme_fee d set 
            product_id = &#39;UNK&#39;,range_program_id = &#39;UNK&#39;
            where app_execution_id = &#39;{formated_date}&#39; and product_id is null
            and transaction_brand = &#39;VISA&#39;
            and app_customer_code = &#39;{self.client}&#39; and report_amount is null
        &#34;&#34;&#34;
    
    def update_mastercard_unk_product(self,formated_date:str)-&gt;str:
        &#34;&#34;&#34;updates the unknown mastercard products with dummy
        
        Args:
            formated_date (str): date of execution of file.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            update operational.mh_transaction_scheme_fee d set 
            product_id = &#39;UNK&#39;,range_program_id = &#39;UNK&#39;
            where app_execution_id = &#39;{formated_date}&#39; and product_id is null
            and transaction_brand = &#39;MasterCard&#39; 
            and app_customer_code = &#39;{self.client}&#39; and report_amount is null
        &#34;&#34;&#34;

    def update_unk_range_program(self,formated_date:str)-&gt;str:
        &#34;&#34;&#34;updates unknown range program id
        
        Args:
            formated_date (str): date of execution of file.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            update operational.mh_transaction_scheme_fee d set 
            range_program_id = &#39;UNK&#39;
            where app_execution_id = &#39;{formated_date}&#39; and range_program_id is null
            and app_customer_code = &#39;{self.client}&#39; 
        &#34;&#34;&#34;

    def get_insert_into_report_table(self,report_scheme:str,report_table:str,transaction_scheme:str,transaction_table:str,formated_date:str,month_name:str,first_day:str,last_day:str)-&gt;str:
        &#34;&#34;&#34;Returns insertion query for report
        
        Args:
            report_scheme (str): report table schema.
            report_table (str): report table name.
            transaction_scheme (str): transaction table schema.
            transaction_table (str): transaction table name.
            formated_date (str): date of execution of file.
            month_name (str): processing month.
            first_date (str): start of range for report.
            last_day (str): end of range for report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
        insert into {report_scheme}.{report_table} (
            app_execution_id,
            report_month,
            report_currency,
            customer_code,
            bank_country_code,
            business_mode,
            brand,
            size_ticket,
            product_id,
            range_program_id,
            founding_source,
            transaction_type,
            jurisdiction,
            reversal_indicator,
            currency_local_indicator,
            card_present_indicator, 
            account_number,
            merchant_country_code,
            transaction_count,
            transaction_amount,
            transaction_scheme_fee_cost
        )
        select
        &#39;{formated_date}&#39; app_execution_id,&#39;{month_name}&#39; report_month,cus.report_currency_code,cus.code,bank_country,business_mode_id,transaction_brand,size_ticket,product_id,range_program_id,account_funding_source,
        business_transaction_type_id,jurisdiction,reversal_indicator,currency_local_indicator,motoec_indicator,account_number,
        merchant_country_code, sum(transaction_count),sum(report_amount),0
        from {transaction_scheme}.{transaction_table} tsf
        inner join control.t_customer cus on cus.code = tsf.app_customer_code
        where tsf.app_processing_date between  &#39;{first_day}&#39; and &#39;{last_day}&#39;
        and tsf.app_customer_code = &#39;{self.client}&#39; 
        group by 
        app_execution_id,
        cus.report_currency_code,
        cus.code,bank_country,
        report_month,
        business_mode_id,
        transaction_brand,
        size_ticket,
        product_id,
        range_program_id,
        account_funding_source,
        business_transaction_type_id,
        jurisdiction,
        reversal_indicator,
        currency_local_indicator,
        motoec_indicator,
        account_number,
        merchant_country_code
        &#34;&#34;&#34;

    def get_report_extra_columns(self,schema:str,table:str,hash:str,first_day:str)-&gt;str:
        &#34;&#34;&#34;get columns not included in report columns from report table

        Args:
            scheme (str):  table schema.
            table (str):  table name.
            hash (str): hash code of file.
            first_day (str): first day of month.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
                update {schema}.{table} t 
                    set app_id = s.row_num,
                    app_customer_code = &#39;{self.client}&#39;,
                    app_type_file = &#39;report&#39;,
                    app_hash_file=&#39;{hash}&#39;,
                    app_processing_date=&#39;{first_day}&#39;,
                    transaction_scheme_fee_cost = 0,
                    unitary_scheme_fee_cost = 0,
                    estimated_scheme_fee_amount = 0,
                    unitary_estimated_scheme_fee_amount = 0 
                from (select st.*, row_number() over (order by account_number,
                        bank_country_code,
                        business_mode,
                        brand,
                        jurisdiction,
                        founding_source,
                        product_id,
                        range_program_id,
                        transaction_type,
                        reversal_indicator,
                        card_present_indicator,
                        currency_local_indicator,
                        merchant_country_code,
                        size_ticket) as row_num from {schema}.{table} st ) s 
                where 
                s.account_number = t.account_number and
                s.bank_country_code = t.bank_country_code and
                s.business_mode = t.business_mode and
                s.brand = t.brand and
                s.jurisdiction = t.jurisdiction and
                s.founding_source = t.founding_source and
                s.product_id = t.product_id and
                s.range_program_id = t.range_program_id and
                s.transaction_type = t.transaction_type and
                s.reversal_indicator = t.reversal_indicator and
                s.card_present_indicator = t.card_present_indicator and
                s.currency_local_indicator = t.currency_local_indicator and
                s.merchant_country_code = t.merchant_country_code and
                s.size_ticket = t.size_ticket
                &#34;&#34;&#34;
    
    def get_report_query(self,schema:str,table:str,report_columns:list,formated_date:str)-&gt;str:
        &#34;&#34;&#34;Returns query to get report

        Args:
            scheme (str):  table schema.
            table (str):  table name.
            report_columns (list): list of columns for report.
            formated_date (str): execution formated date.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
        select 
        {&#34;,&#34;.join(report_columns)}
        from {schema}.{table} 
        where app_execution_id = &#39;{formated_date}&#39;
        &#34;&#34;&#34;

    def get_delete_detail(self,date:str,execution_id:str)-&gt;str:
        &#34;&#34;&#34;Returns query to delete detail
        
        Args:
            date (str):  month of execution.
            execution_id (str):  execution id.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;delete from operational.mh_transaction_scheme_fee where app_customer_code = &#39;{self.client}&#39; and scheme_fee_execution_month = &#39;{date}&#39; and app_execution_id != &#39;{execution_id}&#39;&#34;

    def get_delete_report(self,month_name:str,execution_id)-&gt;str:
        &#34;&#34;&#34;Returns query to delete report
        
        Args:
            month_name (str):  month of execution.
            execution_id (str):  execution id.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;delete from operational.mh_monthly_scheme_fee where customer_code = &#39;{self.client}&#39; and report_month = &#39;{month_name}&#39; and app_execution_id != &#39;{execution_id}&#39;&#34;

    def get_delete_sumary(self,month_name:str,execution_id)-&gt; str:
        &#34;&#34;&#34;Returns query to delete sumary
        
        Args:
            month_name (str):  month of execution.
            execution_id (str):  execution id.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;delete from operational.mh_scheme_fee_sumary where report_client_code = &#39;{self.client}&#39; and report_month = &#39;{month_name}&#39; and app_execution_id != &#39;{execution_id}&#39;&#34;

    def get_insert_into_sumary(self,formated_date:str,month_name:str,inserted_into_detail:str,inserted_into_header:str,s3_route:str)-&gt;str:
        &#34;&#34;&#34;Returns query to insert into sumary
        
        Args:
            formated_date (str): formated execution date.
            month_name (str):  report month name.
            inserted_into_detail (str): rows inserted.
            inserted_into_header (str): rows inserted.
            s3_route (str): route to output report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
                insert into operational.mh_scheme_fee_sumary 
                (app_execution_id,report_month,report_client_code,number_of_inserted_rows,number_of_groups,number_of_updated_rows,s3_route)
                values(&#39;{formated_date}&#39;,&#39;{month_name}&#39;,&#39;{self.client}&#39;,{inserted_into_detail},{inserted_into_header},0,&#39;{s3_route}&#39;)
                &#34;&#34;&#34;
    
    def get_update_from_temp(self,temp_schem:str,temp_table:str,month_name:str)-&gt;str:
        &#34;&#34;&#34;Returns query to update from temp
        
        Args:
            temp_schem (str): temporal schema.
            temp_table (str): temporal table name.
            month_name (str): nmonth of report.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            update operational.mh_monthly_scheme_fee sf set
            estimated_scheme_fee_amount = x.estimated_scheme_fee_amount,
            transaction_scheme_fee_cost = x.transaction_scheme_fee_cost,
            unitary_scheme_fee_cost = x.unitary_scheme_fee_cost,
            unitary_estimated_scheme_fee_amount = x.unitary_estimated_scheme_fee_amount
            from (select * from {temp_schem}.{temp_table} where report_month = &#39;{month_name}&#39;) x where
            customer_code = &#39;{self.client}&#39; and
            x.report_month::text = sf.report_month and
            x.bank_country_code = sf.bank_country_code and
            x.business_mode = sf.business_mode and
            x.brand = sf.brand and
            x.size_ticket = sf.size_ticket and
            x.product_id = sf.product_id and
            sf.range_program_id = x.range_program_id and
            x.founding_source = sf.founding_source and
            x.transaction_type =  sf.transaction_type and
            x.jurisdiction = sf.jurisdiction and
            x.reversal_indicator = sf.reversal_indicator and
            x.currency_local_indicator = sf.currency_local_indicator and
            x.card_present_indicator = sf.card_present_indicator and
            x.account_number = sf.account_number and
            x.merchant_country_code = sf.merchant_country_code and
            x.transaction_count = sf.transaction_count
            &#34;&#34;&#34;

    def get_drop_if_exists(self,temp_schem:str,temp_table:str)-&gt;str:
        &#34;&#34;&#34;Returns query to drop temporal if exists

        Args:
            temp_schem (str): temporal schema.
            temp_table (str): temporal table name.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;drop table if exists {temp_schem}.{temp_table}&#34;

    def get_update_detail(self,first_day:str,last_day:str,month_name:str)-&gt;str:
        &#34;&#34;&#34;Returns query to update from temp
        
        Args:
            first_date (str): start of range for report.
            last_day (str): end of range for report.
            month_name (str): month of report.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
                update operational.mh_transaction_scheme_fee d set
                unitary_scheme_fee_cost = x.unitary_scheme_fee_cost,
                estimated_scheme_fee_cost = x.estimated_scheme_fee_amount,
                transaction_scheme_fee_cost = x.transaction_scheme_fee_cost,
                unitary_estimated_scheme_fee_cost = x.unitary_estimated_scheme_fee_amount
                from (
                    select dsf.app_id,dsf.app_hash_file, rmsf.unitary_scheme_fee_cost,rmsf.estimated_scheme_fee_amount, rmsf.transaction_scheme_fee_cost,rmsf.unitary_estimated_scheme_fee_amount
                    from operational.mh_transaction_scheme_fee dsf 
                    inner join operational.mh_monthly_scheme_fee rmsf
                        on dsf.account_number = rmsf.account_number and
                        dsf.account_funding_source = rmsf.founding_source and
                        dsf.bank_country = rmsf.bank_country_code and
                        dsf.business_mode_id = rmsf.business_mode and
                        dsf.transaction_brand = rmsf.brand and
                        dsf.size_ticket = rmsf.size_ticket and
                        dsf.product_id = rmsf.product_id and
                        dsf.range_program_id = rmsf.range_program_id and
                        dsf.business_transaction_type_id = rmsf.transaction_type and
                        dsf.jurisdiction = rmsf.jurisdiction and
                        dsf.reversal_indicator = rmsf.reversal_indicator and
                        dsf.currency_local_indicator = rmsf.currency_local_indicator and
                        dsf.motoec_indicator = rmsf.card_present_indicator and
                        dsf.merchant_country_code = rmsf.merchant_country_code and
                        dsf.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39; and 
                        dsf.app_customer_code = rmsf.customer_code
                where
                rmsf.report_month = &#39;{month_name}&#39; and
                rmsf.customer_code = &#39;{self.client}&#39;) x where x.app_id = d.app_id and x.app_hash_file = d.app_hash_file 
            &#34;&#34;&#34;
    
    def get_update_sumary(self,rows_updated:str,month_name:str)-&gt;str:
        &#34;&#34;&#34;returns query for update sumary table.

        Args:
            rows_updated (str): rows updated.
            month_name (str): month of report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;update operational.mh_scheme_fee_sumary set number_of_updated_rows = {rows_updated} where report_month = &#39;{month_name}&#39; and  report_client_code = &#39;{self.client}&#39;&#34;</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery"><code class="flex name class">
<span>class <span class="ident">getquery</span></span>
<span>(</span><span>client:str)</span>
</code></dt>
<dd>
<div class="desc"><p>Class to store querys</p>
<h2 id="params">Params</h2>
<p>client (str): client code.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class getquery():
    &#34;&#34;&#34;Class to store querys
    
    Params:
        client (str): client code.
    
    &#34;&#34;&#34;

    def __init__(self,client:str) -&gt; None:
        self.client = client
        pass

    def get_detail_columns(self)-&gt;list:
        &#34;&#34;&#34;Return list of columns to insert/read of the detail of report
        
        Returns:
            list: list of columns.
        &#34;&#34;&#34;
        return  [
            &#39;app_type_file&#39;,
            &#39;app_customer_code&#39; ,
            &#39;app_execution_id&#39; ,
            &#39;scheme_fee_execution_month&#39;,
            &#39;app_id&#39; ,
            &#39;app_hash_file&#39; ,
            &#39;table_description&#39; ,
            &#39;app_processing_date&#39; ,
            &#39;account_number&#39; ,
            &#39;account_funding_source&#39; ,
            &#39;account_range_country&#39; ,
            &#39;product_id&#39; ,
            &#39;range_program_id&#39; ,
            &#39;jurisdiction&#39; ,
            &#39;business_transaction_type_id&#39; ,
            &#39;reversal_indicator&#39; ,
            &#39;currency_local_indicator&#39;,
            &#39;motoec_indicator&#39; ,
            &#39;transaction_count&#39; ,
            &#39;settlement_amount&#39; ,
            &#39;transaction_scheme_fee_cost&#39; ,
            &#39;transaction_brand&#39; ,
            &#39;merchant_country_code&#39;,
            &#39;settlement_currency&#39; ,
            &#39;bank_country&#39; ,
            &#39;business_mode_id&#39; ,
            &#39;size_ticket&#39; ,
            &#39;unitary_scheme_fee_cost&#39; ,
            &#39;estimated_scheme_fee_cost&#39; ,
            &#39;unitary_estimated_scheme_fee_cost&#39; ,
            &#39;transaction_purchase_date&#39;,
        ]
    
    def get_report_columns(self)-&gt;list:
        &#34;&#34;&#34;Return list of columns to insert/read  of report
        
        Returns:
            list: list of columns.
        &#34;&#34;&#34;
        return [
            &#39;report_month&#39;,
            &#39;bank_country_code&#39;,
            &#39;business_mode&#39;,
            &#39;brand&#39;,
            &#39;size_ticket&#39;,
            &#39;product_id&#39;,
            &#39;range_program_id&#39;,
            &#39;founding_source&#39;,
            &#39;transaction_type&#39;,
            &#39;jurisdiction&#39;,
            &#39;reversal_indicator&#39;,
            &#39;currency_local_indicator&#39;,
            &#39;card_present_indicator&#39;,
            &#39;account_number&#39;,
            &#39;merchant_country_code&#39;,
            &#39;transaction_count&#39; ,
            &#39;transaction_amount&#39;,
            &#39;transaction_scheme_fee_cost&#39;,
            &#39;unitary_scheme_fee_cost&#39;,
            &#39;estimated_scheme_fee_amount&#39;,
            &#39;unitary_estimated_scheme_fee_amount&#39; 
        ]

    def validation_conditions(self)-&gt;list:
        &#34;&#34;&#34;Returns list of validation conditions
        
        Returns:
            list: list of conditions.
        &#34;&#34;&#34;
        return [
            &#34;report_amount is null or&#34;,
            &#34;account_range_country is null or&#34;,
            &#34;account_funding_source is null or&#34;,
            &#34;account_number is null or&#34;,
            &#34;jurisdiction is null or&#34;,
            &#34;product_id is null or&#34;,
            &#34;range_program_id is null&#34;,
        ] 

    def temp_table_scheme_fee_transaction(self)-&gt;str:
        &#34;&#34;&#34;creates query for an empty clone transaction table to make all calculations
        
        Returns:
            query (str): generated query. 
        &#34;&#34;&#34;
        query = f&#34;&#34;&#34;select exchange_rate,report_amount,report_currency,{&#34;,&#34;.join(self.get_detail_columns())} 
        from operational.mh_transaction_scheme_fee where app_id = -1 &#34;&#34;&#34;
        return query

    def temp_table_scheme_fee_report(self)-&gt;str:
        &#34;&#34;&#34;creates query for an empty clone report table to make all calculations
        
        Returns:
            str: generated query.
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;select app_id,
                    app_customer_code,
                    app_type_file,
                    app_hash_file,
                    app_processing_date, 
                    app_execution_id,
                    report_currency,
                    customer_code,
                    {&#34;,&#34;.join(self.get_report_columns())} from operational.mh_monthly_scheme_fee where app_id = -1 &#34;&#34;&#34;

    def get_insert_detail(self,columns:list,scheme:str,table:str)-&gt;str:
        &#34;&#34;&#34;Returns basic insert query for detail table
        Args:
            columns (list): list of columns.
            schema (str): schema of table.
            table (str): table name.

        Returns:
            str: generated query.
        &#34;&#34;&#34;
        return f&#34;&#34;&#34; insert into {scheme}.{table} ({&#39;,&#39;.join(columns)})&#34;&#34;&#34;

    def get_issuers_visa(self,formated_date:str,date:str,first_day:str,last_day:str)-&gt;str:
        &#34;&#34;&#34;Returns Query to get issuer transactions of visa
        
        Args:
            formated_date (str): formated date and execution time.
            date (str): year and month of report.
            first_date (str): start of range for report.
            last_day (str): end of range for report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            select 
                t.app_type_file,
                cus.code,
                &#39;{formated_date}&#39;,
                &#39;{date}&#39;,
                t.app_id,
                t.app_hash_file,
                &#39;VISA ISS&#39;,
                t.app_processing_date,
                cast(t.account_number as text),
                case when cf.funding_source in (&#39;C&#39;,&#39;H&#39;,&#39;R&#39;) then &#39;C&#39; when cf.funding_source in(&#39;D&#39;,&#39;P&#39;) then &#39;D&#39; else null end as account_funding_source,
                ardef_country,
                cf.product_id, 
                sfbp.range_program_id,
                jurisdiction,
                btt.transaction_type_id,
                reversal_indicator,
                case when cur.currency_alphabetic_code in (cus.local_currency_code,cus.settlement_currency_code) then 1 else 0 end,
                case when cast(case when trim(motoec_indicator) = &#39;&#39; then &#39;10&#39; else motoec_indicator end as integer) &gt;= 10 then 1 else 0 end,
                1,
                case when collection_only_flag in (&#39;C&#39;) then source_amount else settlement_report_amount end, 
                0,
                &#39;VISA&#39;,
                merchant_country_code,
                case when collection_only_flag in (&#39;C&#39;) then cur.currency_alphabetic_code else settlement_report_currency_code end, 
                cus.customer_country, 
                cf.business_mode,
                0,
                0,
                0,
                0,
                purchase_date
            from 
            operational.dh_visa_transaction t
            inner join operational.dh_visa_transaction_calculated_field cf on t.app_id = cf.app_id and t.app_hash_file = cf.app_hash_file
            inner join control.t_customer cus on cus.code = t.app_customer_code 
            left join operational.m_currency cur on t.source_currency_code = cast(cur.currency_numeric_code as text) 
            left join operational.m_visa_business_transaction_type btt on cast(business_transaction_type_id as integer) = cf.business_transaction_type
            left join operational.m_scheme_fee_bin_products sfbp on trim(sfbp.product_code) = trim(cf.product_id) and sfbp.brand = &#39;VISA&#39;
            where
            t.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39;
            and cf.business_mode = &#39;issuing&#39;
            and btt.transaction_type_id in (&#39;PUR&#39;,&#39;CSH&#39;)
            and t.app_customer_code = &#39;{self.client}&#39;
            and t.transaction_code in (&#39;05&#39;,&#39;06&#39;,&#39;07&#39;,&#39;15&#39;,&#39;16&#39;,&#39;17&#39;,&#39;25&#39;,&#39;26&#39;,&#39;27&#39;,&#39;35&#39;,&#39;36&#39;,&#39;37&#39;)
        &#34;&#34;&#34;

    def get_acquirer_visa(self,formated_date:str,date:str,first_day:str,last_day:str)-&gt;str:
        &#34;&#34;&#34;Returns query to get visa acquiring transactions
        
        Args:
            formated_date (str): formated date and execution time.
            date (str): year and month of report.
            first_date (str): start of range for report.
            last_day (str): end of range for report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            select
                t.app_type_file,
                cus.code,
                &#39;{formated_date}&#39;,
                &#39;{date}&#39;,
                t.app_id,
                t.app_hash_file,
                &#39;VISA ACQ&#39;,
                t.app_processing_date,
                RIGHT(CONCAT(repeat(&#39;0&#39;,9),RTRIM(LTRIM(t.card_acceptor_id))),11) mct_cd,
                case when cf.funding_source in (&#39;C&#39;,&#39;H&#39;,&#39;R&#39;) then &#39;C&#39; when cf.funding_source in(&#39;D&#39;,&#39;P&#39;) then &#39;D&#39; else null end as account_funding_source,
                ardef_country,
                cf.product_id, 
                sfbp.range_program_id,
                jurisdiction,
                btt.transaction_type_id,
                reversal_indicator,
                case when cur.currency_alphabetic_code in (cus.local_currency_code,cus.settlement_currency_code) then 1 else 0 end,
                case when cast(case when trim(motoec_indicator) = &#39;&#39; then &#39;10&#39; else motoec_indicator end as integer) &gt;= 10 then 1 else 0 end,
                1,
                case when collection_only_flag in (&#39;C&#39;) then source_amount else settlement_report_amount end, 
                0,
                &#39;VISA&#39;,
                merchant_country_code,
                case when collection_only_flag in (&#39;C&#39;) then currency_alphabetic_code else settlement_report_currency_code end, 
                cus.customer_country, 
                cf.business_mode,
                0,
                0,
                0,
                0,
                purchase_date
            from
            operational.dh_visa_transaction t
            inner join operational.dh_visa_transaction_calculated_field cf on t.app_id = cf.app_id and t.app_hash_file = cf.app_hash_file     
            inner join control.t_customer cus on cus.code = t.app_customer_code
            left join operational.m_currency cur on t.source_currency_code = cast(cur.currency_numeric_code as text)
            left join operational.m_visa_business_transaction_type btt on cast(business_transaction_type_id as integer) = cf.business_transaction_type
            left join operational.m_scheme_fee_bin_products sfbp on trim(sfbp.product_code) = trim(cf.product_id) and sfbp.brand = &#39;VISA&#39;     
            where
            t.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39;
            and cf.business_mode = &#39;acquiring&#39;
            and btt.transaction_type_id in (&#39;PUR&#39;,&#39;CSH&#39;)
            and t.app_customer_code = &#39;{self.client}&#39;
            and t.transaction_code in (&#39;05&#39;,&#39;06&#39;,&#39;07&#39;,&#39;15&#39;,&#39;16&#39;,&#39;17&#39;,&#39;25&#39;,&#39;26&#39;,&#39;27&#39;,&#39;35&#39;,&#39;36&#39;,&#39;37&#39;)
        &#34;&#34;&#34;

    def get_on_us_visa(self,formated_date:str,date:str,first_day:str,last_day:str)-&gt;str:
        &#34;&#34;&#34;Returns query to get missing on us transactions (issuing on-us, because these are duplicates of acquiring on-us)
        
        Args:
            formated_date (str): formated date and execution time.
            date (str): year and month of report.
            first_date (str): start of range for report.
            last_day (str): end of range for report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return  f&#34;&#34;&#34;
            select
                t.app_type_file,
                cus.code,
                &#39;{formated_date}&#39;,
                &#39;{date}&#39;,
                t.app_id,
                t.app_hash_file,
                &#39;VISA ON US ISS&#39;,
                t.app_processing_date,
                cast(account_number as text) mct_cd,
                case when cf.funding_source in (&#39;C&#39;,&#39;H&#39;,&#39;R&#39;) then &#39;C&#39; when cf.funding_source in(&#39;D&#39;,&#39;P&#39;) then &#39;D&#39; else null end as account_funding_source,
                ardef_country,
                cf.product_id, 
                sfbp.range_program_id,
                jurisdiction,
                btt.transaction_type_id,
                reversal_indicator,
                case when cur.currency_alphabetic_code in (cus.local_currency_code,cus.settlement_currency_code) then 1 else 0 end,
                case when cast(case when trim(motoec_indicator) = &#39;&#39; then &#39;10&#39; else motoec_indicator end as integer) &gt;= 10 then 1 else 0 end,
                1,
                case when collection_only_flag in (&#39;C&#39;) then source_amount else settlement_report_amount end, 
                0,
                &#39;VISA&#39;,
                merchant_country_code,
                case when collection_only_flag in (&#39;C&#39;) then currency_alphabetic_code else settlement_report_currency_code end, 
                cus.customer_country, 
                &#39;issuing&#39;,
                0,
                0,
                0,
                0,
                purchase_date
            from
            operational.dh_visa_transaction t
            inner join operational.dh_visa_transaction_calculated_field cf on t.app_id = cf.app_id and t.app_hash_file = cf.app_hash_file     
            inner join control.t_customer cus on cus.code = t.app_customer_code
            left join operational.m_currency cur on t.source_currency_code = cast(cur.currency_numeric_code as text)
            left join operational.m_visa_business_transaction_type btt on cast(business_transaction_type_id as integer) = cf.business_transaction_type
            left join operational.m_scheme_fee_bin_products sfbp on trim(sfbp.product_code) = trim(cf.product_id) and sfbp.brand = &#39;VISA&#39;     
            where
            t.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39;
            and cf.business_mode = &#39;acquiring&#39;
            and btt.transaction_type_id in (&#39;PUR&#39;,&#39;CSH&#39;)
            and t.app_customer_code = &#39;{self.client}&#39;
            and collection_only_flag in (&#39;C&#39;)
            and t.transaction_code in (&#39;05&#39;,&#39;06&#39;,&#39;07&#39;,&#39;15&#39;,&#39;16&#39;,&#39;17&#39;,&#39;25&#39;,&#39;26&#39;,&#39;27&#39;,&#39;35&#39;,&#39;36&#39;,&#39;37&#39;)
        &#34;&#34;&#34;
    
    def get_sms_visa(self,formated_date:str,date:str,first_day:str,last_day:str)-&gt;str:
        &#34;&#34;&#34;Returns query to get sms visa transactions
        
        Args:
            formated_date (str): formated date and execution time.
            date (str): year and month of report.
            first_date (str):  start of range for report.
            last_day (str): end of range for report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            select 
                sms.app_type_file,
                cus.code,
                &#39;{formated_date}&#39;,
                &#39;{date}&#39;,
                sms.app_id,
                sms.app_hash_file,
                &#39;VISA SMS&#39;,
                sms.app_processing_date,
                left(cast(sms.card_number as text),9),
                case when sms.account_funding_source in (&#39;C&#39;,&#39;H&#39;,&#39;R&#39;) then &#39;C&#39; when sms.account_funding_source in(&#39;D&#39;,&#39;P&#39;) then &#39;D&#39; else null end,
                cast(pan_extended_country_code as text),
                sms.product_id_sms,
                sfbp.range_program_id, 
                jurisdiction,
                btt.transaction_type_id,
                reversal_indicator,
                case when transaction_currency_code = cus.local_currency_code then 1 else 0 END,
                1,
                1,
                settlement_amount,
                0,
                &#39;VISA&#39;,
                card_acceptor_country,
                currency_alphabetic_code,
                cus.customer_country,
                cf.business_mode,
                0,
                0,
                0,
                0,
                local_transaction_date
            from operational.dh_visa_transaction_sms sms
            inner join operational.dh_visa_transaction_sms_calculated_field cf on sms.app_id = cf.app_id and sms.app_hash_file = cf.app_hash_file and sms.app_type_file = cf.app_type_file
            inner join control.t_customer cus on cus.code = sms.app_customer_code
            left join operational.m_currency cur on sms.settlement_currency_code_sms = cast(cur.currency_numeric_code as text)
            left join operational.m_scheme_fee_bin_products sfbp on trim(sfbp.product_code) = trim(sms.product_id_sms) and sfbp.brand = &#39;VISA&#39; 
            left join operational.m_visa_business_transaction_type btt on cast(business_transaction_type_id as integer) = cf.business_transaction_type  
            where 
            sms.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39; 
            and sms.app_customer_code = &#39;{self.client}&#39;
            and cf.business_transaction_type = 22 and business_transaction_cycle &lt; 100
        &#34;&#34;&#34;
    
    def get_transactions_mastercard(self,formated_date:str,date:str,first_day:str,last_day:str)-&gt;str:
        &#34;&#34;&#34;Returns query to get mastercard transactions in general
        
        Args:
            formated_date (str): formated date and execution time.
            date (str): year and month of report.
            first_date (str): start of range for report.
            last_day (str): end of range for report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            select 
                mde.app_type_file,
                cus.code,
                &#39;{formated_date}&#39;,
                &#39;{date}&#39;,
                mde.app_id,
                mde.app_hash_file,
                &#39;MASTERCARD ISS AND ACQ&#39;,
                mde.app_processing_date,
                case when business_mode = &#39;acquiring&#39; then right(lpad(rtrim(ltrim(cast(card_acceptor_id_code as text))),15,&#39;0&#39;),11) when business_mode = &#39;issuing&#39; then left(lpad(cast(pan as text),19,&#39;0&#39;),9) end,
                cf.funding_source,
                iar_country,
                cf.gcms_product_identifier, 
                sfbp.range_program_id,
                cf.jurisdiction, 
                mcbtt.transaction_type_id,
                case when left(message_reversal_indicator,1) = &#39;R&#39; then 1 else 0 end, 
                case when cur.currency_alphabetic_code in (cus.local_currency_code,cus.settlement_currency_code) then 1 else 0 end,
                case when right(pos_entry_mode,1) != &#39;0&#39; then 1 else 0 end as motoec_indicator,
                1,
                settlement_report_amount,
                0,
                &#39;MasterCard&#39;,
                mde.card_acceptor_country_code,
                settlement_report_currency_code,
                cus.customer_country,
                business_mode,
                0,
                0,
                0,
                0,
                date_and_time_local_transaction::date
            from operational.dh_mastercard_data_element mde
            inner join operational.dh_mastercard_calculated_field cf on  mde.app_id = cf.app_id and mde.app_hash_file = cf.app_hash_file
            inner join control.t_customer cus on cus.code = mde.app_customer_code
            left join operational.m_scheme_fee_bin_products sfbp on trim(sfbp.product_code) = trim(cf.gcms_product_identifier) and sfbp.brand = &#39;MC&#39;
            left join operational.m_bin_funding_source lubfs on rng_fnd_id = bin_funding_source_mc_numeric_code
            left join operational.m_mastercard_business_transaction_type mcbtt on business_transaction_type_id = left(processing_code,2) 
            left join operational.m_currency cur on mde.currency_code_transaction = cur.currency_numeric_code
            left join operational.dh_mastercard_exclusion_messages em on em.app_customer_code = mde.app_customer_code and em.source_file_id = cf.mc_file_id and em.source_message_number_id = mde.message_number 
            where mde.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39; 
            and mde.app_customer_code = &#39;{self.client}&#39;
            and app_message_type in (&#39;1240&#39;,&#39;1644&#39;) 
            and settlement_indicator_1 = &#39;M&#39; 
            and left(mc_file_id,3) in (&#39;001&#39;,&#39;002&#39;)
            and cf.gcms_product_identifier is not null
            and em.app_id is null
        &#34;&#34;&#34;

    def get_issuers_on_us_mastercard(self,formated_date:str,date:str,first_day:str,last_day:str)-&gt;str:
        &#34;&#34;&#34;Returns query to get mastercard issuer on-us transactions
        
        Args:
            formated_date (str): formated date and execution time.
            date (str): year and month of report.
            first_date (str): start of range for report.
            last_day (str): end of range for report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            select 
                mde.app_type_file,
                cus.code,
                &#39;{formated_date}&#39;,
                &#39;{date}&#39;,
                mde.app_id,
                mde.app_hash_file,
                &#39;MASTERCARD ON US ISS&#39;,
                mde.app_processing_date,
                left(lpad(cast(pan as text),19,&#39;0&#39;),9),
                cf.funding_source,
                iar_country,
                cf.gcms_product_identifier, 
                sfbp.range_program_id,
                cf.jurisdiction, 
                mcbtt.transaction_type_id,
                case when left(message_reversal_indicator,1) = &#39;R&#39; then 1 else 0 end, 
                case when cur.currency_alphabetic_code in (cus.local_currency_code,cus.settlement_currency_code) then 1 else 0 end,
                case when right(pos_entry_mode,1) != &#39;0&#39; then 1 else 0 end as motoec_indicator,
                1,
                amount_transaction,
                0,
                &#39;MasterCard&#39;,
                mde.card_acceptor_country_code,
                cast(currency_code_transaction as text),
                cus.customer_country,
                &#39;issuing&#39;,
                0,
                0,
                0,
                0,
                date_and_time_local_transaction::date
            from operational.dh_mastercard_data_element mde
            inner join operational.dh_mastercard_calculated_field cf on  mde.app_id = cf.app_id and mde.app_hash_file = cf.app_hash_file
            inner join control.t_customer cus on cus.code = mde.app_customer_code
            left join operational.m_scheme_fee_bin_products sfbp on trim(sfbp.product_code) = trim(cf.gcms_product_identifier) and sfbp.brand = &#39;MC&#39;
            left join operational.m_bin_funding_source lubfs on rng_fnd_id = bin_funding_source_mc_numeric_code
            left join operational.m_mastercard_business_transaction_type mcbtt on business_transaction_type_id = left(processing_code,2) 
            left join operational.m_currency cur on mde.currency_code_transaction = cur.currency_numeric_code
            left join operational.dh_mastercard_exclusion_messages em on em.app_customer_code = mde.app_customer_code and em.source_file_id = cf.mc_file_id and em.source_message_number_id = mde.message_number 
            where mde.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39; 
            and mde.app_customer_code = &#39;{self.client}&#39;
            and app_message_type in (&#39;1240&#39;,&#39;1644&#39;) 
            and settlement_indicator_1 = &#39;C&#39; 
            and left(mc_file_id,3) in (&#39;001&#39;,&#39;002&#39;)
            and cf.gcms_product_identifier is not null
            and em.app_id is null
        &#34;&#34;&#34;

    def get_acquiring_on_us_mastercard(self,formated_date:str,date:str,first_day:str,last_day:str)-&gt;str:
        &#34;&#34;&#34;Returns query to get mastercard acquirer on-us transactions
        
        Args:
            formated_date (str): formated date and execution time.
            date (str): year and month of report.
            first_date (str): start of range for report.
            last_day (str): end of range for report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            select 
                mde.app_type_file,
                cus.code,
                &#39;{formated_date}&#39;,
                &#39;{date}&#39;,
                mde.app_id,
                mde.app_hash_file,
                &#39;MasterCard ON US ACQ&#39;,
                mde.app_processing_date,
                right(lpad(rtrim(ltrim(cast(card_acceptor_id_code as text))),15,&#39;0&#39;),11),
                cf.funding_source,
                iar_country,
                cf.gcms_product_identifier, 
                sfbp.range_program_id,
                cf.jurisdiction, 
                mcbtt.transaction_type_id,
                case when left(message_reversal_indicator,1) = &#39;R&#39; then 1 else 0 end, 
                case when cur.currency_alphabetic_code in (cus.local_currency_code,cus.settlement_currency_code) then 1 else 0 end,
                case when right(pos_entry_mode,1) != &#39;0&#39; then 1 else 0 end as motoec_indicator,
                1,
                amount_transaction,
                0,
                &#39;MasterCard&#39;,
                mde.card_acceptor_country_code,
                cast(currency_code_transaction as text),
                cus.customer_country,
                &#39;acquiring&#39;,
                0,
                0,
                0,
                0,
                date_and_time_local_transaction::date
            from operational.dh_mastercard_data_element mde
            inner join operational.dh_mastercard_calculated_field cf on  mde.app_id = cf.app_id and mde.app_hash_file = cf.app_hash_file
            inner join control.t_customer cus on cus.code = mde.app_customer_code
            left join operational.m_scheme_fee_bin_products sfbp on trim(sfbp.product_code) = trim(cf.gcms_product_identifier) and sfbp.brand = &#39;MC&#39;
            left join operational.m_bin_funding_source lubfs on rng_fnd_id = bin_funding_source_mc_numeric_code
            left join operational.m_mastercard_business_transaction_type mcbtt on business_transaction_type_id = left(processing_code,2) 
            left join operational.m_currency cur on mde.currency_code_transaction = cur.currency_numeric_code
            left join operational.dh_mastercard_exclusion_messages em on em.app_customer_code = mde.app_customer_code and em.source_file_id = cf.mc_file_id and em.source_message_number_id = mde.message_number 
            where mde.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39; 
            and mde.app_customer_code = &#39;{self.client}&#39;
            and app_message_type in (&#39;1240&#39;,&#39;1644&#39;) 
            and settlement_indicator_1 = &#39;C&#39; 
            and left(mc_file_id,3) in (&#39;001&#39;,&#39;002&#39;)
            and cf.gcms_product_identifier is not null
            and em.app_id is null
        &#34;&#34;&#34;
    
    def get_union_query(self,base:str,other_query:list)-&gt;str:
        &#34;&#34;&#34;Returns combination in union query
        
         Args:
            base (str): first part of query.
            other_query (list): list of querys to unify.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        joined = &#34; union &#34;.join(other_query)
        return f&#34;&#34;&#34;{base} {joined}&#34;&#34;&#34;

    def get_exchange_rate_calculation(self,schema:str,table_name:str,first_day:str,last_day:str)-&gt;str:
        &#34;&#34;&#34;Return Query for exchange rate calculations
        
        Args:
            schema (str): schema of table.
            table_name (str): name of table.
            first_date (str): start of range for report.
            last_day (str): end of range for report.

        Returns:
            str: returns query

        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            update {schema}.{table_name} d set exchange_rate = x.exchange_value,
            report_amount = round(case 
                            when x.settlement_currency = x.report_currency_code then x.settlement_amount 
                                else x.settlement_amount * x.exchange_value 
                            end::numeric,2) ,
            report_currency = x.report_currency_code
            from (
                select
                    mc.exchange_value,
                    cus.report_currency_code,
                    tsf.app_id,
                    tsf.app_hash_file,
                    settlement_currency,
                    settlement_amount
                from {schema}.{table_name} tsf
                inner join control.t_customer cus on cus.code = tsf.app_customer_code
                left join operational.dh_exchange_rate mc on tsf.app_processing_date = mc.date 
                        and tsf.transaction_brand = mc.brand 
                        and mc.currency_to = cus.report_currency_code
                        and mc.currency_from = tsf.settlement_currency
                where tsf.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39;
                and tsf.app_customer_code = &#39;{self.client}&#39;) x 
            where x.app_id = d.app_id and x.app_hash_file = d.app_hash_file
        &#34;&#34;&#34;

    def get_rows_w_null_conditions(self,first_day:str,last_day:str,formated_date:str)-&gt;str:
        &#34;&#34;&#34;gets rows with null fields

        Args:
            first_date (str): start of range for report.
            last_day (str): end of range for report.
            formated_date (str): formated date of execution.

        Returns:
            str: returns query 
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            where app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39;
            and app_customer_code = &#39;{self.client}&#39;
            and (
                {&#34; &#34;.join(self.validation_conditions())}
            )
            and app_execution_id = &#39;{formated_date}&#39;
            &#34;&#34;&#34;

    def delete_rows_w_null(self,schema:str,table:str,conditions:str)-&gt;str:
        &#34;&#34;&#34;Deletes rows with null fields
        
        Args:
            schema (str): schema of table.
            table (str): table name.
            conditions (str): conditions query.

        Returns:
            str: returns query 
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;delete from {schema}.{table} {conditions}&#34;&#34;&#34;

    def update_amounts(self,first_day:str,last_day:str)-&gt;str:
        &#34;&#34;&#34;Update null amounts
        
        Args:
            first_date (str): start of range for report.
            last_day (str): end of range for report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return  f&#34;&#34;&#34;
            update operational.mh_transaction_scheme_fee d set
            report_amount = 0
            where app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39;
            and app_customer_code = &#39;{self.client}&#39; and report_amount is null
        &#34;&#34;&#34; 

    def update_size_tickets(self,schema:str,table_name:str,first_day:str,last_day:str)-&gt;str:
        &#34;&#34;&#34;updates size tikets field
        
        Args:
            schema (str): schema of table.
            table_name (str): table name.
            first_date (str): start of range for report.
            last_day (str): end of range for report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            update {schema}.{table_name} d set 
            size_ticket = case when x.size_ticket is not null then x.size_ticket else 0 end
            from (
            select 
            tsf.app_id,
            tsf.app_hash_file,st.app_id size_ticket
            from {schema}.{table_name} tsf
            left join operational.m_size_ticket st on report_amount between st.size_ticket_min and st.size_ticket_max
            where tsf.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39;
            and tsf.app_customer_code = &#39;{self.client}&#39;
            ) 
            x where x.app_id = d.app_id and x.app_hash_file = d.app_hash_file
        &#34;&#34;&#34;

    def update_unknown_range_country(self,formated_date:str)-&gt;str:
        &#34;&#34;&#34;updates account_range_country

        Args:
            formated_date (str): date of execution of file.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            update operational.mh_transaction_scheme_fee d set 
            account_range_country = &#39;UNK&#39;
            where app_execution_id = &#39;{formated_date}&#39; and account_range_country is null
            and app_customer_code = &#39;{self.client}&#39; 
        &#34;&#34;&#34;

    def update_unknown_founding_source(self,formated_date:str)-&gt;str:
        &#34;&#34;&#34;updates account_founding_source
        
        Args:
            formated_date (str): date of execution of file.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            update operational.mh_transaction_scheme_fee d set 
            account_funding_source = &#39;UNK&#39;
            where app_execution_id = &#39;{formated_date}&#39; and account_funding_source is null
            and app_customer_code = &#39;{self.client}&#39; 
        &#34;&#34;&#34;

    def update_unknown_account_range(self,formated_date:str)-&gt;str:
        &#34;&#34;&#34;updates account_number
        
        Args:
            formated_date (str): date of execution of file.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            update operational.mh_transaction_scheme_fee d set 
            account_number = &#39;9999999999999999&#39;
            where app_execution_id = &#39;{formated_date}&#39; and account_number is null
            and app_customer_code = &#39;{self.client}&#39; 
        &#34;&#34;&#34;

    def update_jurisdiction(self,formated_date:str)-&gt;str:
        &#34;&#34;&#34;updates juridiction
        
        Args:
            formated_date (str): date of execution of file.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            update operational.mh_transaction_scheme_fee d set 
            jurisdiction = &#39;UNK&#39;
            where app_execution_id = &#39;{formated_date}&#39; and jurisdiction is null
            and app_customer_code = &#39;{self.client}&#39; and report_amount is null
        &#34;&#34;&#34;

    def update_visa_unk_product(self,formated_date:str)-&gt;str:
        &#34;&#34;&#34;updates the unknown visa products with dummy
        
        Args:
            formated_date (str): date of execution of file.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            update operational.mh_transaction_scheme_fee d set 
            product_id = &#39;UNK&#39;,range_program_id = &#39;UNK&#39;
            where app_execution_id = &#39;{formated_date}&#39; and product_id is null
            and transaction_brand = &#39;VISA&#39;
            and app_customer_code = &#39;{self.client}&#39; and report_amount is null
        &#34;&#34;&#34;
    
    def update_mastercard_unk_product(self,formated_date:str)-&gt;str:
        &#34;&#34;&#34;updates the unknown mastercard products with dummy
        
        Args:
            formated_date (str): date of execution of file.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            update operational.mh_transaction_scheme_fee d set 
            product_id = &#39;UNK&#39;,range_program_id = &#39;UNK&#39;
            where app_execution_id = &#39;{formated_date}&#39; and product_id is null
            and transaction_brand = &#39;MasterCard&#39; 
            and app_customer_code = &#39;{self.client}&#39; and report_amount is null
        &#34;&#34;&#34;

    def update_unk_range_program(self,formated_date:str)-&gt;str:
        &#34;&#34;&#34;updates unknown range program id
        
        Args:
            formated_date (str): date of execution of file.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            update operational.mh_transaction_scheme_fee d set 
            range_program_id = &#39;UNK&#39;
            where app_execution_id = &#39;{formated_date}&#39; and range_program_id is null
            and app_customer_code = &#39;{self.client}&#39; 
        &#34;&#34;&#34;

    def get_insert_into_report_table(self,report_scheme:str,report_table:str,transaction_scheme:str,transaction_table:str,formated_date:str,month_name:str,first_day:str,last_day:str)-&gt;str:
        &#34;&#34;&#34;Returns insertion query for report
        
        Args:
            report_scheme (str): report table schema.
            report_table (str): report table name.
            transaction_scheme (str): transaction table schema.
            transaction_table (str): transaction table name.
            formated_date (str): date of execution of file.
            month_name (str): processing month.
            first_date (str): start of range for report.
            last_day (str): end of range for report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
        insert into {report_scheme}.{report_table} (
            app_execution_id,
            report_month,
            report_currency,
            customer_code,
            bank_country_code,
            business_mode,
            brand,
            size_ticket,
            product_id,
            range_program_id,
            founding_source,
            transaction_type,
            jurisdiction,
            reversal_indicator,
            currency_local_indicator,
            card_present_indicator, 
            account_number,
            merchant_country_code,
            transaction_count,
            transaction_amount,
            transaction_scheme_fee_cost
        )
        select
        &#39;{formated_date}&#39; app_execution_id,&#39;{month_name}&#39; report_month,cus.report_currency_code,cus.code,bank_country,business_mode_id,transaction_brand,size_ticket,product_id,range_program_id,account_funding_source,
        business_transaction_type_id,jurisdiction,reversal_indicator,currency_local_indicator,motoec_indicator,account_number,
        merchant_country_code, sum(transaction_count),sum(report_amount),0
        from {transaction_scheme}.{transaction_table} tsf
        inner join control.t_customer cus on cus.code = tsf.app_customer_code
        where tsf.app_processing_date between  &#39;{first_day}&#39; and &#39;{last_day}&#39;
        and tsf.app_customer_code = &#39;{self.client}&#39; 
        group by 
        app_execution_id,
        cus.report_currency_code,
        cus.code,bank_country,
        report_month,
        business_mode_id,
        transaction_brand,
        size_ticket,
        product_id,
        range_program_id,
        account_funding_source,
        business_transaction_type_id,
        jurisdiction,
        reversal_indicator,
        currency_local_indicator,
        motoec_indicator,
        account_number,
        merchant_country_code
        &#34;&#34;&#34;

    def get_report_extra_columns(self,schema:str,table:str,hash:str,first_day:str)-&gt;str:
        &#34;&#34;&#34;get columns not included in report columns from report table

        Args:
            scheme (str):  table schema.
            table (str):  table name.
            hash (str): hash code of file.
            first_day (str): first day of month.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
                update {schema}.{table} t 
                    set app_id = s.row_num,
                    app_customer_code = &#39;{self.client}&#39;,
                    app_type_file = &#39;report&#39;,
                    app_hash_file=&#39;{hash}&#39;,
                    app_processing_date=&#39;{first_day}&#39;,
                    transaction_scheme_fee_cost = 0,
                    unitary_scheme_fee_cost = 0,
                    estimated_scheme_fee_amount = 0,
                    unitary_estimated_scheme_fee_amount = 0 
                from (select st.*, row_number() over (order by account_number,
                        bank_country_code,
                        business_mode,
                        brand,
                        jurisdiction,
                        founding_source,
                        product_id,
                        range_program_id,
                        transaction_type,
                        reversal_indicator,
                        card_present_indicator,
                        currency_local_indicator,
                        merchant_country_code,
                        size_ticket) as row_num from {schema}.{table} st ) s 
                where 
                s.account_number = t.account_number and
                s.bank_country_code = t.bank_country_code and
                s.business_mode = t.business_mode and
                s.brand = t.brand and
                s.jurisdiction = t.jurisdiction and
                s.founding_source = t.founding_source and
                s.product_id = t.product_id and
                s.range_program_id = t.range_program_id and
                s.transaction_type = t.transaction_type and
                s.reversal_indicator = t.reversal_indicator and
                s.card_present_indicator = t.card_present_indicator and
                s.currency_local_indicator = t.currency_local_indicator and
                s.merchant_country_code = t.merchant_country_code and
                s.size_ticket = t.size_ticket
                &#34;&#34;&#34;
    
    def get_report_query(self,schema:str,table:str,report_columns:list,formated_date:str)-&gt;str:
        &#34;&#34;&#34;Returns query to get report

        Args:
            scheme (str):  table schema.
            table (str):  table name.
            report_columns (list): list of columns for report.
            formated_date (str): execution formated date.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
        select 
        {&#34;,&#34;.join(report_columns)}
        from {schema}.{table} 
        where app_execution_id = &#39;{formated_date}&#39;
        &#34;&#34;&#34;

    def get_delete_detail(self,date:str,execution_id:str)-&gt;str:
        &#34;&#34;&#34;Returns query to delete detail
        
        Args:
            date (str):  month of execution.
            execution_id (str):  execution id.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;delete from operational.mh_transaction_scheme_fee where app_customer_code = &#39;{self.client}&#39; and scheme_fee_execution_month = &#39;{date}&#39; and app_execution_id != &#39;{execution_id}&#39;&#34;

    def get_delete_report(self,month_name:str,execution_id)-&gt;str:
        &#34;&#34;&#34;Returns query to delete report
        
        Args:
            month_name (str):  month of execution.
            execution_id (str):  execution id.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;delete from operational.mh_monthly_scheme_fee where customer_code = &#39;{self.client}&#39; and report_month = &#39;{month_name}&#39; and app_execution_id != &#39;{execution_id}&#39;&#34;

    def get_delete_sumary(self,month_name:str,execution_id)-&gt; str:
        &#34;&#34;&#34;Returns query to delete sumary
        
        Args:
            month_name (str):  month of execution.
            execution_id (str):  execution id.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;delete from operational.mh_scheme_fee_sumary where report_client_code = &#39;{self.client}&#39; and report_month = &#39;{month_name}&#39; and app_execution_id != &#39;{execution_id}&#39;&#34;

    def get_insert_into_sumary(self,formated_date:str,month_name:str,inserted_into_detail:str,inserted_into_header:str,s3_route:str)-&gt;str:
        &#34;&#34;&#34;Returns query to insert into sumary
        
        Args:
            formated_date (str): formated execution date.
            month_name (str):  report month name.
            inserted_into_detail (str): rows inserted.
            inserted_into_header (str): rows inserted.
            s3_route (str): route to output report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
                insert into operational.mh_scheme_fee_sumary 
                (app_execution_id,report_month,report_client_code,number_of_inserted_rows,number_of_groups,number_of_updated_rows,s3_route)
                values(&#39;{formated_date}&#39;,&#39;{month_name}&#39;,&#39;{self.client}&#39;,{inserted_into_detail},{inserted_into_header},0,&#39;{s3_route}&#39;)
                &#34;&#34;&#34;
    
    def get_update_from_temp(self,temp_schem:str,temp_table:str,month_name:str)-&gt;str:
        &#34;&#34;&#34;Returns query to update from temp
        
        Args:
            temp_schem (str): temporal schema.
            temp_table (str): temporal table name.
            month_name (str): nmonth of report.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
            update operational.mh_monthly_scheme_fee sf set
            estimated_scheme_fee_amount = x.estimated_scheme_fee_amount,
            transaction_scheme_fee_cost = x.transaction_scheme_fee_cost,
            unitary_scheme_fee_cost = x.unitary_scheme_fee_cost,
            unitary_estimated_scheme_fee_amount = x.unitary_estimated_scheme_fee_amount
            from (select * from {temp_schem}.{temp_table} where report_month = &#39;{month_name}&#39;) x where
            customer_code = &#39;{self.client}&#39; and
            x.report_month::text = sf.report_month and
            x.bank_country_code = sf.bank_country_code and
            x.business_mode = sf.business_mode and
            x.brand = sf.brand and
            x.size_ticket = sf.size_ticket and
            x.product_id = sf.product_id and
            sf.range_program_id = x.range_program_id and
            x.founding_source = sf.founding_source and
            x.transaction_type =  sf.transaction_type and
            x.jurisdiction = sf.jurisdiction and
            x.reversal_indicator = sf.reversal_indicator and
            x.currency_local_indicator = sf.currency_local_indicator and
            x.card_present_indicator = sf.card_present_indicator and
            x.account_number = sf.account_number and
            x.merchant_country_code = sf.merchant_country_code and
            x.transaction_count = sf.transaction_count
            &#34;&#34;&#34;

    def get_drop_if_exists(self,temp_schem:str,temp_table:str)-&gt;str:
        &#34;&#34;&#34;Returns query to drop temporal if exists

        Args:
            temp_schem (str): temporal schema.
            temp_table (str): temporal table name.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;drop table if exists {temp_schem}.{temp_table}&#34;

    def get_update_detail(self,first_day:str,last_day:str,month_name:str)-&gt;str:
        &#34;&#34;&#34;Returns query to update from temp
        
        Args:
            first_date (str): start of range for report.
            last_day (str): end of range for report.
            month_name (str): month of report.

        Returns:
            str: returns query
        &#34;&#34;&#34;
        return f&#34;&#34;&#34;
                update operational.mh_transaction_scheme_fee d set
                unitary_scheme_fee_cost = x.unitary_scheme_fee_cost,
                estimated_scheme_fee_cost = x.estimated_scheme_fee_amount,
                transaction_scheme_fee_cost = x.transaction_scheme_fee_cost,
                unitary_estimated_scheme_fee_cost = x.unitary_estimated_scheme_fee_amount
                from (
                    select dsf.app_id,dsf.app_hash_file, rmsf.unitary_scheme_fee_cost,rmsf.estimated_scheme_fee_amount, rmsf.transaction_scheme_fee_cost,rmsf.unitary_estimated_scheme_fee_amount
                    from operational.mh_transaction_scheme_fee dsf 
                    inner join operational.mh_monthly_scheme_fee rmsf
                        on dsf.account_number = rmsf.account_number and
                        dsf.account_funding_source = rmsf.founding_source and
                        dsf.bank_country = rmsf.bank_country_code and
                        dsf.business_mode_id = rmsf.business_mode and
                        dsf.transaction_brand = rmsf.brand and
                        dsf.size_ticket = rmsf.size_ticket and
                        dsf.product_id = rmsf.product_id and
                        dsf.range_program_id = rmsf.range_program_id and
                        dsf.business_transaction_type_id = rmsf.transaction_type and
                        dsf.jurisdiction = rmsf.jurisdiction and
                        dsf.reversal_indicator = rmsf.reversal_indicator and
                        dsf.currency_local_indicator = rmsf.currency_local_indicator and
                        dsf.motoec_indicator = rmsf.card_present_indicator and
                        dsf.merchant_country_code = rmsf.merchant_country_code and
                        dsf.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39; and 
                        dsf.app_customer_code = rmsf.customer_code
                where
                rmsf.report_month = &#39;{month_name}&#39; and
                rmsf.customer_code = &#39;{self.client}&#39;) x where x.app_id = d.app_id and x.app_hash_file = d.app_hash_file 
            &#34;&#34;&#34;
    
    def get_update_sumary(self,rows_updated:str,month_name:str)-&gt;str:
        &#34;&#34;&#34;returns query for update sumary table.

        Args:
            rows_updated (str): rows updated.
            month_name (str): month of report.

        Returns:
            str: returns query
        
        &#34;&#34;&#34;
        return f&#34;update operational.mh_scheme_fee_sumary set number_of_updated_rows = {rows_updated} where report_month = &#39;{month_name}&#39; and  report_client_code = &#39;{self.client}&#39;&#34;</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.delete_rows_w_null"><code class="name flex">
<span>def <span class="ident">delete_rows_w_null</span></span>(<span>self, schema:str, table:str, conditions:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>Deletes rows with null fields</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>schema</code></strong> :&ensp;<code>str</code></dt>
<dd>schema of table.</dd>
<dt><strong><code>table</code></strong> :&ensp;<code>str</code></dt>
<dd>table name.</dd>
<dt><strong><code>conditions</code></strong> :&ensp;<code>str</code></dt>
<dd>conditions query.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def delete_rows_w_null(self,schema:str,table:str,conditions:str)-&gt;str:
    &#34;&#34;&#34;Deletes rows with null fields
    
    Args:
        schema (str): schema of table.
        table (str): table name.
        conditions (str): conditions query.

    Returns:
        str: returns query 
    
    &#34;&#34;&#34;
    return f&#34;&#34;&#34;delete from {schema}.{table} {conditions}&#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_acquirer_visa"><code class="name flex">
<span>def <span class="ident">get_acquirer_visa</span></span>(<span>self, formated_date:str, date:str, first_day:str, last_day:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>Returns query to get visa acquiring transactions</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>formated_date</code></strong> :&ensp;<code>str</code></dt>
<dd>formated date and execution time.</dd>
<dt><strong><code>date</code></strong> :&ensp;<code>str</code></dt>
<dd>year and month of report.</dd>
<dt><strong><code>first_date</code></strong> :&ensp;<code>str</code></dt>
<dd>start of range for report.</dd>
<dt><strong><code>last_day</code></strong> :&ensp;<code>str</code></dt>
<dd>end of range for report.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_acquirer_visa(self,formated_date:str,date:str,first_day:str,last_day:str)-&gt;str:
    &#34;&#34;&#34;Returns query to get visa acquiring transactions
    
    Args:
        formated_date (str): formated date and execution time.
        date (str): year and month of report.
        first_date (str): start of range for report.
        last_day (str): end of range for report.

    Returns:
        str: returns query
    
    &#34;&#34;&#34;
    return f&#34;&#34;&#34;
        select
            t.app_type_file,
            cus.code,
            &#39;{formated_date}&#39;,
            &#39;{date}&#39;,
            t.app_id,
            t.app_hash_file,
            &#39;VISA ACQ&#39;,
            t.app_processing_date,
            RIGHT(CONCAT(repeat(&#39;0&#39;,9),RTRIM(LTRIM(t.card_acceptor_id))),11) mct_cd,
            case when cf.funding_source in (&#39;C&#39;,&#39;H&#39;,&#39;R&#39;) then &#39;C&#39; when cf.funding_source in(&#39;D&#39;,&#39;P&#39;) then &#39;D&#39; else null end as account_funding_source,
            ardef_country,
            cf.product_id, 
            sfbp.range_program_id,
            jurisdiction,
            btt.transaction_type_id,
            reversal_indicator,
            case when cur.currency_alphabetic_code in (cus.local_currency_code,cus.settlement_currency_code) then 1 else 0 end,
            case when cast(case when trim(motoec_indicator) = &#39;&#39; then &#39;10&#39; else motoec_indicator end as integer) &gt;= 10 then 1 else 0 end,
            1,
            case when collection_only_flag in (&#39;C&#39;) then source_amount else settlement_report_amount end, 
            0,
            &#39;VISA&#39;,
            merchant_country_code,
            case when collection_only_flag in (&#39;C&#39;) then currency_alphabetic_code else settlement_report_currency_code end, 
            cus.customer_country, 
            cf.business_mode,
            0,
            0,
            0,
            0,
            purchase_date
        from
        operational.dh_visa_transaction t
        inner join operational.dh_visa_transaction_calculated_field cf on t.app_id = cf.app_id and t.app_hash_file = cf.app_hash_file     
        inner join control.t_customer cus on cus.code = t.app_customer_code
        left join operational.m_currency cur on t.source_currency_code = cast(cur.currency_numeric_code as text)
        left join operational.m_visa_business_transaction_type btt on cast(business_transaction_type_id as integer) = cf.business_transaction_type
        left join operational.m_scheme_fee_bin_products sfbp on trim(sfbp.product_code) = trim(cf.product_id) and sfbp.brand = &#39;VISA&#39;     
        where
        t.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39;
        and cf.business_mode = &#39;acquiring&#39;
        and btt.transaction_type_id in (&#39;PUR&#39;,&#39;CSH&#39;)
        and t.app_customer_code = &#39;{self.client}&#39;
        and t.transaction_code in (&#39;05&#39;,&#39;06&#39;,&#39;07&#39;,&#39;15&#39;,&#39;16&#39;,&#39;17&#39;,&#39;25&#39;,&#39;26&#39;,&#39;27&#39;,&#39;35&#39;,&#39;36&#39;,&#39;37&#39;)
    &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_acquiring_on_us_mastercard"><code class="name flex">
<span>def <span class="ident">get_acquiring_on_us_mastercard</span></span>(<span>self, formated_date:str, date:str, first_day:str, last_day:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>Returns query to get mastercard acquirer on-us transactions</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>formated_date</code></strong> :&ensp;<code>str</code></dt>
<dd>formated date and execution time.</dd>
<dt><strong><code>date</code></strong> :&ensp;<code>str</code></dt>
<dd>year and month of report.</dd>
<dt><strong><code>first_date</code></strong> :&ensp;<code>str</code></dt>
<dd>start of range for report.</dd>
<dt><strong><code>last_day</code></strong> :&ensp;<code>str</code></dt>
<dd>end of range for report.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_acquiring_on_us_mastercard(self,formated_date:str,date:str,first_day:str,last_day:str)-&gt;str:
    &#34;&#34;&#34;Returns query to get mastercard acquirer on-us transactions
    
    Args:
        formated_date (str): formated date and execution time.
        date (str): year and month of report.
        first_date (str): start of range for report.
        last_day (str): end of range for report.

    Returns:
        str: returns query
    
    &#34;&#34;&#34;
    return f&#34;&#34;&#34;
        select 
            mde.app_type_file,
            cus.code,
            &#39;{formated_date}&#39;,
            &#39;{date}&#39;,
            mde.app_id,
            mde.app_hash_file,
            &#39;MasterCard ON US ACQ&#39;,
            mde.app_processing_date,
            right(lpad(rtrim(ltrim(cast(card_acceptor_id_code as text))),15,&#39;0&#39;),11),
            cf.funding_source,
            iar_country,
            cf.gcms_product_identifier, 
            sfbp.range_program_id,
            cf.jurisdiction, 
            mcbtt.transaction_type_id,
            case when left(message_reversal_indicator,1) = &#39;R&#39; then 1 else 0 end, 
            case when cur.currency_alphabetic_code in (cus.local_currency_code,cus.settlement_currency_code) then 1 else 0 end,
            case when right(pos_entry_mode,1) != &#39;0&#39; then 1 else 0 end as motoec_indicator,
            1,
            amount_transaction,
            0,
            &#39;MasterCard&#39;,
            mde.card_acceptor_country_code,
            cast(currency_code_transaction as text),
            cus.customer_country,
            &#39;acquiring&#39;,
            0,
            0,
            0,
            0,
            date_and_time_local_transaction::date
        from operational.dh_mastercard_data_element mde
        inner join operational.dh_mastercard_calculated_field cf on  mde.app_id = cf.app_id and mde.app_hash_file = cf.app_hash_file
        inner join control.t_customer cus on cus.code = mde.app_customer_code
        left join operational.m_scheme_fee_bin_products sfbp on trim(sfbp.product_code) = trim(cf.gcms_product_identifier) and sfbp.brand = &#39;MC&#39;
        left join operational.m_bin_funding_source lubfs on rng_fnd_id = bin_funding_source_mc_numeric_code
        left join operational.m_mastercard_business_transaction_type mcbtt on business_transaction_type_id = left(processing_code,2) 
        left join operational.m_currency cur on mde.currency_code_transaction = cur.currency_numeric_code
        left join operational.dh_mastercard_exclusion_messages em on em.app_customer_code = mde.app_customer_code and em.source_file_id = cf.mc_file_id and em.source_message_number_id = mde.message_number 
        where mde.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39; 
        and mde.app_customer_code = &#39;{self.client}&#39;
        and app_message_type in (&#39;1240&#39;,&#39;1644&#39;) 
        and settlement_indicator_1 = &#39;C&#39; 
        and left(mc_file_id,3) in (&#39;001&#39;,&#39;002&#39;)
        and cf.gcms_product_identifier is not null
        and em.app_id is null
    &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_delete_detail"><code class="name flex">
<span>def <span class="ident">get_delete_detail</span></span>(<span>self, date:str, execution_id:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>Returns query to delete detail</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>date</code></strong> :&ensp;<code>str</code></dt>
<dd>month of execution.</dd>
<dt><strong><code>execution_id</code></strong> :&ensp;<code>str</code></dt>
<dd>execution id.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_delete_detail(self,date:str,execution_id:str)-&gt;str:
    &#34;&#34;&#34;Returns query to delete detail
    
    Args:
        date (str):  month of execution.
        execution_id (str):  execution id.

    Returns:
        str: returns query
    
    &#34;&#34;&#34;
    return f&#34;delete from operational.mh_transaction_scheme_fee where app_customer_code = &#39;{self.client}&#39; and scheme_fee_execution_month = &#39;{date}&#39; and app_execution_id != &#39;{execution_id}&#39;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_delete_report"><code class="name flex">
<span>def <span class="ident">get_delete_report</span></span>(<span>self, month_name:str, execution_id) >str</span>
</code></dt>
<dd>
<div class="desc"><p>Returns query to delete report</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>month_name</code></strong> :&ensp;<code>str</code></dt>
<dd>month of execution.</dd>
<dt><strong><code>execution_id</code></strong> :&ensp;<code>str</code></dt>
<dd>execution id.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_delete_report(self,month_name:str,execution_id)-&gt;str:
    &#34;&#34;&#34;Returns query to delete report
    
    Args:
        month_name (str):  month of execution.
        execution_id (str):  execution id.

    Returns:
        str: returns query
    &#34;&#34;&#34;
    return f&#34;delete from operational.mh_monthly_scheme_fee where customer_code = &#39;{self.client}&#39; and report_month = &#39;{month_name}&#39; and app_execution_id != &#39;{execution_id}&#39;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_delete_sumary"><code class="name flex">
<span>def <span class="ident">get_delete_sumary</span></span>(<span>self, month_name:str, execution_id) >str</span>
</code></dt>
<dd>
<div class="desc"><p>Returns query to delete sumary</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>month_name</code></strong> :&ensp;<code>str</code></dt>
<dd>month of execution.</dd>
<dt><strong><code>execution_id</code></strong> :&ensp;<code>str</code></dt>
<dd>execution id.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_delete_sumary(self,month_name:str,execution_id)-&gt; str:
    &#34;&#34;&#34;Returns query to delete sumary
    
    Args:
        month_name (str):  month of execution.
        execution_id (str):  execution id.

    Returns:
        str: returns query
    
    &#34;&#34;&#34;
    return f&#34;delete from operational.mh_scheme_fee_sumary where report_client_code = &#39;{self.client}&#39; and report_month = &#39;{month_name}&#39; and app_execution_id != &#39;{execution_id}&#39;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_detail_columns"><code class="name flex">
<span>def <span class="ident">get_detail_columns</span></span>(<span>self) >list</span>
</code></dt>
<dd>
<div class="desc"><p>Return list of columns to insert/read of the detail of report</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>list</code></dt>
<dd>list of columns.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_detail_columns(self)-&gt;list:
    &#34;&#34;&#34;Return list of columns to insert/read of the detail of report
    
    Returns:
        list: list of columns.
    &#34;&#34;&#34;
    return  [
        &#39;app_type_file&#39;,
        &#39;app_customer_code&#39; ,
        &#39;app_execution_id&#39; ,
        &#39;scheme_fee_execution_month&#39;,
        &#39;app_id&#39; ,
        &#39;app_hash_file&#39; ,
        &#39;table_description&#39; ,
        &#39;app_processing_date&#39; ,
        &#39;account_number&#39; ,
        &#39;account_funding_source&#39; ,
        &#39;account_range_country&#39; ,
        &#39;product_id&#39; ,
        &#39;range_program_id&#39; ,
        &#39;jurisdiction&#39; ,
        &#39;business_transaction_type_id&#39; ,
        &#39;reversal_indicator&#39; ,
        &#39;currency_local_indicator&#39;,
        &#39;motoec_indicator&#39; ,
        &#39;transaction_count&#39; ,
        &#39;settlement_amount&#39; ,
        &#39;transaction_scheme_fee_cost&#39; ,
        &#39;transaction_brand&#39; ,
        &#39;merchant_country_code&#39;,
        &#39;settlement_currency&#39; ,
        &#39;bank_country&#39; ,
        &#39;business_mode_id&#39; ,
        &#39;size_ticket&#39; ,
        &#39;unitary_scheme_fee_cost&#39; ,
        &#39;estimated_scheme_fee_cost&#39; ,
        &#39;unitary_estimated_scheme_fee_cost&#39; ,
        &#39;transaction_purchase_date&#39;,
    ]</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_drop_if_exists"><code class="name flex">
<span>def <span class="ident">get_drop_if_exists</span></span>(<span>self, temp_schem:str, temp_table:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>Returns query to drop temporal if exists</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>temp_schem</code></strong> :&ensp;<code>str</code></dt>
<dd>temporal schema.</dd>
<dt><strong><code>temp_table</code></strong> :&ensp;<code>str</code></dt>
<dd>temporal table name.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_drop_if_exists(self,temp_schem:str,temp_table:str)-&gt;str:
    &#34;&#34;&#34;Returns query to drop temporal if exists

    Args:
        temp_schem (str): temporal schema.
        temp_table (str): temporal table name.

    Returns:
        str: returns query
    &#34;&#34;&#34;
    return f&#34;drop table if exists {temp_schem}.{temp_table}&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_exchange_rate_calculation"><code class="name flex">
<span>def <span class="ident">get_exchange_rate_calculation</span></span>(<span>self, schema:str, table_name:str, first_day:str, last_day:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>Return Query for exchange rate calculations</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>schema</code></strong> :&ensp;<code>str</code></dt>
<dd>schema of table.</dd>
<dt><strong><code>table_name</code></strong> :&ensp;<code>str</code></dt>
<dd>name of table.</dd>
<dt><strong><code>first_date</code></strong> :&ensp;<code>str</code></dt>
<dd>start of range for report.</dd>
<dt><strong><code>last_day</code></strong> :&ensp;<code>str</code></dt>
<dd>end of range for report.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_exchange_rate_calculation(self,schema:str,table_name:str,first_day:str,last_day:str)-&gt;str:
    &#34;&#34;&#34;Return Query for exchange rate calculations
    
    Args:
        schema (str): schema of table.
        table_name (str): name of table.
        first_date (str): start of range for report.
        last_day (str): end of range for report.

    Returns:
        str: returns query

    &#34;&#34;&#34;
    return f&#34;&#34;&#34;
        update {schema}.{table_name} d set exchange_rate = x.exchange_value,
        report_amount = round(case 
                        when x.settlement_currency = x.report_currency_code then x.settlement_amount 
                            else x.settlement_amount * x.exchange_value 
                        end::numeric,2) ,
        report_currency = x.report_currency_code
        from (
            select
                mc.exchange_value,
                cus.report_currency_code,
                tsf.app_id,
                tsf.app_hash_file,
                settlement_currency,
                settlement_amount
            from {schema}.{table_name} tsf
            inner join control.t_customer cus on cus.code = tsf.app_customer_code
            left join operational.dh_exchange_rate mc on tsf.app_processing_date = mc.date 
                    and tsf.transaction_brand = mc.brand 
                    and mc.currency_to = cus.report_currency_code
                    and mc.currency_from = tsf.settlement_currency
            where tsf.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39;
            and tsf.app_customer_code = &#39;{self.client}&#39;) x 
        where x.app_id = d.app_id and x.app_hash_file = d.app_hash_file
    &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_insert_detail"><code class="name flex">
<span>def <span class="ident">get_insert_detail</span></span>(<span>self, columns:list, scheme:str, table:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>Returns basic insert query for detail table</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>columns</code></strong> :&ensp;<code>list</code></dt>
<dd>list of columns.</dd>
<dt><strong><code>schema</code></strong> :&ensp;<code>str</code></dt>
<dd>schema of table.</dd>
<dt><strong><code>table</code></strong> :&ensp;<code>str</code></dt>
<dd>table name.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>generated query.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_insert_detail(self,columns:list,scheme:str,table:str)-&gt;str:
    &#34;&#34;&#34;Returns basic insert query for detail table
    Args:
        columns (list): list of columns.
        schema (str): schema of table.
        table (str): table name.

    Returns:
        str: generated query.
    &#34;&#34;&#34;
    return f&#34;&#34;&#34; insert into {scheme}.{table} ({&#39;,&#39;.join(columns)})&#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_insert_into_report_table"><code class="name flex">
<span>def <span class="ident">get_insert_into_report_table</span></span>(<span>self, report_scheme:str, report_table:str, transaction_scheme:str, transaction_table:str, formated_date:str, month_name:str, first_day:str, last_day:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>Returns insertion query for report</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>report_scheme</code></strong> :&ensp;<code>str</code></dt>
<dd>report table schema.</dd>
<dt><strong><code>report_table</code></strong> :&ensp;<code>str</code></dt>
<dd>report table name.</dd>
<dt><strong><code>transaction_scheme</code></strong> :&ensp;<code>str</code></dt>
<dd>transaction table schema.</dd>
<dt><strong><code>transaction_table</code></strong> :&ensp;<code>str</code></dt>
<dd>transaction table name.</dd>
<dt><strong><code>formated_date</code></strong> :&ensp;<code>str</code></dt>
<dd>date of execution of file.</dd>
<dt><strong><code>month_name</code></strong> :&ensp;<code>str</code></dt>
<dd>processing month.</dd>
<dt><strong><code>first_date</code></strong> :&ensp;<code>str</code></dt>
<dd>start of range for report.</dd>
<dt><strong><code>last_day</code></strong> :&ensp;<code>str</code></dt>
<dd>end of range for report.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_insert_into_report_table(self,report_scheme:str,report_table:str,transaction_scheme:str,transaction_table:str,formated_date:str,month_name:str,first_day:str,last_day:str)-&gt;str:
    &#34;&#34;&#34;Returns insertion query for report
    
    Args:
        report_scheme (str): report table schema.
        report_table (str): report table name.
        transaction_scheme (str): transaction table schema.
        transaction_table (str): transaction table name.
        formated_date (str): date of execution of file.
        month_name (str): processing month.
        first_date (str): start of range for report.
        last_day (str): end of range for report.

    Returns:
        str: returns query
    
    &#34;&#34;&#34;
    return f&#34;&#34;&#34;
    insert into {report_scheme}.{report_table} (
        app_execution_id,
        report_month,
        report_currency,
        customer_code,
        bank_country_code,
        business_mode,
        brand,
        size_ticket,
        product_id,
        range_program_id,
        founding_source,
        transaction_type,
        jurisdiction,
        reversal_indicator,
        currency_local_indicator,
        card_present_indicator, 
        account_number,
        merchant_country_code,
        transaction_count,
        transaction_amount,
        transaction_scheme_fee_cost
    )
    select
    &#39;{formated_date}&#39; app_execution_id,&#39;{month_name}&#39; report_month,cus.report_currency_code,cus.code,bank_country,business_mode_id,transaction_brand,size_ticket,product_id,range_program_id,account_funding_source,
    business_transaction_type_id,jurisdiction,reversal_indicator,currency_local_indicator,motoec_indicator,account_number,
    merchant_country_code, sum(transaction_count),sum(report_amount),0
    from {transaction_scheme}.{transaction_table} tsf
    inner join control.t_customer cus on cus.code = tsf.app_customer_code
    where tsf.app_processing_date between  &#39;{first_day}&#39; and &#39;{last_day}&#39;
    and tsf.app_customer_code = &#39;{self.client}&#39; 
    group by 
    app_execution_id,
    cus.report_currency_code,
    cus.code,bank_country,
    report_month,
    business_mode_id,
    transaction_brand,
    size_ticket,
    product_id,
    range_program_id,
    account_funding_source,
    business_transaction_type_id,
    jurisdiction,
    reversal_indicator,
    currency_local_indicator,
    motoec_indicator,
    account_number,
    merchant_country_code
    &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_insert_into_sumary"><code class="name flex">
<span>def <span class="ident">get_insert_into_sumary</span></span>(<span>self, formated_date:str, month_name:str, inserted_into_detail:str, inserted_into_header:str, s3_route:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>Returns query to insert into sumary</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>formated_date</code></strong> :&ensp;<code>str</code></dt>
<dd>formated execution date.</dd>
<dt><strong><code>month_name</code></strong> :&ensp;<code>str</code></dt>
<dd>report month name.</dd>
<dt><strong><code>inserted_into_detail</code></strong> :&ensp;<code>str</code></dt>
<dd>rows inserted.</dd>
<dt><strong><code>inserted_into_header</code></strong> :&ensp;<code>str</code></dt>
<dd>rows inserted.</dd>
<dt><strong><code>s3_route</code></strong> :&ensp;<code>str</code></dt>
<dd>route to output report.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_insert_into_sumary(self,formated_date:str,month_name:str,inserted_into_detail:str,inserted_into_header:str,s3_route:str)-&gt;str:
    &#34;&#34;&#34;Returns query to insert into sumary
    
    Args:
        formated_date (str): formated execution date.
        month_name (str):  report month name.
        inserted_into_detail (str): rows inserted.
        inserted_into_header (str): rows inserted.
        s3_route (str): route to output report.

    Returns:
        str: returns query
    
    &#34;&#34;&#34;
    return f&#34;&#34;&#34;
            insert into operational.mh_scheme_fee_sumary 
            (app_execution_id,report_month,report_client_code,number_of_inserted_rows,number_of_groups,number_of_updated_rows,s3_route)
            values(&#39;{formated_date}&#39;,&#39;{month_name}&#39;,&#39;{self.client}&#39;,{inserted_into_detail},{inserted_into_header},0,&#39;{s3_route}&#39;)
            &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_issuers_on_us_mastercard"><code class="name flex">
<span>def <span class="ident">get_issuers_on_us_mastercard</span></span>(<span>self, formated_date:str, date:str, first_day:str, last_day:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>Returns query to get mastercard issuer on-us transactions</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>formated_date</code></strong> :&ensp;<code>str</code></dt>
<dd>formated date and execution time.</dd>
<dt><strong><code>date</code></strong> :&ensp;<code>str</code></dt>
<dd>year and month of report.</dd>
<dt><strong><code>first_date</code></strong> :&ensp;<code>str</code></dt>
<dd>start of range for report.</dd>
<dt><strong><code>last_day</code></strong> :&ensp;<code>str</code></dt>
<dd>end of range for report.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_issuers_on_us_mastercard(self,formated_date:str,date:str,first_day:str,last_day:str)-&gt;str:
    &#34;&#34;&#34;Returns query to get mastercard issuer on-us transactions
    
    Args:
        formated_date (str): formated date and execution time.
        date (str): year and month of report.
        first_date (str): start of range for report.
        last_day (str): end of range for report.

    Returns:
        str: returns query
    
    &#34;&#34;&#34;
    return f&#34;&#34;&#34;
        select 
            mde.app_type_file,
            cus.code,
            &#39;{formated_date}&#39;,
            &#39;{date}&#39;,
            mde.app_id,
            mde.app_hash_file,
            &#39;MASTERCARD ON US ISS&#39;,
            mde.app_processing_date,
            left(lpad(cast(pan as text),19,&#39;0&#39;),9),
            cf.funding_source,
            iar_country,
            cf.gcms_product_identifier, 
            sfbp.range_program_id,
            cf.jurisdiction, 
            mcbtt.transaction_type_id,
            case when left(message_reversal_indicator,1) = &#39;R&#39; then 1 else 0 end, 
            case when cur.currency_alphabetic_code in (cus.local_currency_code,cus.settlement_currency_code) then 1 else 0 end,
            case when right(pos_entry_mode,1) != &#39;0&#39; then 1 else 0 end as motoec_indicator,
            1,
            amount_transaction,
            0,
            &#39;MasterCard&#39;,
            mde.card_acceptor_country_code,
            cast(currency_code_transaction as text),
            cus.customer_country,
            &#39;issuing&#39;,
            0,
            0,
            0,
            0,
            date_and_time_local_transaction::date
        from operational.dh_mastercard_data_element mde
        inner join operational.dh_mastercard_calculated_field cf on  mde.app_id = cf.app_id and mde.app_hash_file = cf.app_hash_file
        inner join control.t_customer cus on cus.code = mde.app_customer_code
        left join operational.m_scheme_fee_bin_products sfbp on trim(sfbp.product_code) = trim(cf.gcms_product_identifier) and sfbp.brand = &#39;MC&#39;
        left join operational.m_bin_funding_source lubfs on rng_fnd_id = bin_funding_source_mc_numeric_code
        left join operational.m_mastercard_business_transaction_type mcbtt on business_transaction_type_id = left(processing_code,2) 
        left join operational.m_currency cur on mde.currency_code_transaction = cur.currency_numeric_code
        left join operational.dh_mastercard_exclusion_messages em on em.app_customer_code = mde.app_customer_code and em.source_file_id = cf.mc_file_id and em.source_message_number_id = mde.message_number 
        where mde.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39; 
        and mde.app_customer_code = &#39;{self.client}&#39;
        and app_message_type in (&#39;1240&#39;,&#39;1644&#39;) 
        and settlement_indicator_1 = &#39;C&#39; 
        and left(mc_file_id,3) in (&#39;001&#39;,&#39;002&#39;)
        and cf.gcms_product_identifier is not null
        and em.app_id is null
    &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_issuers_visa"><code class="name flex">
<span>def <span class="ident">get_issuers_visa</span></span>(<span>self, formated_date:str, date:str, first_day:str, last_day:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>Returns Query to get issuer transactions of visa</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>formated_date</code></strong> :&ensp;<code>str</code></dt>
<dd>formated date and execution time.</dd>
<dt><strong><code>date</code></strong> :&ensp;<code>str</code></dt>
<dd>year and month of report.</dd>
<dt><strong><code>first_date</code></strong> :&ensp;<code>str</code></dt>
<dd>start of range for report.</dd>
<dt><strong><code>last_day</code></strong> :&ensp;<code>str</code></dt>
<dd>end of range for report.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_issuers_visa(self,formated_date:str,date:str,first_day:str,last_day:str)-&gt;str:
    &#34;&#34;&#34;Returns Query to get issuer transactions of visa
    
    Args:
        formated_date (str): formated date and execution time.
        date (str): year and month of report.
        first_date (str): start of range for report.
        last_day (str): end of range for report.

    Returns:
        str: returns query
    
    &#34;&#34;&#34;
    return f&#34;&#34;&#34;
        select 
            t.app_type_file,
            cus.code,
            &#39;{formated_date}&#39;,
            &#39;{date}&#39;,
            t.app_id,
            t.app_hash_file,
            &#39;VISA ISS&#39;,
            t.app_processing_date,
            cast(t.account_number as text),
            case when cf.funding_source in (&#39;C&#39;,&#39;H&#39;,&#39;R&#39;) then &#39;C&#39; when cf.funding_source in(&#39;D&#39;,&#39;P&#39;) then &#39;D&#39; else null end as account_funding_source,
            ardef_country,
            cf.product_id, 
            sfbp.range_program_id,
            jurisdiction,
            btt.transaction_type_id,
            reversal_indicator,
            case when cur.currency_alphabetic_code in (cus.local_currency_code,cus.settlement_currency_code) then 1 else 0 end,
            case when cast(case when trim(motoec_indicator) = &#39;&#39; then &#39;10&#39; else motoec_indicator end as integer) &gt;= 10 then 1 else 0 end,
            1,
            case when collection_only_flag in (&#39;C&#39;) then source_amount else settlement_report_amount end, 
            0,
            &#39;VISA&#39;,
            merchant_country_code,
            case when collection_only_flag in (&#39;C&#39;) then cur.currency_alphabetic_code else settlement_report_currency_code end, 
            cus.customer_country, 
            cf.business_mode,
            0,
            0,
            0,
            0,
            purchase_date
        from 
        operational.dh_visa_transaction t
        inner join operational.dh_visa_transaction_calculated_field cf on t.app_id = cf.app_id and t.app_hash_file = cf.app_hash_file
        inner join control.t_customer cus on cus.code = t.app_customer_code 
        left join operational.m_currency cur on t.source_currency_code = cast(cur.currency_numeric_code as text) 
        left join operational.m_visa_business_transaction_type btt on cast(business_transaction_type_id as integer) = cf.business_transaction_type
        left join operational.m_scheme_fee_bin_products sfbp on trim(sfbp.product_code) = trim(cf.product_id) and sfbp.brand = &#39;VISA&#39;
        where
        t.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39;
        and cf.business_mode = &#39;issuing&#39;
        and btt.transaction_type_id in (&#39;PUR&#39;,&#39;CSH&#39;)
        and t.app_customer_code = &#39;{self.client}&#39;
        and t.transaction_code in (&#39;05&#39;,&#39;06&#39;,&#39;07&#39;,&#39;15&#39;,&#39;16&#39;,&#39;17&#39;,&#39;25&#39;,&#39;26&#39;,&#39;27&#39;,&#39;35&#39;,&#39;36&#39;,&#39;37&#39;)
    &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_on_us_visa"><code class="name flex">
<span>def <span class="ident">get_on_us_visa</span></span>(<span>self, formated_date:str, date:str, first_day:str, last_day:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>Returns query to get missing on us transactions (issuing on-us, because these are duplicates of acquiring on-us)</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>formated_date</code></strong> :&ensp;<code>str</code></dt>
<dd>formated date and execution time.</dd>
<dt><strong><code>date</code></strong> :&ensp;<code>str</code></dt>
<dd>year and month of report.</dd>
<dt><strong><code>first_date</code></strong> :&ensp;<code>str</code></dt>
<dd>start of range for report.</dd>
<dt><strong><code>last_day</code></strong> :&ensp;<code>str</code></dt>
<dd>end of range for report.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_on_us_visa(self,formated_date:str,date:str,first_day:str,last_day:str)-&gt;str:
    &#34;&#34;&#34;Returns query to get missing on us transactions (issuing on-us, because these are duplicates of acquiring on-us)
    
    Args:
        formated_date (str): formated date and execution time.
        date (str): year and month of report.
        first_date (str): start of range for report.
        last_day (str): end of range for report.

    Returns:
        str: returns query
    
    &#34;&#34;&#34;
    return  f&#34;&#34;&#34;
        select
            t.app_type_file,
            cus.code,
            &#39;{formated_date}&#39;,
            &#39;{date}&#39;,
            t.app_id,
            t.app_hash_file,
            &#39;VISA ON US ISS&#39;,
            t.app_processing_date,
            cast(account_number as text) mct_cd,
            case when cf.funding_source in (&#39;C&#39;,&#39;H&#39;,&#39;R&#39;) then &#39;C&#39; when cf.funding_source in(&#39;D&#39;,&#39;P&#39;) then &#39;D&#39; else null end as account_funding_source,
            ardef_country,
            cf.product_id, 
            sfbp.range_program_id,
            jurisdiction,
            btt.transaction_type_id,
            reversal_indicator,
            case when cur.currency_alphabetic_code in (cus.local_currency_code,cus.settlement_currency_code) then 1 else 0 end,
            case when cast(case when trim(motoec_indicator) = &#39;&#39; then &#39;10&#39; else motoec_indicator end as integer) &gt;= 10 then 1 else 0 end,
            1,
            case when collection_only_flag in (&#39;C&#39;) then source_amount else settlement_report_amount end, 
            0,
            &#39;VISA&#39;,
            merchant_country_code,
            case when collection_only_flag in (&#39;C&#39;) then currency_alphabetic_code else settlement_report_currency_code end, 
            cus.customer_country, 
            &#39;issuing&#39;,
            0,
            0,
            0,
            0,
            purchase_date
        from
        operational.dh_visa_transaction t
        inner join operational.dh_visa_transaction_calculated_field cf on t.app_id = cf.app_id and t.app_hash_file = cf.app_hash_file     
        inner join control.t_customer cus on cus.code = t.app_customer_code
        left join operational.m_currency cur on t.source_currency_code = cast(cur.currency_numeric_code as text)
        left join operational.m_visa_business_transaction_type btt on cast(business_transaction_type_id as integer) = cf.business_transaction_type
        left join operational.m_scheme_fee_bin_products sfbp on trim(sfbp.product_code) = trim(cf.product_id) and sfbp.brand = &#39;VISA&#39;     
        where
        t.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39;
        and cf.business_mode = &#39;acquiring&#39;
        and btt.transaction_type_id in (&#39;PUR&#39;,&#39;CSH&#39;)
        and t.app_customer_code = &#39;{self.client}&#39;
        and collection_only_flag in (&#39;C&#39;)
        and t.transaction_code in (&#39;05&#39;,&#39;06&#39;,&#39;07&#39;,&#39;15&#39;,&#39;16&#39;,&#39;17&#39;,&#39;25&#39;,&#39;26&#39;,&#39;27&#39;,&#39;35&#39;,&#39;36&#39;,&#39;37&#39;)
    &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_report_columns"><code class="name flex">
<span>def <span class="ident">get_report_columns</span></span>(<span>self) >list</span>
</code></dt>
<dd>
<div class="desc"><p>Return list of columns to insert/read
of report</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>list</code></dt>
<dd>list of columns.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_report_columns(self)-&gt;list:
    &#34;&#34;&#34;Return list of columns to insert/read  of report
    
    Returns:
        list: list of columns.
    &#34;&#34;&#34;
    return [
        &#39;report_month&#39;,
        &#39;bank_country_code&#39;,
        &#39;business_mode&#39;,
        &#39;brand&#39;,
        &#39;size_ticket&#39;,
        &#39;product_id&#39;,
        &#39;range_program_id&#39;,
        &#39;founding_source&#39;,
        &#39;transaction_type&#39;,
        &#39;jurisdiction&#39;,
        &#39;reversal_indicator&#39;,
        &#39;currency_local_indicator&#39;,
        &#39;card_present_indicator&#39;,
        &#39;account_number&#39;,
        &#39;merchant_country_code&#39;,
        &#39;transaction_count&#39; ,
        &#39;transaction_amount&#39;,
        &#39;transaction_scheme_fee_cost&#39;,
        &#39;unitary_scheme_fee_cost&#39;,
        &#39;estimated_scheme_fee_amount&#39;,
        &#39;unitary_estimated_scheme_fee_amount&#39; 
    ]</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_report_extra_columns"><code class="name flex">
<span>def <span class="ident">get_report_extra_columns</span></span>(<span>self, schema:str, table:str, hash:str, first_day:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>get columns not included in report columns from report table</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>scheme</code></strong> :&ensp;<code>str</code></dt>
<dd>table schema.</dd>
<dt><strong><code>table</code></strong> :&ensp;<code>str</code></dt>
<dd>table name.</dd>
<dt><strong><code>hash</code></strong> :&ensp;<code>str</code></dt>
<dd>hash code of file.</dd>
<dt><strong><code>first_day</code></strong> :&ensp;<code>str</code></dt>
<dd>first day of month.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_report_extra_columns(self,schema:str,table:str,hash:str,first_day:str)-&gt;str:
    &#34;&#34;&#34;get columns not included in report columns from report table

    Args:
        scheme (str):  table schema.
        table (str):  table name.
        hash (str): hash code of file.
        first_day (str): first day of month.

    Returns:
        str: returns query
    &#34;&#34;&#34;
    return f&#34;&#34;&#34;
            update {schema}.{table} t 
                set app_id = s.row_num,
                app_customer_code = &#39;{self.client}&#39;,
                app_type_file = &#39;report&#39;,
                app_hash_file=&#39;{hash}&#39;,
                app_processing_date=&#39;{first_day}&#39;,
                transaction_scheme_fee_cost = 0,
                unitary_scheme_fee_cost = 0,
                estimated_scheme_fee_amount = 0,
                unitary_estimated_scheme_fee_amount = 0 
            from (select st.*, row_number() over (order by account_number,
                    bank_country_code,
                    business_mode,
                    brand,
                    jurisdiction,
                    founding_source,
                    product_id,
                    range_program_id,
                    transaction_type,
                    reversal_indicator,
                    card_present_indicator,
                    currency_local_indicator,
                    merchant_country_code,
                    size_ticket) as row_num from {schema}.{table} st ) s 
            where 
            s.account_number = t.account_number and
            s.bank_country_code = t.bank_country_code and
            s.business_mode = t.business_mode and
            s.brand = t.brand and
            s.jurisdiction = t.jurisdiction and
            s.founding_source = t.founding_source and
            s.product_id = t.product_id and
            s.range_program_id = t.range_program_id and
            s.transaction_type = t.transaction_type and
            s.reversal_indicator = t.reversal_indicator and
            s.card_present_indicator = t.card_present_indicator and
            s.currency_local_indicator = t.currency_local_indicator and
            s.merchant_country_code = t.merchant_country_code and
            s.size_ticket = t.size_ticket
            &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_report_query"><code class="name flex">
<span>def <span class="ident">get_report_query</span></span>(<span>self, schema:str, table:str, report_columns:list, formated_date:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>Returns query to get report</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>scheme</code></strong> :&ensp;<code>str</code></dt>
<dd>table schema.</dd>
<dt><strong><code>table</code></strong> :&ensp;<code>str</code></dt>
<dd>table name.</dd>
<dt><strong><code>report_columns</code></strong> :&ensp;<code>list</code></dt>
<dd>list of columns for report.</dd>
<dt><strong><code>formated_date</code></strong> :&ensp;<code>str</code></dt>
<dd>execution formated date.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_report_query(self,schema:str,table:str,report_columns:list,formated_date:str)-&gt;str:
    &#34;&#34;&#34;Returns query to get report

    Args:
        scheme (str):  table schema.
        table (str):  table name.
        report_columns (list): list of columns for report.
        formated_date (str): execution formated date.

    Returns:
        str: returns query
    
    &#34;&#34;&#34;
    return f&#34;&#34;&#34;
    select 
    {&#34;,&#34;.join(report_columns)}
    from {schema}.{table} 
    where app_execution_id = &#39;{formated_date}&#39;
    &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_rows_w_null_conditions"><code class="name flex">
<span>def <span class="ident">get_rows_w_null_conditions</span></span>(<span>self, first_day:str, last_day:str, formated_date:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>gets rows with null fields</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>first_date</code></strong> :&ensp;<code>str</code></dt>
<dd>start of range for report.</dd>
<dt><strong><code>last_day</code></strong> :&ensp;<code>str</code></dt>
<dd>end of range for report.</dd>
<dt><strong><code>formated_date</code></strong> :&ensp;<code>str</code></dt>
<dd>formated date of execution.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_rows_w_null_conditions(self,first_day:str,last_day:str,formated_date:str)-&gt;str:
    &#34;&#34;&#34;gets rows with null fields

    Args:
        first_date (str): start of range for report.
        last_day (str): end of range for report.
        formated_date (str): formated date of execution.

    Returns:
        str: returns query 
    
    &#34;&#34;&#34;
    return f&#34;&#34;&#34;
        where app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39;
        and app_customer_code = &#39;{self.client}&#39;
        and (
            {&#34; &#34;.join(self.validation_conditions())}
        )
        and app_execution_id = &#39;{formated_date}&#39;
        &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_sms_visa"><code class="name flex">
<span>def <span class="ident">get_sms_visa</span></span>(<span>self, formated_date:str, date:str, first_day:str, last_day:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>Returns query to get sms visa transactions</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>formated_date</code></strong> :&ensp;<code>str</code></dt>
<dd>formated date and execution time.</dd>
<dt><strong><code>date</code></strong> :&ensp;<code>str</code></dt>
<dd>year and month of report.</dd>
<dt><strong><code>first_date</code></strong> :&ensp;<code>str</code></dt>
<dd>start of range for report.</dd>
<dt><strong><code>last_day</code></strong> :&ensp;<code>str</code></dt>
<dd>end of range for report.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_sms_visa(self,formated_date:str,date:str,first_day:str,last_day:str)-&gt;str:
    &#34;&#34;&#34;Returns query to get sms visa transactions
    
    Args:
        formated_date (str): formated date and execution time.
        date (str): year and month of report.
        first_date (str):  start of range for report.
        last_day (str): end of range for report.

    Returns:
        str: returns query
    
    &#34;&#34;&#34;
    return f&#34;&#34;&#34;
        select 
            sms.app_type_file,
            cus.code,
            &#39;{formated_date}&#39;,
            &#39;{date}&#39;,
            sms.app_id,
            sms.app_hash_file,
            &#39;VISA SMS&#39;,
            sms.app_processing_date,
            left(cast(sms.card_number as text),9),
            case when sms.account_funding_source in (&#39;C&#39;,&#39;H&#39;,&#39;R&#39;) then &#39;C&#39; when sms.account_funding_source in(&#39;D&#39;,&#39;P&#39;) then &#39;D&#39; else null end,
            cast(pan_extended_country_code as text),
            sms.product_id_sms,
            sfbp.range_program_id, 
            jurisdiction,
            btt.transaction_type_id,
            reversal_indicator,
            case when transaction_currency_code = cus.local_currency_code then 1 else 0 END,
            1,
            1,
            settlement_amount,
            0,
            &#39;VISA&#39;,
            card_acceptor_country,
            currency_alphabetic_code,
            cus.customer_country,
            cf.business_mode,
            0,
            0,
            0,
            0,
            local_transaction_date
        from operational.dh_visa_transaction_sms sms
        inner join operational.dh_visa_transaction_sms_calculated_field cf on sms.app_id = cf.app_id and sms.app_hash_file = cf.app_hash_file and sms.app_type_file = cf.app_type_file
        inner join control.t_customer cus on cus.code = sms.app_customer_code
        left join operational.m_currency cur on sms.settlement_currency_code_sms = cast(cur.currency_numeric_code as text)
        left join operational.m_scheme_fee_bin_products sfbp on trim(sfbp.product_code) = trim(sms.product_id_sms) and sfbp.brand = &#39;VISA&#39; 
        left join operational.m_visa_business_transaction_type btt on cast(business_transaction_type_id as integer) = cf.business_transaction_type  
        where 
        sms.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39; 
        and sms.app_customer_code = &#39;{self.client}&#39;
        and cf.business_transaction_type = 22 and business_transaction_cycle &lt; 100
    &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_transactions_mastercard"><code class="name flex">
<span>def <span class="ident">get_transactions_mastercard</span></span>(<span>self, formated_date:str, date:str, first_day:str, last_day:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>Returns query to get mastercard transactions in general</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>formated_date</code></strong> :&ensp;<code>str</code></dt>
<dd>formated date and execution time.</dd>
<dt><strong><code>date</code></strong> :&ensp;<code>str</code></dt>
<dd>year and month of report.</dd>
<dt><strong><code>first_date</code></strong> :&ensp;<code>str</code></dt>
<dd>start of range for report.</dd>
<dt><strong><code>last_day</code></strong> :&ensp;<code>str</code></dt>
<dd>end of range for report.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_transactions_mastercard(self,formated_date:str,date:str,first_day:str,last_day:str)-&gt;str:
    &#34;&#34;&#34;Returns query to get mastercard transactions in general
    
    Args:
        formated_date (str): formated date and execution time.
        date (str): year and month of report.
        first_date (str): start of range for report.
        last_day (str): end of range for report.

    Returns:
        str: returns query
    
    &#34;&#34;&#34;
    return f&#34;&#34;&#34;
        select 
            mde.app_type_file,
            cus.code,
            &#39;{formated_date}&#39;,
            &#39;{date}&#39;,
            mde.app_id,
            mde.app_hash_file,
            &#39;MASTERCARD ISS AND ACQ&#39;,
            mde.app_processing_date,
            case when business_mode = &#39;acquiring&#39; then right(lpad(rtrim(ltrim(cast(card_acceptor_id_code as text))),15,&#39;0&#39;),11) when business_mode = &#39;issuing&#39; then left(lpad(cast(pan as text),19,&#39;0&#39;),9) end,
            cf.funding_source,
            iar_country,
            cf.gcms_product_identifier, 
            sfbp.range_program_id,
            cf.jurisdiction, 
            mcbtt.transaction_type_id,
            case when left(message_reversal_indicator,1) = &#39;R&#39; then 1 else 0 end, 
            case when cur.currency_alphabetic_code in (cus.local_currency_code,cus.settlement_currency_code) then 1 else 0 end,
            case when right(pos_entry_mode,1) != &#39;0&#39; then 1 else 0 end as motoec_indicator,
            1,
            settlement_report_amount,
            0,
            &#39;MasterCard&#39;,
            mde.card_acceptor_country_code,
            settlement_report_currency_code,
            cus.customer_country,
            business_mode,
            0,
            0,
            0,
            0,
            date_and_time_local_transaction::date
        from operational.dh_mastercard_data_element mde
        inner join operational.dh_mastercard_calculated_field cf on  mde.app_id = cf.app_id and mde.app_hash_file = cf.app_hash_file
        inner join control.t_customer cus on cus.code = mde.app_customer_code
        left join operational.m_scheme_fee_bin_products sfbp on trim(sfbp.product_code) = trim(cf.gcms_product_identifier) and sfbp.brand = &#39;MC&#39;
        left join operational.m_bin_funding_source lubfs on rng_fnd_id = bin_funding_source_mc_numeric_code
        left join operational.m_mastercard_business_transaction_type mcbtt on business_transaction_type_id = left(processing_code,2) 
        left join operational.m_currency cur on mde.currency_code_transaction = cur.currency_numeric_code
        left join operational.dh_mastercard_exclusion_messages em on em.app_customer_code = mde.app_customer_code and em.source_file_id = cf.mc_file_id and em.source_message_number_id = mde.message_number 
        where mde.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39; 
        and mde.app_customer_code = &#39;{self.client}&#39;
        and app_message_type in (&#39;1240&#39;,&#39;1644&#39;) 
        and settlement_indicator_1 = &#39;M&#39; 
        and left(mc_file_id,3) in (&#39;001&#39;,&#39;002&#39;)
        and cf.gcms_product_identifier is not null
        and em.app_id is null
    &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_union_query"><code class="name flex">
<span>def <span class="ident">get_union_query</span></span>(<span>self, base:str, other_query:list) >str</span>
</code></dt>
<dd>
<div class="desc"><p>Returns combination in union query</p>
<p>Args:
base (str): first part of query.
other_query (list): list of querys to unify.</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_union_query(self,base:str,other_query:list)-&gt;str:
    &#34;&#34;&#34;Returns combination in union query
    
     Args:
        base (str): first part of query.
        other_query (list): list of querys to unify.

    Returns:
        str: returns query
    
    &#34;&#34;&#34;
    joined = &#34; union &#34;.join(other_query)
    return f&#34;&#34;&#34;{base} {joined}&#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_update_detail"><code class="name flex">
<span>def <span class="ident">get_update_detail</span></span>(<span>self, first_day:str, last_day:str, month_name:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>Returns query to update from temp</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>first_date</code></strong> :&ensp;<code>str</code></dt>
<dd>start of range for report.</dd>
<dt><strong><code>last_day</code></strong> :&ensp;<code>str</code></dt>
<dd>end of range for report.</dd>
<dt><strong><code>month_name</code></strong> :&ensp;<code>str</code></dt>
<dd>month of report.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_update_detail(self,first_day:str,last_day:str,month_name:str)-&gt;str:
    &#34;&#34;&#34;Returns query to update from temp
    
    Args:
        first_date (str): start of range for report.
        last_day (str): end of range for report.
        month_name (str): month of report.

    Returns:
        str: returns query
    &#34;&#34;&#34;
    return f&#34;&#34;&#34;
            update operational.mh_transaction_scheme_fee d set
            unitary_scheme_fee_cost = x.unitary_scheme_fee_cost,
            estimated_scheme_fee_cost = x.estimated_scheme_fee_amount,
            transaction_scheme_fee_cost = x.transaction_scheme_fee_cost,
            unitary_estimated_scheme_fee_cost = x.unitary_estimated_scheme_fee_amount
            from (
                select dsf.app_id,dsf.app_hash_file, rmsf.unitary_scheme_fee_cost,rmsf.estimated_scheme_fee_amount, rmsf.transaction_scheme_fee_cost,rmsf.unitary_estimated_scheme_fee_amount
                from operational.mh_transaction_scheme_fee dsf 
                inner join operational.mh_monthly_scheme_fee rmsf
                    on dsf.account_number = rmsf.account_number and
                    dsf.account_funding_source = rmsf.founding_source and
                    dsf.bank_country = rmsf.bank_country_code and
                    dsf.business_mode_id = rmsf.business_mode and
                    dsf.transaction_brand = rmsf.brand and
                    dsf.size_ticket = rmsf.size_ticket and
                    dsf.product_id = rmsf.product_id and
                    dsf.range_program_id = rmsf.range_program_id and
                    dsf.business_transaction_type_id = rmsf.transaction_type and
                    dsf.jurisdiction = rmsf.jurisdiction and
                    dsf.reversal_indicator = rmsf.reversal_indicator and
                    dsf.currency_local_indicator = rmsf.currency_local_indicator and
                    dsf.motoec_indicator = rmsf.card_present_indicator and
                    dsf.merchant_country_code = rmsf.merchant_country_code and
                    dsf.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39; and 
                    dsf.app_customer_code = rmsf.customer_code
            where
            rmsf.report_month = &#39;{month_name}&#39; and
            rmsf.customer_code = &#39;{self.client}&#39;) x where x.app_id = d.app_id and x.app_hash_file = d.app_hash_file 
        &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_update_from_temp"><code class="name flex">
<span>def <span class="ident">get_update_from_temp</span></span>(<span>self, temp_schem:str, temp_table:str, month_name:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>Returns query to update from temp</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>temp_schem</code></strong> :&ensp;<code>str</code></dt>
<dd>temporal schema.</dd>
<dt><strong><code>temp_table</code></strong> :&ensp;<code>str</code></dt>
<dd>temporal table name.</dd>
<dt><strong><code>month_name</code></strong> :&ensp;<code>str</code></dt>
<dd>nmonth of report.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_update_from_temp(self,temp_schem:str,temp_table:str,month_name:str)-&gt;str:
    &#34;&#34;&#34;Returns query to update from temp
    
    Args:
        temp_schem (str): temporal schema.
        temp_table (str): temporal table name.
        month_name (str): nmonth of report.

    Returns:
        str: returns query
    &#34;&#34;&#34;
    return f&#34;&#34;&#34;
        update operational.mh_monthly_scheme_fee sf set
        estimated_scheme_fee_amount = x.estimated_scheme_fee_amount,
        transaction_scheme_fee_cost = x.transaction_scheme_fee_cost,
        unitary_scheme_fee_cost = x.unitary_scheme_fee_cost,
        unitary_estimated_scheme_fee_amount = x.unitary_estimated_scheme_fee_amount
        from (select * from {temp_schem}.{temp_table} where report_month = &#39;{month_name}&#39;) x where
        customer_code = &#39;{self.client}&#39; and
        x.report_month::text = sf.report_month and
        x.bank_country_code = sf.bank_country_code and
        x.business_mode = sf.business_mode and
        x.brand = sf.brand and
        x.size_ticket = sf.size_ticket and
        x.product_id = sf.product_id and
        sf.range_program_id = x.range_program_id and
        x.founding_source = sf.founding_source and
        x.transaction_type =  sf.transaction_type and
        x.jurisdiction = sf.jurisdiction and
        x.reversal_indicator = sf.reversal_indicator and
        x.currency_local_indicator = sf.currency_local_indicator and
        x.card_present_indicator = sf.card_present_indicator and
        x.account_number = sf.account_number and
        x.merchant_country_code = sf.merchant_country_code and
        x.transaction_count = sf.transaction_count
        &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_update_sumary"><code class="name flex">
<span>def <span class="ident">get_update_sumary</span></span>(<span>self, rows_updated:str, month_name:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>returns query for update sumary table.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>rows_updated</code></strong> :&ensp;<code>str</code></dt>
<dd>rows updated.</dd>
<dt><strong><code>month_name</code></strong> :&ensp;<code>str</code></dt>
<dd>month of report.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_update_sumary(self,rows_updated:str,month_name:str)-&gt;str:
    &#34;&#34;&#34;returns query for update sumary table.

    Args:
        rows_updated (str): rows updated.
        month_name (str): month of report.

    Returns:
        str: returns query
    
    &#34;&#34;&#34;
    return f&#34;update operational.mh_scheme_fee_sumary set number_of_updated_rows = {rows_updated} where report_month = &#39;{month_name}&#39; and  report_client_code = &#39;{self.client}&#39;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.temp_table_scheme_fee_report"><code class="name flex">
<span>def <span class="ident">temp_table_scheme_fee_report</span></span>(<span>self) >str</span>
</code></dt>
<dd>
<div class="desc"><p>creates query for an empty clone report table to make all calculations</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>generated query.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def temp_table_scheme_fee_report(self)-&gt;str:
    &#34;&#34;&#34;creates query for an empty clone report table to make all calculations
    
    Returns:
        str: generated query.
    &#34;&#34;&#34;
    return f&#34;&#34;&#34;select app_id,
                app_customer_code,
                app_type_file,
                app_hash_file,
                app_processing_date, 
                app_execution_id,
                report_currency,
                customer_code,
                {&#34;,&#34;.join(self.get_report_columns())} from operational.mh_monthly_scheme_fee where app_id = -1 &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.temp_table_scheme_fee_transaction"><code class="name flex">
<span>def <span class="ident">temp_table_scheme_fee_transaction</span></span>(<span>self) >str</span>
</code></dt>
<dd>
<div class="desc"><p>creates query for an empty clone transaction table to make all calculations</p>
<h2 id="returns">Returns</h2>
<p>query (str): generated query.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def temp_table_scheme_fee_transaction(self)-&gt;str:
    &#34;&#34;&#34;creates query for an empty clone transaction table to make all calculations
    
    Returns:
        query (str): generated query. 
    &#34;&#34;&#34;
    query = f&#34;&#34;&#34;select exchange_rate,report_amount,report_currency,{&#34;,&#34;.join(self.get_detail_columns())} 
    from operational.mh_transaction_scheme_fee where app_id = -1 &#34;&#34;&#34;
    return query</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_amounts"><code class="name flex">
<span>def <span class="ident">update_amounts</span></span>(<span>self, first_day:str, last_day:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>Update null amounts</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>first_date</code></strong> :&ensp;<code>str</code></dt>
<dd>start of range for report.</dd>
<dt><strong><code>last_day</code></strong> :&ensp;<code>str</code></dt>
<dd>end of range for report.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_amounts(self,first_day:str,last_day:str)-&gt;str:
    &#34;&#34;&#34;Update null amounts
    
    Args:
        first_date (str): start of range for report.
        last_day (str): end of range for report.

    Returns:
        str: returns query
    
    &#34;&#34;&#34;
    return  f&#34;&#34;&#34;
        update operational.mh_transaction_scheme_fee d set
        report_amount = 0
        where app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39;
        and app_customer_code = &#39;{self.client}&#39; and report_amount is null
    &#34;&#34;&#34; </code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_jurisdiction"><code class="name flex">
<span>def <span class="ident">update_jurisdiction</span></span>(<span>self, formated_date:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>updates juridiction</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>formated_date</code></strong> :&ensp;<code>str</code></dt>
<dd>date of execution of file.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_jurisdiction(self,formated_date:str)-&gt;str:
    &#34;&#34;&#34;updates juridiction
    
    Args:
        formated_date (str): date of execution of file.

    Returns:
        str: returns query
    &#34;&#34;&#34;
    return f&#34;&#34;&#34;
        update operational.mh_transaction_scheme_fee d set 
        jurisdiction = &#39;UNK&#39;
        where app_execution_id = &#39;{formated_date}&#39; and jurisdiction is null
        and app_customer_code = &#39;{self.client}&#39; and report_amount is null
    &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_mastercard_unk_product"><code class="name flex">
<span>def <span class="ident">update_mastercard_unk_product</span></span>(<span>self, formated_date:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>updates the unknown mastercard products with dummy</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>formated_date</code></strong> :&ensp;<code>str</code></dt>
<dd>date of execution of file.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_mastercard_unk_product(self,formated_date:str)-&gt;str:
    &#34;&#34;&#34;updates the unknown mastercard products with dummy
    
    Args:
        formated_date (str): date of execution of file.

    Returns:
        str: returns query
    &#34;&#34;&#34;
    return f&#34;&#34;&#34;
        update operational.mh_transaction_scheme_fee d set 
        product_id = &#39;UNK&#39;,range_program_id = &#39;UNK&#39;
        where app_execution_id = &#39;{formated_date}&#39; and product_id is null
        and transaction_brand = &#39;MasterCard&#39; 
        and app_customer_code = &#39;{self.client}&#39; and report_amount is null
    &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_size_tickets"><code class="name flex">
<span>def <span class="ident">update_size_tickets</span></span>(<span>self, schema:str, table_name:str, first_day:str, last_day:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>updates size tikets field</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>schema</code></strong> :&ensp;<code>str</code></dt>
<dd>schema of table.</dd>
<dt><strong><code>table_name</code></strong> :&ensp;<code>str</code></dt>
<dd>table name.</dd>
<dt><strong><code>first_date</code></strong> :&ensp;<code>str</code></dt>
<dd>start of range for report.</dd>
<dt><strong><code>last_day</code></strong> :&ensp;<code>str</code></dt>
<dd>end of range for report.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_size_tickets(self,schema:str,table_name:str,first_day:str,last_day:str)-&gt;str:
    &#34;&#34;&#34;updates size tikets field
    
    Args:
        schema (str): schema of table.
        table_name (str): table name.
        first_date (str): start of range for report.
        last_day (str): end of range for report.

    Returns:
        str: returns query
    
    &#34;&#34;&#34;
    return f&#34;&#34;&#34;
        update {schema}.{table_name} d set 
        size_ticket = case when x.size_ticket is not null then x.size_ticket else 0 end
        from (
        select 
        tsf.app_id,
        tsf.app_hash_file,st.app_id size_ticket
        from {schema}.{table_name} tsf
        left join operational.m_size_ticket st on report_amount between st.size_ticket_min and st.size_ticket_max
        where tsf.app_processing_date between &#39;{first_day}&#39; and &#39;{last_day}&#39;
        and tsf.app_customer_code = &#39;{self.client}&#39;
        ) 
        x where x.app_id = d.app_id and x.app_hash_file = d.app_hash_file
    &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_unk_range_program"><code class="name flex">
<span>def <span class="ident">update_unk_range_program</span></span>(<span>self, formated_date:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>updates unknown range program id</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>formated_date</code></strong> :&ensp;<code>str</code></dt>
<dd>date of execution of file.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_unk_range_program(self,formated_date:str)-&gt;str:
    &#34;&#34;&#34;updates unknown range program id
    
    Args:
        formated_date (str): date of execution of file.

    Returns:
        str: returns query
    &#34;&#34;&#34;
    return f&#34;&#34;&#34;
        update operational.mh_transaction_scheme_fee d set 
        range_program_id = &#39;UNK&#39;
        where app_execution_id = &#39;{formated_date}&#39; and range_program_id is null
        and app_customer_code = &#39;{self.client}&#39; 
    &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_unknown_account_range"><code class="name flex">
<span>def <span class="ident">update_unknown_account_range</span></span>(<span>self, formated_date:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>updates account_number</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>formated_date</code></strong> :&ensp;<code>str</code></dt>
<dd>date of execution of file.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_unknown_account_range(self,formated_date:str)-&gt;str:
    &#34;&#34;&#34;updates account_number
    
    Args:
        formated_date (str): date of execution of file.

    Returns:
        str: returns query
    &#34;&#34;&#34;
    return f&#34;&#34;&#34;
        update operational.mh_transaction_scheme_fee d set 
        account_number = &#39;9999999999999999&#39;
        where app_execution_id = &#39;{formated_date}&#39; and account_number is null
        and app_customer_code = &#39;{self.client}&#39; 
    &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_unknown_founding_source"><code class="name flex">
<span>def <span class="ident">update_unknown_founding_source</span></span>(<span>self, formated_date:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>updates account_founding_source</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>formated_date</code></strong> :&ensp;<code>str</code></dt>
<dd>date of execution of file.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_unknown_founding_source(self,formated_date:str)-&gt;str:
    &#34;&#34;&#34;updates account_founding_source
    
    Args:
        formated_date (str): date of execution of file.

    Returns:
        str: returns query
    &#34;&#34;&#34;
    return f&#34;&#34;&#34;
        update operational.mh_transaction_scheme_fee d set 
        account_funding_source = &#39;UNK&#39;
        where app_execution_id = &#39;{formated_date}&#39; and account_funding_source is null
        and app_customer_code = &#39;{self.client}&#39; 
    &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_unknown_range_country"><code class="name flex">
<span>def <span class="ident">update_unknown_range_country</span></span>(<span>self, formated_date:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>updates account_range_country</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>formated_date</code></strong> :&ensp;<code>str</code></dt>
<dd>date of execution of file.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_unknown_range_country(self,formated_date:str)-&gt;str:
    &#34;&#34;&#34;updates account_range_country

    Args:
        formated_date (str): date of execution of file.

    Returns:
        str: returns query
    &#34;&#34;&#34;
    return f&#34;&#34;&#34;
        update operational.mh_transaction_scheme_fee d set 
        account_range_country = &#39;UNK&#39;
        where app_execution_id = &#39;{formated_date}&#39; and account_range_country is null
        and app_customer_code = &#39;{self.client}&#39; 
    &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_visa_unk_product"><code class="name flex">
<span>def <span class="ident">update_visa_unk_product</span></span>(<span>self, formated_date:str) >str</span>
</code></dt>
<dd>
<div class="desc"><p>updates the unknown visa products with dummy</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>formated_date</code></strong> :&ensp;<code>str</code></dt>
<dd>date of execution of file.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>returns query</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_visa_unk_product(self,formated_date:str)-&gt;str:
    &#34;&#34;&#34;updates the unknown visa products with dummy
    
    Args:
        formated_date (str): date of execution of file.

    Returns:
        str: returns query
    &#34;&#34;&#34;
    return f&#34;&#34;&#34;
        update operational.mh_transaction_scheme_fee d set 
        product_id = &#39;UNK&#39;,range_program_id = &#39;UNK&#39;
        where app_execution_id = &#39;{formated_date}&#39; and product_id is null
        and transaction_brand = &#39;VISA&#39;
        and app_customer_code = &#39;{self.client}&#39; and report_amount is null
    &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.validation_conditions"><code class="name flex">
<span>def <span class="ident">validation_conditions</span></span>(<span>self) >list</span>
</code></dt>
<dd>
<div class="desc"><p>Returns list of validation conditions</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>list</code></dt>
<dd>list of conditions.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def validation_conditions(self)-&gt;list:
    &#34;&#34;&#34;Returns list of validation conditions
    
    Returns:
        list: list of conditions.
    &#34;&#34;&#34;
    return [
        &#34;report_amount is null or&#34;,
        &#34;account_range_country is null or&#34;,
        &#34;account_funding_source is null or&#34;,
        &#34;account_number is null or&#34;,
        &#34;jurisdiction is null or&#34;,
        &#34;product_id is null or&#34;,
        &#34;range_program_id is null&#34;,
    ] </code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee" href="index.html">PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery">getquery</a></code></h4>
<ul class="">
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.delete_rows_w_null" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.delete_rows_w_null">delete_rows_w_null</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_acquirer_visa" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_acquirer_visa">get_acquirer_visa</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_acquiring_on_us_mastercard" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_acquiring_on_us_mastercard">get_acquiring_on_us_mastercard</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_delete_detail" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_delete_detail">get_delete_detail</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_delete_report" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_delete_report">get_delete_report</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_delete_sumary" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_delete_sumary">get_delete_sumary</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_detail_columns" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_detail_columns">get_detail_columns</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_drop_if_exists" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_drop_if_exists">get_drop_if_exists</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_exchange_rate_calculation" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_exchange_rate_calculation">get_exchange_rate_calculation</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_insert_detail" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_insert_detail">get_insert_detail</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_insert_into_report_table" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_insert_into_report_table">get_insert_into_report_table</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_insert_into_sumary" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_insert_into_sumary">get_insert_into_sumary</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_issuers_on_us_mastercard" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_issuers_on_us_mastercard">get_issuers_on_us_mastercard</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_issuers_visa" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_issuers_visa">get_issuers_visa</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_on_us_visa" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_on_us_visa">get_on_us_visa</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_report_columns" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_report_columns">get_report_columns</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_report_extra_columns" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_report_extra_columns">get_report_extra_columns</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_report_query" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_report_query">get_report_query</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_rows_w_null_conditions" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_rows_w_null_conditions">get_rows_w_null_conditions</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_sms_visa" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_sms_visa">get_sms_visa</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_transactions_mastercard" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_transactions_mastercard">get_transactions_mastercard</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_union_query" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_union_query">get_union_query</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_update_detail" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_update_detail">get_update_detail</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_update_from_temp" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_update_from_temp">get_update_from_temp</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_update_sumary" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.get_update_sumary">get_update_sumary</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.temp_table_scheme_fee_report" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.temp_table_scheme_fee_report">temp_table_scheme_fee_report</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.temp_table_scheme_fee_transaction" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.temp_table_scheme_fee_transaction">temp_table_scheme_fee_transaction</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_amounts" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_amounts">update_amounts</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_jurisdiction" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_jurisdiction">update_jurisdiction</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_mastercard_unk_product" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_mastercard_unk_product">update_mastercard_unk_product</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_size_tickets" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_size_tickets">update_size_tickets</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_unk_range_program" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_unk_range_program">update_unk_range_program</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_unknown_account_range" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_unknown_account_range">update_unknown_account_range</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_unknown_founding_source" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_unknown_founding_source">update_unknown_founding_source</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_unknown_range_country" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_unknown_range_country">update_unknown_range_country</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_visa_unk_product" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.update_visa_unk_product">update_visa_unk_product</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.validation_conditions" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.getquery.getquery.validation_conditions">validation_conditions</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>