<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.managment API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.managment</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">from operator import index
import shutil
import os
import pathlib
import sys
import sqlalchemy
import Module.Logs.logs as log
import pandas as pd
import Module.Persistence.connection as connection
import Module.SchemeFee.getquery as getquery
import Module.Adapter.adapters as adapters
from datetime import date, datetime
from dotenv import load_dotenv
import calendar
import os
from sqlalchemy.exc import SQLAlchemyError


class scheme_fee:
    def __init__(self):
        load_dotenv()
        pass

    def generate_table(self, client: str, date: str):
        &#34;&#34;&#34;Generates a csv on the scheme fee&#39;s bucket in the clients &#39;out&#39; directory with feeded date data

        Args:
            client (str): must exists in database.
            date (str): must be in format YYYYMM
        &#34;&#34;&#34;
        try:
            s3 = connection.connect_to_s3()
            module = &#34;OPERATIONAL&#34;
            exec_module = &#34;SCHEME FEE&#34;

            step =  &#34;&#34;
            temporal_schema = &#34;temporal&#34;
            log_name = log.logs().new_log(
                module, &#34;&#34;, client, &#34;GENERATION OF SCHEME FEE REPORT&#34;, &#34;SCHEME_FEE&#34;,exec_module
            )

            date = str(date)
            year = date[0:4]
            month = date[4:6]
            date_month = calendar.monthrange(int(year),int(month))

            max_null = int(os.getenv(&#34;SCHEME_FEE_TOLERANCE&#34;,5))

            date_of_extract = datetime.now()
            formated_date = (
                str(date_of_extract.year)
                + str(date_of_extract.month)
                + str(date_of_extract.day)
                + &#34;_&#34;
                + str(int(datetime.timestamp(date_of_extract)))
            )

            first_day = datetime.strptime(f&#34;{year}-{month}-01 00:00:00&#34;,&#34;%Y-%m-%d %H:%M:%S&#34;)
            last_day = datetime.strptime(f&#34;{year}-{month}-{date_month[1]} 23:59:59&#34;,&#34;%Y-%m-%d %H:%M:%S&#34;)

            month_of_report = datetime.strptime(month, &#34;%m&#34;)
            month_name = date

            go_main = adapters.get_others(client,log_name)
            begin_date = datetime.strftime(first_day,&#34;%Y%m%d&#34;)
            form_date = datetime.strftime(last_day,&#34;%Y%m%d&#34;)
            exists_month = connection.connect_to_postgreSQL().select(table=&#34;operational.mh_scheme_fee_sumary&#34;,conditions= f&#34;where report_month = &#39;{date}&#39; and report_client_code = &#39;{client}&#39;&#34;)
            previous = False
            if len(exists_month)&gt; 0:
                loop = True
                previous = True
                while loop:
                    loop = self.input_validate(client,module,log_name,step,month_name,exec_module)
            go_main.config_additional_table(begin_date,form_date,&#39;mh_transaction_scheme_fee&#39;)
            go_main.config_additional_table(begin_date,begin_date,config_table_name=&#39;mh_monthly_scheme_fee&#39;)

                    
            filename = f&#34;{client}_{date}_{formated_date}.csv&#34;
            s3_bucket =  os.getenv(&#34;SCHEME_FEE_BUCKET&#34;)
            s3_route = f&#34;OUT/{client}&#34;
            temp_route_folder = f&#34;FILES/SCHEME_FEE/OUT/{client}/{date}&#34;
            temp_file_name = f&#34;{temp_route_folder}/{filename}&#34;
            temp_transaction_table = f&#34;temp_scheme_fee_transaction_{client.lower()}_{date}&#34;
            temp_report_table = f&#34;temp_scheme_fee_report_{client.lower()}_{date}&#34;

            pathlib.Path(temp_route_folder).mkdir(parents=True, exist_ok=True)

            db = connection.connect_to_postgreSQL()

            querys = getquery.getquery(client)
            columns = querys.get_detail_columns()
            report_columns = querys.get_report_columns()

            create_temporal_transactions = querys.temp_table_scheme_fee_transaction()
            create_temporal_report = querys.temp_table_scheme_fee_report()
            insert_into_query = querys.get_insert_detail(columns,temporal_schema,temp_transaction_table)
            visa_issuer_query = querys.get_issuers_visa(formated_date,date,first_day,last_day)
            visa_acquirer_query = querys.get_acquirer_visa(formated_date,date,first_day,last_day)
            visa_issuer_ON_US_query = querys.get_on_us_visa(formated_date,date,first_day,last_day)
            visa_sms_query = querys.get_sms_visa(formated_date,date,first_day,last_day)

            master_card_gen = querys.get_transactions_mastercard(formated_date,date,first_day,last_day)
            master_card_gen_onus_iss = querys.get_issuers_on_us_mastercard(formated_date,date,first_day,last_day)
            master_card_gen_onus_acq = querys.get_acquiring_on_us_mastercard(formated_date,date,first_day,last_day)

            exit_query = querys.get_union_query(insert_into_query,[visa_issuer_query,visa_acquirer_query,visa_issuer_ON_US_query
            ,visa_sms_query,master_card_gen_onus_iss,master_card_gen_onus_acq,master_card_gen])

            calculate_report_currency = querys.get_exchange_rate_calculation(temporal_schema,temp_transaction_table,first_day,last_day)
            calculating_ticket_size =querys.update_size_tickets(temporal_schema,temp_transaction_table,first_day,last_day)
            get_off_rows_w_null = querys.get_rows_w_null_conditions(first_day,last_day,formated_date)

            inserting_data_to_rpt_table = querys.get_insert_into_report_table(temporal_schema,temp_report_table,temporal_schema,temp_transaction_table,formated_date,month_name,first_day,last_day)
            updating_temp_report = querys.get_report_extra_columns(temporal_schema,temp_report_table,&#39;&#39;,first_day)
            get_report = querys.get_report_query(temporal_schema,temp_report_table,report_columns,formated_date)

            delete_old_detail = querys.get_delete_detail(date,formated_date)
            delete_old_report = querys.get_delete_report(month_name,formated_date)
            delete_old_sumary = querys.get_delete_sumary(month_name,formated_date)
            delete_nulls = querys.delete_rows_w_null(temporal_schema,temp_transaction_table,get_off_rows_w_null)

            step = &#34;PREPARING DATA FOR REPORT&#34;
        
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Drop temporal tables if exists&#34;,
                exec_module
            )
            result = db.drop_table(f&#34;{temporal_schema}.{temp_transaction_table}&#34;)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
            result = db.drop_table(f&#34;{temporal_schema}.{temp_report_table}&#34;)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Creating temporal tables for report&#34;,
                exec_module
            )
            result = db.create_table_from_select(create_temporal_transactions,f&#34;{temporal_schema}.{temp_transaction_table}&#34;)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
            result = db.create_table_from_select(create_temporal_report,f&#34;{temporal_schema}.{temp_report_table}&#34;)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Inserting data into temporal table {temporal_schema}.{temp_transaction_table}&#34;,
                exec_module
            )
            result = db.execute_block(exit_query)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Calculating report exchange rates and amounts&#34;,
                exec_module
            )
            result = db.execute_block(calculate_report_currency)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Check for null validation columns&#34;,
                exec_module
            )
            result = db.select(f&#34;{temporal_schema}.{temp_transaction_table}&#34;,get_off_rows_w_null,&#34;count(app_id) quantity&#34;)
            null_rows = int(result[0][&#34;quantity&#34;])
            if null_rows &gt; 0:
                if null_rows == int(max_null):
                    log.logs().exist_file(
                        module,
                        client,
                        &#34;VISA AND MASTERCARD&#34;,
                        log_name,
                        step,
                        &#34;CRITICAL&#34;,
                        &#34;Max null tolerance reached, aborting process.&#34;,
                        exec_module
                    )
                    exit()
                else:
                    log.logs().exist_file(
                        module,
                        client,
                        &#34;VISA AND MASTERCARD&#34;,
                        log_name,
                        step,
                        &#34;WARNING&#34;,
                        f&#34;{null_rows} rows with validation fields in null are going to be removed and not included in the report.&#34;,
                        exec_module
                    ) 
                    result = db.execute_block(delete_nulls)
                    log.logs().exist_file(
                        module,
                        client,
                        &#34;VISA AND MASTERCARD&#34;,
                        log_name,
                        step,
                        &#34;WARNING&#34;,
                        result,
                        exec_module
                    )
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Calculating ticket size for transactions&#34;,
                exec_module
            )
            result = db.execute_block(calculating_ticket_size)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Grouping data and inserting in temporal report table&#34;,
                exec_module
            )
            result = db.execute_block(inserting_data_to_rpt_table)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Updating internal columns of temporal table&#34;,
                exec_module
            )
            result = db.execute_block(updating_temp_report)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
            
            step = &#34;CREATING CSV SCHEME FEE REPORT&#34;
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Creating csv report&#34;,
                exec_module
            )
            df = db.select_to_df_object(get_report)
            df = df.filter(report_columns, axis=1)
            df[&#34;account_number&#34;] = df[&#34;account_number&#34;].astype(&#39;str&#39;)
            df.to_csv(temp_file_name,sep=&#34;;&#34;,index=False)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Exporting report to s3 bucket&#34;,
                exec_module
            )
            s3.upload_object(s3_bucket,temp_file_name,f&#34;{s3_route}/{filename}&#34;)

            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Report uploaded in S3 bucket. File route: {s3_route}/{filename}&#34;,
                exec_module
            )
            step = &#34;CLEANING AND FINISHING PROCESS&#34;
            total_transactions = db.select(f&#34;{temporal_schema}.{temp_transaction_table}&#34;,cols=&#34;count(app_id) quantity&#34;)
            insert_into_sumary = querys.get_insert_into_sumary(formated_date,month_name,total_transactions[0][&#34;quantity&#34;],len(df),s3_route)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Saving report sumary into database, Month {month_name}&#34;,
                exec_module
            )
            result = db.execute_block(insert_into_sumary)

            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Inserting data in scheme fee transaction table&#34;,
                exec_module
            )
            result = db.insert_from_table(temporal_schema,temp_transaction_table,&#34;operational&#34;,&#34;mh_transaction_scheme_fee&#34;)
            log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    result,
                    exec_module
                )
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Inserting data in scheme fee report table&#34;,
                exec_module
            )
            result = db.insert_from_table(temporal_schema,temp_report_table,&#34;operational&#34;,&#34;mh_monthly_scheme_fee&#34;)
            log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    result,
                    exec_module
                )
            if previous:
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    &#34;Deleting old sumary already generated&#34;,
                    exec_module
                )
                result = db.execute_block(delete_old_sumary)
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    result,
                    exec_module
                )
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    &#34;Deleting old generated detail&#34;,
                    exec_module
                )
                result = db.execute_block(delete_old_detail)
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    result,
                    exec_module
                )
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    &#34;Deleting old generated report&#34;,
                    exec_module
                )
                result = db.execute_block(delete_old_report)
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    result,
                    exec_module
                )
            
            result = db.drop_table(f&#34;{temporal_schema}.{temp_transaction_table}&#34;)
            result = db.drop_table(f&#34;{temporal_schema}.{temp_report_table}&#34;)
            
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Temporal tables droped sucessfully&#34;,
                exec_module
            )

            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Report of {month_name} has been saved sucesfully&#34;,
                exec_module
            )

        except Exception as e:

            log.logs().exist_file(
                &#34;OPERATIONAL&#34;,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;CRITICAL&#34;,
                f&#34;UNHANDLED EXCEPTION: {str(log.logs().print_except())}&#34;,
                exec_module
            )

    def read_table(self, client: str, file: str, date: str):
        &#34;&#34;&#34;Reads a csv on the scheme fee&#39;s bucket in the clients &#39;IN&#39; directory with feeded date data
        
        Args:
            client (str): must exists in database.
            date (str): must be in format YYYYMM.
            file (str): must be route IN to file and exists in bucket

            
        &#34;&#34;&#34;
        try:
            
            tran = None
            schem = &#34;operational&#34;
            temp_schem = &#34;temporal&#34;
            module = &#34;OPERATIONAL&#34;
            exec_module = &#34;SCHEME FEE&#34;
            s3_route = &#34;IN/&#34;+file
            step =  &#34;&#34;

            log_name = log.logs().new_log(
                module, &#34;&#34;, client, &#34;GENERATION OF SCHEME FEE REPORT&#34;, &#34;SCHEME_FEE&#34;,exec_module
            )

            date = str(date)
            year = date[0:4]
            month = date[4:6]
            date_month = calendar.monthrange(int(year),int(month))

            first_day = datetime.strptime(f&#34;{year}-{month}-01 00:00:00&#34;,&#34;%Y-%m-%d %H:%M:%S&#34;)
            last_day = datetime.strptime(f&#34;{year}-{month}-{date_month[1]} 23:59:59&#34;,&#34;%Y-%m-%d %H:%M:%S&#34;)

            month_of_report = datetime.strptime(month, &#34;%m&#34;)
            month_name = date
            
            step = &#34;READING SCHEME FEE UPDATE TEMPLATE&#34;

            log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    f&#34;Reading file from S3 route: IN/{file}&#34;,
                    exec_module
                )

            date_of_extract = datetime.now()
            formated_date = (
                str(date_of_extract.year)
                + str(date_of_extract.month)
                + str(date_of_extract.day)
                + &#34;_&#34;
                + str(int(datetime.timestamp(date_of_extract)))
            )


            s3 = connection.connect_to_s3()
            s3_bucket =  os.getenv(&#34;SCHEME_FEE_BUCKET&#34;)
            s3_route = f&#34;IN/{file}&#34;
            filename = pathlib.Path(file).name
            temp_route_folder = f&#34;FILES/SCHEME_FEE/IN/{client}/{date}/{formated_date}&#34;
            temp_file_name = f&#34;{temp_route_folder}/{filename}&#34;
            temp_transaction_table = f&#34;temp_scheme_fee_transaction_{client.lower()}_{date}&#34;
            temp_report_table = f&#34;temp_scheme_fee_report_{client.lower()}_{date}&#34;
            pathlib.Path(temp_route_folder).mkdir(parents=True, exist_ok=True)

            s3.get_object(s3_bucket,s3_route,temp_file_name)
            valid_NaNs = [&#39;-1.#IND&#39;, &#39;1.#QNAN&#39;, &#39;1.#IND&#39;, &#39;-1.#QNAN&#39;, &#39;#N/A N/A&#39;, &#39;#N/A&#39;, &#39;N/A&#39;, &#39;n/a&#39;, &#39;&#39;, &#39;#NA&#39;, &#39;NULL&#39;, &#39;null&#39;, &#39;NaN&#39;, &#39;-NaN&#39;, &#39;nan&#39;, &#39;-nan&#39;, &#39;&#39;]

            df = pd.read_csv(temp_file_name,sep=&#34;;&#34;,encoding=&#34;Latin-1&#34;,keep_default_na=False,na_values=valid_NaNs, dtype={&#34;account_number&#34;:str,
                &#34;range_program_id&#34;:str,
                &#34;reversal_indicator&#34;:str,
                &#34;currency_local_indicator&#34;:str,
                &#34;reversal_indicator&#34;:str,
                &#34;card_present_indicator&#34;:str,
                })

            if len(df.index) == 0:
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    f&#34;No data has been found in the file. closing process&#34;,
                    exec_module
                )
                return 

            log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    f&#34;procesing file data of month: {month_name}&#34;,
                    exec_module
                )


            df[&#34;unitary_scheme_fee_cost&#34;] = round(df[&#34;transaction_scheme_fee_cost&#34;] / df[&#34;transaction_count&#34;],6)
            df[&#34;unitary_estimated_scheme_fee_amount&#34;] = round(df[&#34;estimated_scheme_fee_amount&#34;] / df[&#34;transaction_count&#34;],6)
            
            querys = getquery.getquery(client)
            db = connection.connect_to_postgreSQL()

            update_from_temp = querys.get_update_from_temp(temp_schem,temp_report_table,month_name)
            update_detail = querys.get_update_detail(first_day,last_day,month_name)
            report_sumary = db.select(&#34;operational.mh_scheme_fee_sumary&#34;,f&#34;where report_month = &#39;{month_name}&#39; and  report_client_code = &#39;{client}&#39;&#34;)

            if len(report_sumary) == 0 :
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;ERROR&#34;,
                    f&#34;Report is not generated yet or not exists anymore.&#34;,
                    exec_module
                )

                exit() 

            if len(df.index) != report_sumary[0][&#34;number_of_groups&#34;]:
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;WARNING&#34;,
                    f&#34;The quantity of records in file is not the same as the one registered in the report.{len(df.index)} - {report_sumary[0][&#39;number_of_groups&#39;]} | closing execution&#34;,
                    exec_module
                )
                exit()
            step = &#34;UPDATING DATA&#34;

            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Droping temporal table if exists&#34;,
                exec_module
            )
            result = db.drop_table(f&#34;{temp_schem}.{temp_report_table}&#34;)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Inserting data into temporal table {temp_schem}.{temp_report_table}&#34;,
                exec_module
            )
            result = db.insert_from_dataframe(temp_report_table,dataframe=df,schema=temp_schem,if_exists=&#34;replace&#34;,dtype={&#34;size_ticket&#34;:sqlalchemy.String})
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Data inserted sucesfully. Rows inserted {len(df)}&#34;,
                exec_module
            )
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Updating data in report table&#34;,
                exec_module
            )
            result = db.execute_block(update_from_temp,True)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result[0],
                exec_module
            )
            if int(result[1]) != report_sumary[0][&#34;number_of_groups&#34;] :
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;CRITICAL&#34;,
                    f&#34;Updated groups quantity ({result[1]} rows) is not the same as the report sumary ({report_sumary[0][&#39;number_of_groups&#39;]} rows) . Aborting process.&#34;,
                    exec_module
                )
                exit()
            
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Updating transactions in transactions table&#34;,
                exec_module
            )
            result = db.execute_block(update_detail,True)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result[0],
                exec_module
            )

            if int(result[1]) != report_sumary[0][&#34;number_of_inserted_rows&#34;] :
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;CRITICAL&#34;,
                    f&#34;Updated rows quantity ({result[1]} rows) is not the same as the report sumary ({report_sumary[0][&#39;number_of_groups&#39;]} rows) . Aborting process.&#34;,
                    exec_module
                )
                exit()

            update_sumary = querys.get_update_sumary(result[1],month_name)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Saving results in database&#34;,
                exec_module
            )

            result = db.execute_block(update_sumary)

            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Report sumary updated sucesfully&#34;,
                exec_module
            )

            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Closing conection to database&#34;,
                exec_module
            )

            log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    f&#34;Tables updated sucessfully&#34;,
                    exec_module
                )
    
        except Exception as e:
            log.logs().exist_file(
                &#34;OPERATIONAL&#34;,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;CRITICAL&#34;,
                f&#34;UNHANDLED EXCEPTION: {str(log.logs().print_except())}&#34;,
                exec_module
            )

    def input_validate(self,client:str,module:str,log_name:str,step:str,month_name:str,exec_module:str)-&gt; bool:
        &#34;&#34;&#34;Ask for input returns true or false
        
        Args:
            client (str): clients code
            module (str): type of module.
            log_name (str): log name.
            step (str): step on execution.
            month_name (str): month of report
            exec_module (str): execution module.

        Returns:
            bool: True if is not a valid input, False if is a valid input.
        
        &#34;&#34;&#34;
        yes_array = [&#39;yes&#39;,&#39;y&#39;,&#39;si&#39;,&#39;ya&#39;,&#39;ok&#39;]
        no_array = [&#39;no&#39;,&#39;n&#39;,&#39;nah&#39;,&#39;nope&#39;]
        asking = input(&#34;A report has been already generated. If you want to continue, this will delete all data from the previous report. Type &#39;Yes&#39; to continue or &#39;No&#39; to cancel: &#34;)
        asking = asking.lower()
        if asking in yes_array:
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;WARNING&#34;,
                f&#34;Previous data is going to be deleted . Month: {month_name}&#34;,
                exec_module
            )
            return False

        elif asking in no_array:
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Canceled by user&#34;,
                exec_module
            )
            exit()
        
        else:
            print(&#34;&#39;&#34;+asking+&#34;&#39; is not a valid input&#34;)
            return True

        </code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.managment.scheme_fee"><code class="flex name class">
<span>class <span class="ident">scheme_fee</span></span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class scheme_fee:
    def __init__(self):
        load_dotenv()
        pass

    def generate_table(self, client: str, date: str):
        &#34;&#34;&#34;Generates a csv on the scheme fee&#39;s bucket in the clients &#39;out&#39; directory with feeded date data

        Args:
            client (str): must exists in database.
            date (str): must be in format YYYYMM
        &#34;&#34;&#34;
        try:
            s3 = connection.connect_to_s3()
            module = &#34;OPERATIONAL&#34;
            exec_module = &#34;SCHEME FEE&#34;

            step =  &#34;&#34;
            temporal_schema = &#34;temporal&#34;
            log_name = log.logs().new_log(
                module, &#34;&#34;, client, &#34;GENERATION OF SCHEME FEE REPORT&#34;, &#34;SCHEME_FEE&#34;,exec_module
            )

            date = str(date)
            year = date[0:4]
            month = date[4:6]
            date_month = calendar.monthrange(int(year),int(month))

            max_null = int(os.getenv(&#34;SCHEME_FEE_TOLERANCE&#34;,5))

            date_of_extract = datetime.now()
            formated_date = (
                str(date_of_extract.year)
                + str(date_of_extract.month)
                + str(date_of_extract.day)
                + &#34;_&#34;
                + str(int(datetime.timestamp(date_of_extract)))
            )

            first_day = datetime.strptime(f&#34;{year}-{month}-01 00:00:00&#34;,&#34;%Y-%m-%d %H:%M:%S&#34;)
            last_day = datetime.strptime(f&#34;{year}-{month}-{date_month[1]} 23:59:59&#34;,&#34;%Y-%m-%d %H:%M:%S&#34;)

            month_of_report = datetime.strptime(month, &#34;%m&#34;)
            month_name = date

            go_main = adapters.get_others(client,log_name)
            begin_date = datetime.strftime(first_day,&#34;%Y%m%d&#34;)
            form_date = datetime.strftime(last_day,&#34;%Y%m%d&#34;)
            exists_month = connection.connect_to_postgreSQL().select(table=&#34;operational.mh_scheme_fee_sumary&#34;,conditions= f&#34;where report_month = &#39;{date}&#39; and report_client_code = &#39;{client}&#39;&#34;)
            previous = False
            if len(exists_month)&gt; 0:
                loop = True
                previous = True
                while loop:
                    loop = self.input_validate(client,module,log_name,step,month_name,exec_module)
            go_main.config_additional_table(begin_date,form_date,&#39;mh_transaction_scheme_fee&#39;)
            go_main.config_additional_table(begin_date,begin_date,config_table_name=&#39;mh_monthly_scheme_fee&#39;)

                    
            filename = f&#34;{client}_{date}_{formated_date}.csv&#34;
            s3_bucket =  os.getenv(&#34;SCHEME_FEE_BUCKET&#34;)
            s3_route = f&#34;OUT/{client}&#34;
            temp_route_folder = f&#34;FILES/SCHEME_FEE/OUT/{client}/{date}&#34;
            temp_file_name = f&#34;{temp_route_folder}/{filename}&#34;
            temp_transaction_table = f&#34;temp_scheme_fee_transaction_{client.lower()}_{date}&#34;
            temp_report_table = f&#34;temp_scheme_fee_report_{client.lower()}_{date}&#34;

            pathlib.Path(temp_route_folder).mkdir(parents=True, exist_ok=True)

            db = connection.connect_to_postgreSQL()

            querys = getquery.getquery(client)
            columns = querys.get_detail_columns()
            report_columns = querys.get_report_columns()

            create_temporal_transactions = querys.temp_table_scheme_fee_transaction()
            create_temporal_report = querys.temp_table_scheme_fee_report()
            insert_into_query = querys.get_insert_detail(columns,temporal_schema,temp_transaction_table)
            visa_issuer_query = querys.get_issuers_visa(formated_date,date,first_day,last_day)
            visa_acquirer_query = querys.get_acquirer_visa(formated_date,date,first_day,last_day)
            visa_issuer_ON_US_query = querys.get_on_us_visa(formated_date,date,first_day,last_day)
            visa_sms_query = querys.get_sms_visa(formated_date,date,first_day,last_day)

            master_card_gen = querys.get_transactions_mastercard(formated_date,date,first_day,last_day)
            master_card_gen_onus_iss = querys.get_issuers_on_us_mastercard(formated_date,date,first_day,last_day)
            master_card_gen_onus_acq = querys.get_acquiring_on_us_mastercard(formated_date,date,first_day,last_day)

            exit_query = querys.get_union_query(insert_into_query,[visa_issuer_query,visa_acquirer_query,visa_issuer_ON_US_query
            ,visa_sms_query,master_card_gen_onus_iss,master_card_gen_onus_acq,master_card_gen])

            calculate_report_currency = querys.get_exchange_rate_calculation(temporal_schema,temp_transaction_table,first_day,last_day)
            calculating_ticket_size =querys.update_size_tickets(temporal_schema,temp_transaction_table,first_day,last_day)
            get_off_rows_w_null = querys.get_rows_w_null_conditions(first_day,last_day,formated_date)

            inserting_data_to_rpt_table = querys.get_insert_into_report_table(temporal_schema,temp_report_table,temporal_schema,temp_transaction_table,formated_date,month_name,first_day,last_day)
            updating_temp_report = querys.get_report_extra_columns(temporal_schema,temp_report_table,&#39;&#39;,first_day)
            get_report = querys.get_report_query(temporal_schema,temp_report_table,report_columns,formated_date)

            delete_old_detail = querys.get_delete_detail(date,formated_date)
            delete_old_report = querys.get_delete_report(month_name,formated_date)
            delete_old_sumary = querys.get_delete_sumary(month_name,formated_date)
            delete_nulls = querys.delete_rows_w_null(temporal_schema,temp_transaction_table,get_off_rows_w_null)

            step = &#34;PREPARING DATA FOR REPORT&#34;
        
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Drop temporal tables if exists&#34;,
                exec_module
            )
            result = db.drop_table(f&#34;{temporal_schema}.{temp_transaction_table}&#34;)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
            result = db.drop_table(f&#34;{temporal_schema}.{temp_report_table}&#34;)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Creating temporal tables for report&#34;,
                exec_module
            )
            result = db.create_table_from_select(create_temporal_transactions,f&#34;{temporal_schema}.{temp_transaction_table}&#34;)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
            result = db.create_table_from_select(create_temporal_report,f&#34;{temporal_schema}.{temp_report_table}&#34;)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Inserting data into temporal table {temporal_schema}.{temp_transaction_table}&#34;,
                exec_module
            )
            result = db.execute_block(exit_query)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Calculating report exchange rates and amounts&#34;,
                exec_module
            )
            result = db.execute_block(calculate_report_currency)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Check for null validation columns&#34;,
                exec_module
            )
            result = db.select(f&#34;{temporal_schema}.{temp_transaction_table}&#34;,get_off_rows_w_null,&#34;count(app_id) quantity&#34;)
            null_rows = int(result[0][&#34;quantity&#34;])
            if null_rows &gt; 0:
                if null_rows == int(max_null):
                    log.logs().exist_file(
                        module,
                        client,
                        &#34;VISA AND MASTERCARD&#34;,
                        log_name,
                        step,
                        &#34;CRITICAL&#34;,
                        &#34;Max null tolerance reached, aborting process.&#34;,
                        exec_module
                    )
                    exit()
                else:
                    log.logs().exist_file(
                        module,
                        client,
                        &#34;VISA AND MASTERCARD&#34;,
                        log_name,
                        step,
                        &#34;WARNING&#34;,
                        f&#34;{null_rows} rows with validation fields in null are going to be removed and not included in the report.&#34;,
                        exec_module
                    ) 
                    result = db.execute_block(delete_nulls)
                    log.logs().exist_file(
                        module,
                        client,
                        &#34;VISA AND MASTERCARD&#34;,
                        log_name,
                        step,
                        &#34;WARNING&#34;,
                        result,
                        exec_module
                    )
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Calculating ticket size for transactions&#34;,
                exec_module
            )
            result = db.execute_block(calculating_ticket_size)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Grouping data and inserting in temporal report table&#34;,
                exec_module
            )
            result = db.execute_block(inserting_data_to_rpt_table)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Updating internal columns of temporal table&#34;,
                exec_module
            )
            result = db.execute_block(updating_temp_report)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
            
            step = &#34;CREATING CSV SCHEME FEE REPORT&#34;
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Creating csv report&#34;,
                exec_module
            )
            df = db.select_to_df_object(get_report)
            df = df.filter(report_columns, axis=1)
            df[&#34;account_number&#34;] = df[&#34;account_number&#34;].astype(&#39;str&#39;)
            df.to_csv(temp_file_name,sep=&#34;;&#34;,index=False)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Exporting report to s3 bucket&#34;,
                exec_module
            )
            s3.upload_object(s3_bucket,temp_file_name,f&#34;{s3_route}/{filename}&#34;)

            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Report uploaded in S3 bucket. File route: {s3_route}/{filename}&#34;,
                exec_module
            )
            step = &#34;CLEANING AND FINISHING PROCESS&#34;
            total_transactions = db.select(f&#34;{temporal_schema}.{temp_transaction_table}&#34;,cols=&#34;count(app_id) quantity&#34;)
            insert_into_sumary = querys.get_insert_into_sumary(formated_date,month_name,total_transactions[0][&#34;quantity&#34;],len(df),s3_route)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Saving report sumary into database, Month {month_name}&#34;,
                exec_module
            )
            result = db.execute_block(insert_into_sumary)

            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Inserting data in scheme fee transaction table&#34;,
                exec_module
            )
            result = db.insert_from_table(temporal_schema,temp_transaction_table,&#34;operational&#34;,&#34;mh_transaction_scheme_fee&#34;)
            log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    result,
                    exec_module
                )
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Inserting data in scheme fee report table&#34;,
                exec_module
            )
            result = db.insert_from_table(temporal_schema,temp_report_table,&#34;operational&#34;,&#34;mh_monthly_scheme_fee&#34;)
            log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    result,
                    exec_module
                )
            if previous:
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    &#34;Deleting old sumary already generated&#34;,
                    exec_module
                )
                result = db.execute_block(delete_old_sumary)
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    result,
                    exec_module
                )
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    &#34;Deleting old generated detail&#34;,
                    exec_module
                )
                result = db.execute_block(delete_old_detail)
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    result,
                    exec_module
                )
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    &#34;Deleting old generated report&#34;,
                    exec_module
                )
                result = db.execute_block(delete_old_report)
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    result,
                    exec_module
                )
            
            result = db.drop_table(f&#34;{temporal_schema}.{temp_transaction_table}&#34;)
            result = db.drop_table(f&#34;{temporal_schema}.{temp_report_table}&#34;)
            
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Temporal tables droped sucessfully&#34;,
                exec_module
            )

            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Report of {month_name} has been saved sucesfully&#34;,
                exec_module
            )

        except Exception as e:

            log.logs().exist_file(
                &#34;OPERATIONAL&#34;,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;CRITICAL&#34;,
                f&#34;UNHANDLED EXCEPTION: {str(log.logs().print_except())}&#34;,
                exec_module
            )

    def read_table(self, client: str, file: str, date: str):
        &#34;&#34;&#34;Reads a csv on the scheme fee&#39;s bucket in the clients &#39;IN&#39; directory with feeded date data
        
        Args:
            client (str): must exists in database.
            date (str): must be in format YYYYMM.
            file (str): must be route IN to file and exists in bucket

            
        &#34;&#34;&#34;
        try:
            
            tran = None
            schem = &#34;operational&#34;
            temp_schem = &#34;temporal&#34;
            module = &#34;OPERATIONAL&#34;
            exec_module = &#34;SCHEME FEE&#34;
            s3_route = &#34;IN/&#34;+file
            step =  &#34;&#34;

            log_name = log.logs().new_log(
                module, &#34;&#34;, client, &#34;GENERATION OF SCHEME FEE REPORT&#34;, &#34;SCHEME_FEE&#34;,exec_module
            )

            date = str(date)
            year = date[0:4]
            month = date[4:6]
            date_month = calendar.monthrange(int(year),int(month))

            first_day = datetime.strptime(f&#34;{year}-{month}-01 00:00:00&#34;,&#34;%Y-%m-%d %H:%M:%S&#34;)
            last_day = datetime.strptime(f&#34;{year}-{month}-{date_month[1]} 23:59:59&#34;,&#34;%Y-%m-%d %H:%M:%S&#34;)

            month_of_report = datetime.strptime(month, &#34;%m&#34;)
            month_name = date
            
            step = &#34;READING SCHEME FEE UPDATE TEMPLATE&#34;

            log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    f&#34;Reading file from S3 route: IN/{file}&#34;,
                    exec_module
                )

            date_of_extract = datetime.now()
            formated_date = (
                str(date_of_extract.year)
                + str(date_of_extract.month)
                + str(date_of_extract.day)
                + &#34;_&#34;
                + str(int(datetime.timestamp(date_of_extract)))
            )


            s3 = connection.connect_to_s3()
            s3_bucket =  os.getenv(&#34;SCHEME_FEE_BUCKET&#34;)
            s3_route = f&#34;IN/{file}&#34;
            filename = pathlib.Path(file).name
            temp_route_folder = f&#34;FILES/SCHEME_FEE/IN/{client}/{date}/{formated_date}&#34;
            temp_file_name = f&#34;{temp_route_folder}/{filename}&#34;
            temp_transaction_table = f&#34;temp_scheme_fee_transaction_{client.lower()}_{date}&#34;
            temp_report_table = f&#34;temp_scheme_fee_report_{client.lower()}_{date}&#34;
            pathlib.Path(temp_route_folder).mkdir(parents=True, exist_ok=True)

            s3.get_object(s3_bucket,s3_route,temp_file_name)
            valid_NaNs = [&#39;-1.#IND&#39;, &#39;1.#QNAN&#39;, &#39;1.#IND&#39;, &#39;-1.#QNAN&#39;, &#39;#N/A N/A&#39;, &#39;#N/A&#39;, &#39;N/A&#39;, &#39;n/a&#39;, &#39;&#39;, &#39;#NA&#39;, &#39;NULL&#39;, &#39;null&#39;, &#39;NaN&#39;, &#39;-NaN&#39;, &#39;nan&#39;, &#39;-nan&#39;, &#39;&#39;]

            df = pd.read_csv(temp_file_name,sep=&#34;;&#34;,encoding=&#34;Latin-1&#34;,keep_default_na=False,na_values=valid_NaNs, dtype={&#34;account_number&#34;:str,
                &#34;range_program_id&#34;:str,
                &#34;reversal_indicator&#34;:str,
                &#34;currency_local_indicator&#34;:str,
                &#34;reversal_indicator&#34;:str,
                &#34;card_present_indicator&#34;:str,
                })

            if len(df.index) == 0:
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    f&#34;No data has been found in the file. closing process&#34;,
                    exec_module
                )
                return 

            log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    f&#34;procesing file data of month: {month_name}&#34;,
                    exec_module
                )


            df[&#34;unitary_scheme_fee_cost&#34;] = round(df[&#34;transaction_scheme_fee_cost&#34;] / df[&#34;transaction_count&#34;],6)
            df[&#34;unitary_estimated_scheme_fee_amount&#34;] = round(df[&#34;estimated_scheme_fee_amount&#34;] / df[&#34;transaction_count&#34;],6)
            
            querys = getquery.getquery(client)
            db = connection.connect_to_postgreSQL()

            update_from_temp = querys.get_update_from_temp(temp_schem,temp_report_table,month_name)
            update_detail = querys.get_update_detail(first_day,last_day,month_name)
            report_sumary = db.select(&#34;operational.mh_scheme_fee_sumary&#34;,f&#34;where report_month = &#39;{month_name}&#39; and  report_client_code = &#39;{client}&#39;&#34;)

            if len(report_sumary) == 0 :
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;ERROR&#34;,
                    f&#34;Report is not generated yet or not exists anymore.&#34;,
                    exec_module
                )

                exit() 

            if len(df.index) != report_sumary[0][&#34;number_of_groups&#34;]:
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;WARNING&#34;,
                    f&#34;The quantity of records in file is not the same as the one registered in the report.{len(df.index)} - {report_sumary[0][&#39;number_of_groups&#39;]} | closing execution&#34;,
                    exec_module
                )
                exit()
            step = &#34;UPDATING DATA&#34;

            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Droping temporal table if exists&#34;,
                exec_module
            )
            result = db.drop_table(f&#34;{temp_schem}.{temp_report_table}&#34;)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Inserting data into temporal table {temp_schem}.{temp_report_table}&#34;,
                exec_module
            )
            result = db.insert_from_dataframe(temp_report_table,dataframe=df,schema=temp_schem,if_exists=&#34;replace&#34;,dtype={&#34;size_ticket&#34;:sqlalchemy.String})
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Data inserted sucesfully. Rows inserted {len(df)}&#34;,
                exec_module
            )
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Updating data in report table&#34;,
                exec_module
            )
            result = db.execute_block(update_from_temp,True)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result[0],
                exec_module
            )
            if int(result[1]) != report_sumary[0][&#34;number_of_groups&#34;] :
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;CRITICAL&#34;,
                    f&#34;Updated groups quantity ({result[1]} rows) is not the same as the report sumary ({report_sumary[0][&#39;number_of_groups&#39;]} rows) . Aborting process.&#34;,
                    exec_module
                )
                exit()
            
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Updating transactions in transactions table&#34;,
                exec_module
            )
            result = db.execute_block(update_detail,True)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result[0],
                exec_module
            )

            if int(result[1]) != report_sumary[0][&#34;number_of_inserted_rows&#34;] :
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;CRITICAL&#34;,
                    f&#34;Updated rows quantity ({result[1]} rows) is not the same as the report sumary ({report_sumary[0][&#39;number_of_groups&#39;]} rows) . Aborting process.&#34;,
                    exec_module
                )
                exit()

            update_sumary = querys.get_update_sumary(result[1],month_name)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Saving results in database&#34;,
                exec_module
            )

            result = db.execute_block(update_sumary)

            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Report sumary updated sucesfully&#34;,
                exec_module
            )

            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Closing conection to database&#34;,
                exec_module
            )

            log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;INFO&#34;,
                    f&#34;Tables updated sucessfully&#34;,
                    exec_module
                )
    
        except Exception as e:
            log.logs().exist_file(
                &#34;OPERATIONAL&#34;,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;CRITICAL&#34;,
                f&#34;UNHANDLED EXCEPTION: {str(log.logs().print_except())}&#34;,
                exec_module
            )

    def input_validate(self,client:str,module:str,log_name:str,step:str,month_name:str,exec_module:str)-&gt; bool:
        &#34;&#34;&#34;Ask for input returns true or false
        
        Args:
            client (str): clients code
            module (str): type of module.
            log_name (str): log name.
            step (str): step on execution.
            month_name (str): month of report
            exec_module (str): execution module.

        Returns:
            bool: True if is not a valid input, False if is a valid input.
        
        &#34;&#34;&#34;
        yes_array = [&#39;yes&#39;,&#39;y&#39;,&#39;si&#39;,&#39;ya&#39;,&#39;ok&#39;]
        no_array = [&#39;no&#39;,&#39;n&#39;,&#39;nah&#39;,&#39;nope&#39;]
        asking = input(&#34;A report has been already generated. If you want to continue, this will delete all data from the previous report. Type &#39;Yes&#39; to continue or &#39;No&#39; to cancel: &#34;)
        asking = asking.lower()
        if asking in yes_array:
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;WARNING&#34;,
                f&#34;Previous data is going to be deleted . Month: {month_name}&#34;,
                exec_module
            )
            return False

        elif asking in no_array:
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Canceled by user&#34;,
                exec_module
            )
            exit()
        
        else:
            print(&#34;&#39;&#34;+asking+&#34;&#39; is not a valid input&#34;)
            return True</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.managment.scheme_fee.generate_table"><code class="name flex">
<span>def <span class="ident">generate_table</span></span>(<span>self, client:str, date:str)</span>
</code></dt>
<dd>
<div class="desc"><p>Generates a csv on the scheme fee's bucket in the clients 'out' directory with feeded date data</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>client</code></strong> :&ensp;<code>str</code></dt>
<dd>must exists in database.</dd>
<dt><strong><code>date</code></strong> :&ensp;<code>str</code></dt>
<dd>must be in format YYYYMM</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def generate_table(self, client: str, date: str):
    &#34;&#34;&#34;Generates a csv on the scheme fee&#39;s bucket in the clients &#39;out&#39; directory with feeded date data

    Args:
        client (str): must exists in database.
        date (str): must be in format YYYYMM
    &#34;&#34;&#34;
    try:
        s3 = connection.connect_to_s3()
        module = &#34;OPERATIONAL&#34;
        exec_module = &#34;SCHEME FEE&#34;

        step =  &#34;&#34;
        temporal_schema = &#34;temporal&#34;
        log_name = log.logs().new_log(
            module, &#34;&#34;, client, &#34;GENERATION OF SCHEME FEE REPORT&#34;, &#34;SCHEME_FEE&#34;,exec_module
        )

        date = str(date)
        year = date[0:4]
        month = date[4:6]
        date_month = calendar.monthrange(int(year),int(month))

        max_null = int(os.getenv(&#34;SCHEME_FEE_TOLERANCE&#34;,5))

        date_of_extract = datetime.now()
        formated_date = (
            str(date_of_extract.year)
            + str(date_of_extract.month)
            + str(date_of_extract.day)
            + &#34;_&#34;
            + str(int(datetime.timestamp(date_of_extract)))
        )

        first_day = datetime.strptime(f&#34;{year}-{month}-01 00:00:00&#34;,&#34;%Y-%m-%d %H:%M:%S&#34;)
        last_day = datetime.strptime(f&#34;{year}-{month}-{date_month[1]} 23:59:59&#34;,&#34;%Y-%m-%d %H:%M:%S&#34;)

        month_of_report = datetime.strptime(month, &#34;%m&#34;)
        month_name = date

        go_main = adapters.get_others(client,log_name)
        begin_date = datetime.strftime(first_day,&#34;%Y%m%d&#34;)
        form_date = datetime.strftime(last_day,&#34;%Y%m%d&#34;)
        exists_month = connection.connect_to_postgreSQL().select(table=&#34;operational.mh_scheme_fee_sumary&#34;,conditions= f&#34;where report_month = &#39;{date}&#39; and report_client_code = &#39;{client}&#39;&#34;)
        previous = False
        if len(exists_month)&gt; 0:
            loop = True
            previous = True
            while loop:
                loop = self.input_validate(client,module,log_name,step,month_name,exec_module)
        go_main.config_additional_table(begin_date,form_date,&#39;mh_transaction_scheme_fee&#39;)
        go_main.config_additional_table(begin_date,begin_date,config_table_name=&#39;mh_monthly_scheme_fee&#39;)

                
        filename = f&#34;{client}_{date}_{formated_date}.csv&#34;
        s3_bucket =  os.getenv(&#34;SCHEME_FEE_BUCKET&#34;)
        s3_route = f&#34;OUT/{client}&#34;
        temp_route_folder = f&#34;FILES/SCHEME_FEE/OUT/{client}/{date}&#34;
        temp_file_name = f&#34;{temp_route_folder}/{filename}&#34;
        temp_transaction_table = f&#34;temp_scheme_fee_transaction_{client.lower()}_{date}&#34;
        temp_report_table = f&#34;temp_scheme_fee_report_{client.lower()}_{date}&#34;

        pathlib.Path(temp_route_folder).mkdir(parents=True, exist_ok=True)

        db = connection.connect_to_postgreSQL()

        querys = getquery.getquery(client)
        columns = querys.get_detail_columns()
        report_columns = querys.get_report_columns()

        create_temporal_transactions = querys.temp_table_scheme_fee_transaction()
        create_temporal_report = querys.temp_table_scheme_fee_report()
        insert_into_query = querys.get_insert_detail(columns,temporal_schema,temp_transaction_table)
        visa_issuer_query = querys.get_issuers_visa(formated_date,date,first_day,last_day)
        visa_acquirer_query = querys.get_acquirer_visa(formated_date,date,first_day,last_day)
        visa_issuer_ON_US_query = querys.get_on_us_visa(formated_date,date,first_day,last_day)
        visa_sms_query = querys.get_sms_visa(formated_date,date,first_day,last_day)

        master_card_gen = querys.get_transactions_mastercard(formated_date,date,first_day,last_day)
        master_card_gen_onus_iss = querys.get_issuers_on_us_mastercard(formated_date,date,first_day,last_day)
        master_card_gen_onus_acq = querys.get_acquiring_on_us_mastercard(formated_date,date,first_day,last_day)

        exit_query = querys.get_union_query(insert_into_query,[visa_issuer_query,visa_acquirer_query,visa_issuer_ON_US_query
        ,visa_sms_query,master_card_gen_onus_iss,master_card_gen_onus_acq,master_card_gen])

        calculate_report_currency = querys.get_exchange_rate_calculation(temporal_schema,temp_transaction_table,first_day,last_day)
        calculating_ticket_size =querys.update_size_tickets(temporal_schema,temp_transaction_table,first_day,last_day)
        get_off_rows_w_null = querys.get_rows_w_null_conditions(first_day,last_day,formated_date)

        inserting_data_to_rpt_table = querys.get_insert_into_report_table(temporal_schema,temp_report_table,temporal_schema,temp_transaction_table,formated_date,month_name,first_day,last_day)
        updating_temp_report = querys.get_report_extra_columns(temporal_schema,temp_report_table,&#39;&#39;,first_day)
        get_report = querys.get_report_query(temporal_schema,temp_report_table,report_columns,formated_date)

        delete_old_detail = querys.get_delete_detail(date,formated_date)
        delete_old_report = querys.get_delete_report(month_name,formated_date)
        delete_old_sumary = querys.get_delete_sumary(month_name,formated_date)
        delete_nulls = querys.delete_rows_w_null(temporal_schema,temp_transaction_table,get_off_rows_w_null)

        step = &#34;PREPARING DATA FOR REPORT&#34;
    
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            f&#34;Drop temporal tables if exists&#34;,
            exec_module
        )
        result = db.drop_table(f&#34;{temporal_schema}.{temp_transaction_table}&#34;)
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            result,
            exec_module
        )
        result = db.drop_table(f&#34;{temporal_schema}.{temp_report_table}&#34;)
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            result,
            exec_module
        )
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            &#34;Creating temporal tables for report&#34;,
            exec_module
        )
        result = db.create_table_from_select(create_temporal_transactions,f&#34;{temporal_schema}.{temp_transaction_table}&#34;)
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            result,
            exec_module
        )
        result = db.create_table_from_select(create_temporal_report,f&#34;{temporal_schema}.{temp_report_table}&#34;)
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            result,
            exec_module
        )
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            f&#34;Inserting data into temporal table {temporal_schema}.{temp_transaction_table}&#34;,
            exec_module
        )
        result = db.execute_block(exit_query)
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            result,
            exec_module
        )
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            &#34;Calculating report exchange rates and amounts&#34;,
            exec_module
        )
        result = db.execute_block(calculate_report_currency)
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            result,
            exec_module
        )
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            &#34;Check for null validation columns&#34;,
            exec_module
        )
        result = db.select(f&#34;{temporal_schema}.{temp_transaction_table}&#34;,get_off_rows_w_null,&#34;count(app_id) quantity&#34;)
        null_rows = int(result[0][&#34;quantity&#34;])
        if null_rows &gt; 0:
            if null_rows == int(max_null):
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;CRITICAL&#34;,
                    &#34;Max null tolerance reached, aborting process.&#34;,
                    exec_module
                )
                exit()
            else:
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;WARNING&#34;,
                    f&#34;{null_rows} rows with validation fields in null are going to be removed and not included in the report.&#34;,
                    exec_module
                ) 
                result = db.execute_block(delete_nulls)
                log.logs().exist_file(
                    module,
                    client,
                    &#34;VISA AND MASTERCARD&#34;,
                    log_name,
                    step,
                    &#34;WARNING&#34;,
                    result,
                    exec_module
                )
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            &#34;Calculating ticket size for transactions&#34;,
            exec_module
        )
        result = db.execute_block(calculating_ticket_size)
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            result,
            exec_module
        )
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            &#34;Grouping data and inserting in temporal report table&#34;,
            exec_module
        )
        result = db.execute_block(inserting_data_to_rpt_table)
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            result,
            exec_module
        )
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            &#34;Updating internal columns of temporal table&#34;,
            exec_module
        )
        result = db.execute_block(updating_temp_report)
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            result,
            exec_module
        )
        
        step = &#34;CREATING CSV SCHEME FEE REPORT&#34;
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            &#34;Creating csv report&#34;,
            exec_module
        )
        df = db.select_to_df_object(get_report)
        df = df.filter(report_columns, axis=1)
        df[&#34;account_number&#34;] = df[&#34;account_number&#34;].astype(&#39;str&#39;)
        df.to_csv(temp_file_name,sep=&#34;;&#34;,index=False)
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            &#34;Exporting report to s3 bucket&#34;,
            exec_module
        )
        s3.upload_object(s3_bucket,temp_file_name,f&#34;{s3_route}/{filename}&#34;)

        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            f&#34;Report uploaded in S3 bucket. File route: {s3_route}/{filename}&#34;,
            exec_module
        )
        step = &#34;CLEANING AND FINISHING PROCESS&#34;
        total_transactions = db.select(f&#34;{temporal_schema}.{temp_transaction_table}&#34;,cols=&#34;count(app_id) quantity&#34;)
        insert_into_sumary = querys.get_insert_into_sumary(formated_date,month_name,total_transactions[0][&#34;quantity&#34;],len(df),s3_route)
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            f&#34;Saving report sumary into database, Month {month_name}&#34;,
            exec_module
        )
        result = db.execute_block(insert_into_sumary)

        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            &#34;Inserting data in scheme fee transaction table&#34;,
            exec_module
        )
        result = db.insert_from_table(temporal_schema,temp_transaction_table,&#34;operational&#34;,&#34;mh_transaction_scheme_fee&#34;)
        log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            &#34;Inserting data in scheme fee report table&#34;,
            exec_module
        )
        result = db.insert_from_table(temporal_schema,temp_report_table,&#34;operational&#34;,&#34;mh_monthly_scheme_fee&#34;)
        log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
        if previous:
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Deleting old sumary already generated&#34;,
                exec_module
            )
            result = db.execute_block(delete_old_sumary)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Deleting old generated detail&#34;,
                exec_module
            )
            result = db.execute_block(delete_old_detail)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                &#34;Deleting old generated report&#34;,
                exec_module
            )
            result = db.execute_block(delete_old_report)
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                result,
                exec_module
            )
        
        result = db.drop_table(f&#34;{temporal_schema}.{temp_transaction_table}&#34;)
        result = db.drop_table(f&#34;{temporal_schema}.{temp_report_table}&#34;)
        
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            &#34;Temporal tables droped sucessfully&#34;,
            exec_module
        )

        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            f&#34;Report of {month_name} has been saved sucesfully&#34;,
            exec_module
        )

    except Exception as e:

        log.logs().exist_file(
            &#34;OPERATIONAL&#34;,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;CRITICAL&#34;,
            f&#34;UNHANDLED EXCEPTION: {str(log.logs().print_except())}&#34;,
            exec_module
        )</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.managment.scheme_fee.input_validate"><code class="name flex">
<span>def <span class="ident">input_validate</span></span>(<span>self, client:str, module:str, log_name:str, step:str, month_name:str, exec_module:str) >bool</span>
</code></dt>
<dd>
<div class="desc"><p>Ask for input returns true or false</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>client</code></strong> :&ensp;<code>str</code></dt>
<dd>clients code</dd>
<dt><strong><code>module</code></strong> :&ensp;<code>str</code></dt>
<dd>type of module.</dd>
<dt><strong><code>log_name</code></strong> :&ensp;<code>str</code></dt>
<dd>log name.</dd>
<dt><strong><code>step</code></strong> :&ensp;<code>str</code></dt>
<dd>step on execution.</dd>
<dt><strong><code>month_name</code></strong> :&ensp;<code>str</code></dt>
<dd>month of report</dd>
<dt><strong><code>exec_module</code></strong> :&ensp;<code>str</code></dt>
<dd>execution module.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>bool</code></dt>
<dd>True if is not a valid input, False if is a valid input.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def input_validate(self,client:str,module:str,log_name:str,step:str,month_name:str,exec_module:str)-&gt; bool:
    &#34;&#34;&#34;Ask for input returns true or false
    
    Args:
        client (str): clients code
        module (str): type of module.
        log_name (str): log name.
        step (str): step on execution.
        month_name (str): month of report
        exec_module (str): execution module.

    Returns:
        bool: True if is not a valid input, False if is a valid input.
    
    &#34;&#34;&#34;
    yes_array = [&#39;yes&#39;,&#39;y&#39;,&#39;si&#39;,&#39;ya&#39;,&#39;ok&#39;]
    no_array = [&#39;no&#39;,&#39;n&#39;,&#39;nah&#39;,&#39;nope&#39;]
    asking = input(&#34;A report has been already generated. If you want to continue, this will delete all data from the previous report. Type &#39;Yes&#39; to continue or &#39;No&#39; to cancel: &#34;)
    asking = asking.lower()
    if asking in yes_array:
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;WARNING&#34;,
            f&#34;Previous data is going to be deleted . Month: {month_name}&#34;,
            exec_module
        )
        return False

    elif asking in no_array:
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            f&#34;Canceled by user&#34;,
            exec_module
        )
        exit()
    
    else:
        print(&#34;&#39;&#34;+asking+&#34;&#39; is not a valid input&#34;)
        return True</code></pre>
</details>
</dd>
<dt id="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.managment.scheme_fee.read_table"><code class="name flex">
<span>def <span class="ident">read_table</span></span>(<span>self, client:str, file:str, date:str)</span>
</code></dt>
<dd>
<div class="desc"><p>Reads a csv on the scheme fee's bucket in the clients 'IN' directory with feeded date data</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>client</code></strong> :&ensp;<code>str</code></dt>
<dd>must exists in database.</dd>
<dt><strong><code>date</code></strong> :&ensp;<code>str</code></dt>
<dd>must be in format YYYYMM.</dd>
<dt><strong><code>file</code></strong> :&ensp;<code>str</code></dt>
<dd>must be route IN to file and exists in bucket</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def read_table(self, client: str, file: str, date: str):
    &#34;&#34;&#34;Reads a csv on the scheme fee&#39;s bucket in the clients &#39;IN&#39; directory with feeded date data
    
    Args:
        client (str): must exists in database.
        date (str): must be in format YYYYMM.
        file (str): must be route IN to file and exists in bucket

        
    &#34;&#34;&#34;
    try:
        
        tran = None
        schem = &#34;operational&#34;
        temp_schem = &#34;temporal&#34;
        module = &#34;OPERATIONAL&#34;
        exec_module = &#34;SCHEME FEE&#34;
        s3_route = &#34;IN/&#34;+file
        step =  &#34;&#34;

        log_name = log.logs().new_log(
            module, &#34;&#34;, client, &#34;GENERATION OF SCHEME FEE REPORT&#34;, &#34;SCHEME_FEE&#34;,exec_module
        )

        date = str(date)
        year = date[0:4]
        month = date[4:6]
        date_month = calendar.monthrange(int(year),int(month))

        first_day = datetime.strptime(f&#34;{year}-{month}-01 00:00:00&#34;,&#34;%Y-%m-%d %H:%M:%S&#34;)
        last_day = datetime.strptime(f&#34;{year}-{month}-{date_month[1]} 23:59:59&#34;,&#34;%Y-%m-%d %H:%M:%S&#34;)

        month_of_report = datetime.strptime(month, &#34;%m&#34;)
        month_name = date
        
        step = &#34;READING SCHEME FEE UPDATE TEMPLATE&#34;

        log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Reading file from S3 route: IN/{file}&#34;,
                exec_module
            )

        date_of_extract = datetime.now()
        formated_date = (
            str(date_of_extract.year)
            + str(date_of_extract.month)
            + str(date_of_extract.day)
            + &#34;_&#34;
            + str(int(datetime.timestamp(date_of_extract)))
        )


        s3 = connection.connect_to_s3()
        s3_bucket =  os.getenv(&#34;SCHEME_FEE_BUCKET&#34;)
        s3_route = f&#34;IN/{file}&#34;
        filename = pathlib.Path(file).name
        temp_route_folder = f&#34;FILES/SCHEME_FEE/IN/{client}/{date}/{formated_date}&#34;
        temp_file_name = f&#34;{temp_route_folder}/{filename}&#34;
        temp_transaction_table = f&#34;temp_scheme_fee_transaction_{client.lower()}_{date}&#34;
        temp_report_table = f&#34;temp_scheme_fee_report_{client.lower()}_{date}&#34;
        pathlib.Path(temp_route_folder).mkdir(parents=True, exist_ok=True)

        s3.get_object(s3_bucket,s3_route,temp_file_name)
        valid_NaNs = [&#39;-1.#IND&#39;, &#39;1.#QNAN&#39;, &#39;1.#IND&#39;, &#39;-1.#QNAN&#39;, &#39;#N/A N/A&#39;, &#39;#N/A&#39;, &#39;N/A&#39;, &#39;n/a&#39;, &#39;&#39;, &#39;#NA&#39;, &#39;NULL&#39;, &#39;null&#39;, &#39;NaN&#39;, &#39;-NaN&#39;, &#39;nan&#39;, &#39;-nan&#39;, &#39;&#39;]

        df = pd.read_csv(temp_file_name,sep=&#34;;&#34;,encoding=&#34;Latin-1&#34;,keep_default_na=False,na_values=valid_NaNs, dtype={&#34;account_number&#34;:str,
            &#34;range_program_id&#34;:str,
            &#34;reversal_indicator&#34;:str,
            &#34;currency_local_indicator&#34;:str,
            &#34;reversal_indicator&#34;:str,
            &#34;card_present_indicator&#34;:str,
            })

        if len(df.index) == 0:
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;No data has been found in the file. closing process&#34;,
                exec_module
            )
            return 

        log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;procesing file data of month: {month_name}&#34;,
                exec_module
            )


        df[&#34;unitary_scheme_fee_cost&#34;] = round(df[&#34;transaction_scheme_fee_cost&#34;] / df[&#34;transaction_count&#34;],6)
        df[&#34;unitary_estimated_scheme_fee_amount&#34;] = round(df[&#34;estimated_scheme_fee_amount&#34;] / df[&#34;transaction_count&#34;],6)
        
        querys = getquery.getquery(client)
        db = connection.connect_to_postgreSQL()

        update_from_temp = querys.get_update_from_temp(temp_schem,temp_report_table,month_name)
        update_detail = querys.get_update_detail(first_day,last_day,month_name)
        report_sumary = db.select(&#34;operational.mh_scheme_fee_sumary&#34;,f&#34;where report_month = &#39;{month_name}&#39; and  report_client_code = &#39;{client}&#39;&#34;)

        if len(report_sumary) == 0 :
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;ERROR&#34;,
                f&#34;Report is not generated yet or not exists anymore.&#34;,
                exec_module
            )

            exit() 

        if len(df.index) != report_sumary[0][&#34;number_of_groups&#34;]:
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;WARNING&#34;,
                f&#34;The quantity of records in file is not the same as the one registered in the report.{len(df.index)} - {report_sumary[0][&#39;number_of_groups&#39;]} | closing execution&#34;,
                exec_module
            )
            exit()
        step = &#34;UPDATING DATA&#34;

        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            f&#34;Droping temporal table if exists&#34;,
            exec_module
        )
        result = db.drop_table(f&#34;{temp_schem}.{temp_report_table}&#34;)
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            result,
            exec_module
        )
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            f&#34;Inserting data into temporal table {temp_schem}.{temp_report_table}&#34;,
            exec_module
        )
        result = db.insert_from_dataframe(temp_report_table,dataframe=df,schema=temp_schem,if_exists=&#34;replace&#34;,dtype={&#34;size_ticket&#34;:sqlalchemy.String})
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            f&#34;Data inserted sucesfully. Rows inserted {len(df)}&#34;,
            exec_module
        )
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            f&#34;Updating data in report table&#34;,
            exec_module
        )
        result = db.execute_block(update_from_temp,True)
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            result[0],
            exec_module
        )
        if int(result[1]) != report_sumary[0][&#34;number_of_groups&#34;] :
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;CRITICAL&#34;,
                f&#34;Updated groups quantity ({result[1]} rows) is not the same as the report sumary ({report_sumary[0][&#39;number_of_groups&#39;]} rows) . Aborting process.&#34;,
                exec_module
            )
            exit()
        
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            &#34;Updating transactions in transactions table&#34;,
            exec_module
        )
        result = db.execute_block(update_detail,True)
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            result[0],
            exec_module
        )

        if int(result[1]) != report_sumary[0][&#34;number_of_inserted_rows&#34;] :
            log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;CRITICAL&#34;,
                f&#34;Updated rows quantity ({result[1]} rows) is not the same as the report sumary ({report_sumary[0][&#39;number_of_groups&#39;]} rows) . Aborting process.&#34;,
                exec_module
            )
            exit()

        update_sumary = querys.get_update_sumary(result[1],month_name)
        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            &#34;Saving results in database&#34;,
            exec_module
        )

        result = db.execute_block(update_sumary)

        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            &#34;Report sumary updated sucesfully&#34;,
            exec_module
        )

        log.logs().exist_file(
            module,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;INFO&#34;,
            f&#34;Closing conection to database&#34;,
            exec_module
        )

        log.logs().exist_file(
                module,
                client,
                &#34;VISA AND MASTERCARD&#34;,
                log_name,
                step,
                &#34;INFO&#34;,
                f&#34;Tables updated sucessfully&#34;,
                exec_module
            )

    except Exception as e:
        log.logs().exist_file(
            &#34;OPERATIONAL&#34;,
            client,
            &#34;VISA AND MASTERCARD&#34;,
            log_name,
            step,
            &#34;CRITICAL&#34;,
            f&#34;UNHANDLED EXCEPTION: {str(log.logs().print_except())}&#34;,
            exec_module
        )</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee" href="index.html">PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.managment.scheme_fee" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.managment.scheme_fee">scheme_fee</a></code></h4>
<ul class="">
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.managment.scheme_fee.generate_table" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.managment.scheme_fee.generate_table">generate_table</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.managment.scheme_fee.input_validate" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.managment.scheme_fee.input_validate">input_validate</a></code></li>
<li><code><a title="PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.managment.scheme_fee.read_table" href="#PROY-INTELICA-INTERCAMBIO-2022.Module.SchemeFee.managment.scheme_fee.read_table">read_table</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>